function upload_img(){var e=new FormData($(".new_attach form")[0]);$.ajax({url:$(".new_attach form").attr("action"),type:"POST",data:e,success:function(e){$("#loaded_attach").replaceWith(e).toggle()},cache:!1,contentType:!1,processData:!1})}jQuery.fn.extend({insertAtCaret:function(e){return this.each(function(t){if(document.selection){this.focus();var i=document.selection.createRange();i.text=e,this.focus()}else if(this.selectionStart||"0"==this.selectionStart){var n=this.selectionStart,a=this.selectionEnd,r=this.scrollTop;this.value=this.value.substring(0,n)+e+this.value.substring(a,this.value.length),this.focus(),this.selectionStart=n+e.length,this.selectionEnd=n+e.length,this.scrollTop=r}else this.value+=e,this.focus()})},getText:function(){var e="",t=this[0],i=t.selectionStart,n=t.selectionEnd;return e=i||"0"==i?t.value.substring(i,n):document.selection.createRange().text}}),$(document).ready(function(){$(".edit #page_content").editInit(),$("<i class='resize'></i>").appendTo(".attachment_img p"),$(".nav_search").on("keyup",function(){var e=this.value.toLowerCase();$(this).siblings("ul").find("a").each(function(t,i){ftxt=$(i).text().toLowerCase();var n=$(i);-1==ftxt.indexOf(e)?n.hide():""==e?n.show():n.show()})}),$(document).on("click",".load_n_attach",function(){return $(".new_attach input[type=file]").click(),!1}),$(document).on("click",".attachment_img p",function(){$.fancybox.open({href:$(this).parent().data("original"),helpers:{overlay:{locked:!1}}})}),$(document).on("click",".load_n_attach_subm",function(){return $("#loaded_attach").prepend("<img src='/static/progress.gif' />"),upload_img(),!1}),$(document).on("click",".load_n_attach_exit",function(){return $("#loaded_attach").stop().toggle(500),!1}),$(".new_attach input[type=file]").change(function(){var e=$(this).val().replace(/.+[\\\/]/,"");$(".load_n_attach_info").text("File:"+e)}),$(document).on("ajax:send","a[data-remote]",function(e,t,i,n){$("#loaded_attach").prepend("<img src='/static/progress.gif' />")}),$(document).on("ajax:success","a[data-remote]",function(e,t,i,n){$("#loaded_attach").replaceWith(t)})}),jQuery.fn.extend({editInit:function(){var e={b:["<b>","</b>"],u:["<u>","</u>"],h1:["<h1>","</h1>"],h2:["<h2>","</h2>"],h3:["<h3>","</h3>"],h4:["<h4>","</h4>"],center:['<div class="center">',"</div>"],indent:['<p class="indent">',"</p>"]},t={a:"<a href='\u0421\u0421\u042b\u041b\u041a\u0410' title='\u0417\u0410\u0413\u041e\u041b\u041e\u0412\u041e\u041a'>\u0422\u0415\u041a\u0421\u0422 \u0421\u0421\u042b\u041b\u041a\u0418</a>"},i={b:"\u0416\u0438\u0440\u043d\u044b\u0439",u:"\u041f\u043e\u0434\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439",h1:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H1",h2:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H2",h3:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H3",h4:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H4",a:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443",center:"\u041f\u043e \u0446\u0435\u043d\u0442\u0440\u0443",indent:"\u041e\u0442\u0441\u0442\u0443\u043f"},n=$("<ul>").attr({"class":"editorNav"}).css({"list-style":"none"});$.each(e,function(e,t){$("<li>").css({display:"inline-block"}).append($("<button>").attr({"data-act":e,"class":"toTag"}).text(i[e])).appendTo(n)}),$("<li>").css({display:"inline-block",width:"20px"}).appendTo(n),$.each(t,function(e,t){$("<li>").css({display:"inline-block"}).append($("<button>").attr({"data-act":e,"class":"placeTag"}).text(i[e])).appendTo(n)}),$("<li>").css({display:"inline-block",width:"20px"}).appendTo(n),$("<li>").css({display:"inline-block"}).append($("<button>").attr({"class":"attach_show"}).text("\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u043b\u043e\u0436\u0435\u043d\u0438\u0439")).appendTo(n),$(this).before(n);var a=this;$(".toTag").click(function(){var t=$(a).getText(),i=$(this).data("act");return $(a).insertAtCaret(e[i][0]+t+e[i][1]),!1}),$(".placeTag").click(function(){var e=$(this).data("act");return $(a).insertAtCaret(t[e]),!1}),$(".attach_show").click(function(){return $("#loaded_attach").stop().toggle(500),!1}),$(document).on("click",".attach",function(){var e=$(this).data("act");return $(a).insertAtCaret(e),!1})}});