<!DOCTYPE html>
<html lang="ru-RU" prefix="og: http://ogp.me/ns#" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="https://serveradmin.ru/xmlrpc.php" />
<title>Настройка сервера телефонии asterisk с нуля</title>

<!-- This site is optimized with the Yoast SEO plugin v5.5.1 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="Описание установки и настройки основного функционала sip атс asterisk, достаточного для обеспечения обычного офиса современной телефонией."/>
<link rel="canonical" href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/" />
<meta property="og:locale" content="ru_RU" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Настройка сервера телефонии asterisk с нуля" />
<meta property="og:description" content="Описание установки и настройки основного функционала sip атс asterisk, достаточного для обеспечения обычного офиса современной телефонией." />
<meta property="og:url" content="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/" />
<meta property="og:site_name" content="Системное администрирование" />
<meta property="article:tag" content="asterisk" />
<meta property="article:section" content="Asterisk" />
<meta property="article:published_time" content="2016-06-13T16:52:18+00:00" />
<meta property="article:modified_time" content="2017-03-09T17:17:11+00:00" />
<meta property="og:updated_time" content="2017-03-09T17:17:11+00:00" />
<meta property="og:image" content="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka.png" />
<meta property="og:image:secure_url" content="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka.png" />
<meta property="og:image:width" content="660" />
<meta property="og:image:height" content="330" />
<script type='application/ld+json'>{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/serveradmin.ru\/","name":"\u0421\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0435 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","potentialAction":{"@type":"SearchAction","target":"https:\/\/serveradmin.ru\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Системное администрирование &raquo; Лента" href="https://serveradmin.ru/feed/" />
<link rel="alternate" type="application/rss+xml" title="Системное администрирование &raquo; Лента комментариев" href="https://serveradmin.ru/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Системное администрирование &raquo; Лента комментариев к &laquo;Asterisk &#8212; SIP АТС для офиса, пошаговая инструкция по настройке с нуля&raquo;" href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/serveradmin.ru\/wp-includes\/js\/wp-emoji-release.min.js"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='toc-screen-css'  href='https://serveradmin.ru/wp-content/plugins/table-of-contents-plus/screen.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wpforo-widgets-css'  href='https://serveradmin.ru/wp-content/plugins/wpforo/wpf-themes/classic/widgets.css' type='text/css' media='all' />
<link rel='stylesheet' id='tie-style-css'  href='https://serveradmin.ru/wp-content/themes/sahifa/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='tie-ilightbox-skin-css'  href='https://serveradmin.ru/wp-content/themes/sahifa/css/ilightbox/dark-skin/skin.css' type='text/css' media='all' />
<link rel='stylesheet' id='Droid+Sans-css'  href='https://fonts.googleapis.com/css?family=Droid+Sans%3Aregular%2C700' type='text/css' media='all' />
<script type='text/javascript' src='https://serveradmin.ru/wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='https://serveradmin.ru/wp-includes/js/jquery/jquery-migrate.min.js'></script>
<script type='text/javascript' src='https://serveradmin.ru/wp-content/plugins/duracelltomi-google-tag-manager/js/gtm4wp-form-move-tracker.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var tieViewsCacheL10n = {"admin_ajax_url":"https:\/\/serveradmin.ru\/wp-admin\/admin-ajax.php","post_id":"2897"};
/* ]]> */
</script>
<script type='text/javascript' src='https://serveradmin.ru/wp-content/themes/sahifa/js/postviews-cache.js'></script>
<link rel='https://api.w.org/' href='https://serveradmin.ru/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://serveradmin.ru/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://serveradmin.ru/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.2" />
<link rel='shortlink' href='https://serveradmin.ru/?p=2897' />
<link rel="alternate" type="application/json+oembed" href="https://serveradmin.ru/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fserveradmin.ru%2Fnastroyka-servera-telefonii-asterisk-s-nulya%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://serveradmin.ru/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fserveradmin.ru%2Fnastroyka-servera-telefonii-asterisk-s-nulya%2F&#038;format=xml" />
<style type="text/css">div#toc_container {background: #f9f9f9;border: 1px solid #aaaaaa;width: 100%;}div#toc_container ul li {font-size: 15px;}</style>		<script type="text/javascript">
			jQuery(document).ready(function($){
				$(document).on('click','.attach_cant_view', function(){
					$("#wpf-msg-box").hide();
					$('#wpforo-load').visible();
					$("#wpf-msg-box p.wpf-msg-box-triangle-right").removeClass("error").removeClass("success");
					$("#wpf-msg-box p.wpf-msg-box-triangle-right").html("<span>Пожалуйста, <a href=\"https://serveradmin.ru/forum/?wpforo=signin\" rel=\"nofollow\">Вход</a> или <a href=\"https://serveradmin.ru/forum/?wpforo=signup\" rel=\"nofollow\">Зарегистрироваться</a></span>");
					$("#wpf-msg-box").show(150).delay(1000);
					$('#wpforo-load').invisible();
				});
			});
		</script>
		
<!-- Google Tag Manager for WordPress by DuracellTomi - http://duracelltomi.com -->
<script data-cfasync="false" type="text/javascript">
	var gtm4wp_datalayer_name = "dataLayer";
	var dataLayer = dataLayer || [];
	dataLayer.push({"pagePostType":"post","pagePostType2":"single-post","pageCategory":["asterisk"],"pageAttributes":["asterisk"],"pagePostAuthor":"Zerox"});
</script>
<script data-cfasync="false">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.'+'js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N32MZXJ');</script>
<!-- End Google Tag Manager -->
<!-- End Google Tag Manager for WordPress by DuracellTomi --><link rel="shortcut icon" href="https://serveradmin.ru/wp-content/uploads/2015/08/favicon.ico" title="Favicon" />	
<!--[if IE]>
<script type="text/javascript">jQuery(document).ready(function (){ jQuery(".menu-item").has("ul").children("a").attr("aria-haspopup", "true");});</script>
<![endif]-->	
<!--[if lt IE 9]>
<script src="https://serveradmin.ru/wp-content/themes/sahifa/js/html5.js"></script>
<script src="https://serveradmin.ru/wp-content/themes/sahifa/js/selectivizr-min.js"></script>
<![endif]-->
<!--[if IE 9]>
<link rel="stylesheet" type="text/css" media="all" href="https://serveradmin.ru/wp-content/themes/sahifa/css/ie9.css" />
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" media="all" href="https://serveradmin.ru/wp-content/themes/sahifa/css/ie8.css" />
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" media="all" href="https://serveradmin.ru/wp-content/themes/sahifa/css/ie7.css" />
<![endif]-->


<meta name="viewport" content="width=device-width, initial-scale=1.0" />

< meta name="referrer" content="origin">

<style type="text/css" media="screen"> 

	
body {
	background-image : url(https://serveradmin.ru/wp-content/themes/sahifa/images/patterns/body-bg15.png);
	background-position: top center;
}

body.single .post .entry a, body.page .post .entry a {
	color: #e6773c;
}
		
</style> 


<!-- BEGIN recaptcha, injected by plugin wp-recaptcha-integration  -->

<!-- END recaptcha -->
</head>
<body id="top" class="post-template-default single single-post postid-2897 single-format-standard">

<div class="wrapper-outer">

	<div class="background-cover"></div>

	<aside id="slide-out">
	
			<div class="search-mobile">
			<form method="get" id="searchform-mobile" action="https://serveradmin.ru/">
				<button class="search-button" type="submit" value="Поищем"><i class="fa fa-search"></i></button>	
				<input type="text" id="s-mobile" name="s" title="Поищем" value="Поищем" onfocus="if (this.value == 'Поищем') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Поищем';}"  />
			</form>
		</div><!-- .search-mobile /-->
		
		
		<div id="mobile-menu" ></div>
	</aside><!-- #slide-out /-->

		<div id="wrapper" class="boxed-all">
		<div class="inner-wrapper">

		<header id="theme-header" class="theme-header">
						<div id="top-nav" class="top-nav">
				<div class="container">

								
				<div class="top-menu"><ul id="menu-menyu-1" class="menu"><li id="menu-item-522" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-522"><a href="//serveradmin.ru/">Главная</a></li>
<li id="menu-item-636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="https://serveradmin.ru/karta-sayta/">Карта сайта</a></li>
<li id="menu-item-1183" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1183"><a href="https://serveradmin.ru/zakazat-statyu/">Заказать статью</a></li>
<li id="menu-item-2592" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2592"><a href="https://serveradmin.ru/uslugi/">Услуги</a></li>
<li id="menu-item-2593" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2593"><a href="https://serveradmin.ru/kontaktyi/">Контакты</a></li>
</ul></div>
						<div class="search-block">
						<form method="get" id="searchform-header" action="https://serveradmin.ru/">
							<button class="search-button" type="submit" value="Поищем"><i class="fa fa-search"></i></button>	
							<input class="search-live" type="text" id="s-header" name="s" title="Поищем" value="Поищем" onfocus="if (this.value == 'Поищем') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Поищем';}"  />
						</form>
					</div><!-- .search-block /-->
			<div class="social-icons">
		<a class="ttip-none" title="Rss" href="https://serveradmin.ru/feed/" target="_blank"><i class="fa fa-rss"></i></a>		
			</div>

		
	
				</div><!-- .container /-->
			</div><!-- .top-menu /-->
			
		<div class="header-content">
		
					<a id="slide-out-open" class="slide-out-open" href="#"><span></span></a>
				
			<div class="logo">
			<h2>								<a title="Системное администрирование" href="https://serveradmin.ru/">
					<img src="https://serveradmin.ru/wp-content/uploads/2015/12/logo-new.png" alt="Системное администрирование"  /><strong>Системное администрирование Сайт содержит статьи, обзоры, инструкции по установке, настройке и администрированию различных информационных систем</strong>
				</a>
			</h2>			</div><!-- .logo /-->
			<div class="e3lan e3lan-top">			
			<a href="https://www.keyweb.ru/products/server/root-virtual-server" title="Виртуальные серверы в Германии" target="_blank">
				<img src="https://serveradmin.ru/wp-content/uploads/2017/07/server_vds.gif" alt="Виртуальные серверы в Германии" />
			</a>
				</div>			<div class="clear"></div>
			
		</div>	
													<nav id="main-nav">
				<div class="container">
				
				
					<div class="main-menu"><ul id="menu-osnovnoe" class="menu"><li id="menu-item-1934" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1934"><a href="//serveradmin.ru">Главная</a></li>
<li id="menu-item-3761" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3761"><a target="_blank" href="https://serveradmin.ru/forum/"><i class="fa fa-comments-o"></i>Форум</a></li>
<li id="menu-item-1921" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1921"><a><i class="fa fa-server"></i>Системы</a>
<ul class="sub-menu menu-sub-content">
	<li id="menu-item-1932" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1932"><a href="https://serveradmin.ru/category/freebsd/">Freebsd</a></li>
	<li id="menu-item-1922" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1922"><a href="https://serveradmin.ru/category/linux/centos/">CentOS</a></li>
	<li id="menu-item-1923" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1923"><a href="https://serveradmin.ru/category/linux/debian/">Debian</a></li>
	<li id="menu-item-1924" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1924"><a href="https://serveradmin.ru/category/windows/">Windows</a></li>
	<li id="menu-item-1925" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1925"><a href="https://serveradmin.ru/category/synology/">Synology</a></li>
</ul>
</li>
<li id="menu-item-5106" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-5106"><a><i class="fa fa-list-ul"></i>Сервисы</a>
<ul class="sub-menu menu-sub-content">
	<li id="menu-item-5114" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5114"><a href="https://serveradmin.ru/tag/sysconfig/">Настройка системы</a></li>
	<li id="menu-item-5112" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5112"><a href="https://serveradmin.ru/tag/gate/">Шлюз</a></li>
	<li id="menu-item-5110" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5110"><a href="https://serveradmin.ru/tag/webserver/">Веб сервер</a></li>
	<li id="menu-item-5107" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5107"><a href="https://serveradmin.ru/tag/mailserver">Почтовый сервер</a></li>
	<li id="menu-item-5702" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5702"><a href="https://serveradmin.ru/tag/fileserver/">Файловый сервер</a></li>
	<li id="menu-item-5113" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5113"><a href="https://serveradmin.ru/tag/backup/">Бэкап</a></li>
</ul>
</li>
<li id="menu-item-1927" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-1927"><a href="https://serveradmin.ru/category/virtual/"><i class="fa fa-cloud"></i>Виртуализация</a>
<ul class="sub-menu menu-sub-content">
	<li id="menu-item-1928" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1928"><a href="https://serveradmin.ru/category/virtual/hyperv/">Hyper-V</a></li>
	<li id="menu-item-1929" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1929"><a href="https://serveradmin.ru/category/virtual/vmware/">VMware</a></li>
	<li id="menu-item-1972" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1972"><a href="https://serveradmin.ru/category/virtual/xenserver/">XenServer</a></li>
	<li id="menu-item-3700" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3700"><a href="https://serveradmin.ru/category/virtual/proxmox/">Proxmox</a></li>
	<li id="menu-item-4903" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-4903"><a href="https://serveradmin.ru/category/virtual/kvm/">KVM</a></li>
</ul>
</li>
<li id="menu-item-1926" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1926"><a href="https://serveradmin.ru/category/mikrotik/"><i class="fa fa-maxcdn"></i>Mikrotik</a></li>
<li id="menu-item-2272" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-2272"><a><i class="fa fa-binoculars"></i>Мониторинг</a>
<ul class="sub-menu menu-sub-content">
	<li id="menu-item-2273" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2273"><a href="https://serveradmin.ru/category/zabbix/">Zabbix</a></li>
</ul>
</li>
<li id="menu-item-3340" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-3340"><a href="https://serveradmin.ru/category/asterisk/"><i class="fa fa-phone-square"></i>Asterisk</a></li>
<li id="menu-item-4832" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-4832"><a href="https://serveradmin.ru/category/1c/"><i class="fa fa-copyright"></i>1C</a></li>
<li id="menu-item-1930" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1930"><a href="https://serveradmin.ru/category/virus/"><i class="fa fa-exclamation-circle"></i>Осторожно, вирус!</a></li>
<li id="menu-item-1931" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1931"><a href="https://serveradmin.ru/category/poleznyie-sovetyi/"><i class="fa fa-cogs"></i>Советы</a></li>
<li id="menu-item-2803" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2803"><a href="https://serveradmin.ru/category/errors/"><i class="fa fa-times-circle"></i>Ошибки</a></li>
<li id="menu-item-3205" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3205"><a href="https://serveradmin.ru/category/lichnoe/"><i class="fa fa-android"></i>Личное</a></li>
</ul></div>					
					
				</div>
			</nav><!-- .main-nav /-->
					</header><!-- #header /-->
	
		
	
	
	<div id="main-content" class="container">
			
		
	
	
		
	<div class="content">
	
				
		<div xmlns:v="http://rdf.data-vocabulary.org/#"  id="crumbs"><span typeof="v:Breadcrumb"><a rel="v:url" property="v:title" class="crumbs-home" href="https://serveradmin.ru">Home</a></span> <span class="delimiter">&raquo;</span> <span typeof="v:Breadcrumb"><a rel="v:url" property="v:title" href="https://serveradmin.ru/category/asterisk/">Asterisk</a></span> <span class="delimiter">&raquo;</span> <span class="current">Asterisk &#8212; SIP АТС для офиса, пошаговая инструкция по настройке с нуля</span></div>
					
				
						
		<article class="post-listing post-2897 post type-post status-publish format-standard has-post-thumbnail hentry category-asterisk tag-asterisk" id="the-post">
			
			<div class="post-inner">
			
							<h1 class="name post-title entry-title" itemprop="itemReviewed" itemscope itemtype="http://schema.org/Thing"><span itemprop="name">Asterisk &#8212; SIP АТС для офиса, пошаговая инструкция по настройке с нуля</span></h1>

						
<p class="post-meta">
	
		
	<span class="tie-date"><i class="fa fa-clock-o"></i>Обновлено: 09.03.2017</span>	
	<span class="post-cats"><i class="fa fa-folder"></i><a href="https://serveradmin.ru/category/asterisk/" rel="category tag">Asterisk</a></span>
	
	<span class="post-comments"><i class="fa fa-comments"></i><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comments">93 комментария</a></span>
<span class="post-views"><i class="fa fa-eye"></i>105,051 Views</span> </p>
<div class="clear"></div>
			
				<div class="entry">
					
					
					<p style="text-align: justify;">Одним из рабочих инструментов офиса, несмотря на стремительные изменения последних десятилетий, по-прежнему является телефон. Мы займемся пошаговой настройкой с нуля АТС asterisk &#8212; современного инструмента для организации телефонии в офисе на основе протокола SIP. Я подробно с примерами и описанием проведу вас по основным параметрам, необходимым для базового функционала.</p>
<p><span id="more-2897"></span></p>
<div id="toc_container" class="no_bullets"><p class="toc_title">Содержание:</p><ul class="toc_list"><li><a href="#i"><span class="toc_number toc_depth_1">1</span> Введение</a></li><li><a href="#i-2"><span class="toc_number toc_depth_1">2</span> Быстрая установка</a></li><li><a href="#_iptables_asterisk_NAT"><span class="toc_number toc_depth_1">3</span> Настройка iptables, asterisk за NAT, проброс портов</a></li><li><a href="#i-3"><span class="toc_number toc_depth_1">4</span> Подключение абонентов и проверка внутренних звонков</a></li><li><a href="#_sip_trunk"><span class="toc_number toc_depth_1">5</span> Настройка sip trunk (транка) и добавление номера</a></li><li><a href="#Dial-plan_8212"><span class="toc_number toc_depth_1">6</span> Dial-plan &#8212; пример маршрутизации звонков</a></li><li><a href="#__ivr"><span class="toc_number toc_depth_1">7</span> Приветствие и голосовое меню (ivr)</a></li><li><a href="#i-4"><span class="toc_number toc_depth_1">8</span> Включаем голосовую почту</a></li><li><a href="#_queues"><span class="toc_number toc_depth_1">9</span> Очереди (queues) входящих звонков</a></li><li><a href="#___cdr_viewer"><span class="toc_number toc_depth_1">10</span> Учет и просмотр статистики звонков (cdr viewer)</a></li><li><a href="#_record"><span class="toc_number toc_depth_1">11</span> Запись (record) разговоров</a></li><li><a href="#__on_hold"><span class="toc_number toc_depth_1">12</span> Музыка на ожидании (on hold)</a></li><li><a href="#i-5"><span class="toc_number toc_depth_1">13</span> Настройка конференций</a></li><li><a href="#i-6"><span class="toc_number toc_depth_1">14</span> Перевод, перехват, переадресация звонка</a></li><li><a href="#_asterisk__fail2ban"><span class="toc_number toc_depth_1">15</span> Защита asterisk с помощью fail2ban</a></li><li><a href="#i-7"><span class="toc_number toc_depth_1">16</span> Заключение</a></li></ul></div>

<h2><span id="i">Введение</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Не буду останавливаться на описании сервера asterisk, в интернете много информации на эту тему. Да и сам я кратко рассказывал в своих предыдущих статьях про <a href="//serveradmin.ru/ustanovka-asterisk-i-freepbx-na-centos-7/" target="_blank">установку</a>. Материал будет объемный, поэтому сразу перейдем к сути.</p>
<p style="text-align: justify;">Статья планируется учебная, поэтому использовать будем голый asterisk без каких-либо web панелей для управления. Выполнять настройку asterisk будем с нуля, то есть с самой начальной установки самого сервера телефонии и всех зависимостей. Если вы разберетесь и освоите этот материал, то потом без проблем сможете настроить и поддерживать любую конфигурацию на основе астериска.</p>
<p style="text-align: justify;">Я хочу подробно рассказать о настройке asterisk на конкретном примере, где будет собран в одном месте расширенный функционал, отвечающий практически на все запросы среднестатистического офиса.</p>
<p style="text-align: justify;"><div class="box warning  "><div class="box-inner-block"><i class="fa tie-shortcode-boxicon"></i>
			Сразу хочу обратить внимание на очень важный момент. Я не являюсь профессионалом в настройке asterisk. Данный материал является калькуляцией всех моих знаний на текущий момент, которые я методично шаг за шагом собирал из доступных в интернете источников. По этой статье вы получите рабочий, многофункциональный сервер телефонии, работу которого я проверял на практике. Но это не означает, что все, что здесь настроено, сделано наилучшим образом. Я постоянно учусь и совершенствую свои знания. Если вы увидите ошибки, недочеты, варианты более правильной и удобной настройки, прошу об этом сообщить в комментариях, я проверю и обновлю статью.
			</div></div>
<p>Для примера опишем наш воображаемый офис:</p>
<ul>
<li>Работает 30 сотрудников. Номера будут трехзначные, от 100 до 130.</li>
<li>У нас будут 3 отдела &#8212; менеджеры, техподдержка, руководство и все остальные.</li>
<li>Номер секретаря 100, менеджеры 101-110, техподдержка 111-120, руководство 121-130.</li>
<li>Мы будем использовать одного SIP провайдера для звонков.</li>
</ul>
<p style="text-align: justify;">Кратко получается такая картина. Я не пишу в самом начале о техническом задании, которое буду реализовывать. Каждый момент буду описывать и раскрывать в соответствующем разделе.</p>
<p style="text-align: justify;">Для настройки я буду использовать учетную запись сервиса <a href="https://zadarma.com" target="_blank">zadarma.com</a>. Сразу скажу, что в реальной работе я никогда не использовал этот сервис и его качество мне не известно. Беру его для примера, потому что удобно использовать для тестирования конфигурации. Сразу после регистрации вам дают аккаунт, пример настроек для asterisk. Вы можете позвонить на прямой городской номер, ввести добавочный и совершить звонок на свой аккаунт. Это полностью эмулируер работу sip подключения от какого-нибудь провайдера.</p>
<p style="text-align: justify;">В качестве операционной системы у меня выступает CentOS 7. Но для данной статьи это не имеет принципиального значения. Конфигурация астериск кроссплатформенная, без проблем переносится между системами.</p>
<p>Приступаем к нашей работе по настройке сервера телефонии.</p>
<h2><span id="i-2">Быстрая установка</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Вопроса <a href="//serveradmin.ru/ustanovka-asterisk-i-freepbx-na-centos-7/" target="_blank">установки asterisk</a> я уже касался в своей прошлой статье. Но там я использовал связку с панелью управления freepbx. Здесь же мы будем использовать голый астериск, без обвязок. Более того, я не буду использовать никаких дополнительных плат расширения и модемов. Будет только софтовая АТС, которая легко переносится с одного сервера на другой при желании. Считаю, что такой подход наиболее эффективен и к нему стоит стремиться. Настроив виртуальную машину, вы навсегда будете отвязаны от конкретного железа и спокойно можете переносить свой сервер куда угодно, заменив только сетевые настройки.</p>
<p style="text-align: justify;">Таким образом, нам нужно установить непосредственно asterisk и pjproject с jansson. На первоначальном этапе этого достаточно. Если вы предпочитаете сервер debian, то воспользуйтесь отдельной инструкцией по установке <a href="https://serveradmin.ru/ustanovka-asterisk-13-na-debian-8/" target="_blank">asterisk 13 на debian 8</a>. После этого можете сразу же переходить на следующий этап настройки. Приступим.</p>
<p>Первым делом обновляем систему и отключаем SELinux, как рассказано в статье про <a href="//serveradmin.ru/centos-7-nastroyka-servera/#_CentOS_7" target="_blank">настройку centos</a>.</p>
<p>Подключаем репозиторий epel и устанавливаем необходимые пакеты, которые нам пригодятся в дальнейшем:</p>
<pre># yum -y install epel-release
# yum -y install lynx mariadb-server mariadb php php-mysql php-mbstring tftp-server httpd ncurses-devel sendmail sendmail-cf sox newt-devel libxml2-devel libtiff-devel audiofile-devel gtk2-devel subversion kernel-devel git php-process crontabs cronie cronie-anacron wget vim php-xml uuid-devel sqlite-devel net-tools gnutls-devel php-pear phpmyadmin
# yum -y groupinstall core base "Development Tools"</pre>
<p>Скачиваем и устанавливаем <strong>pjproject</strong>:</p>
<pre># cd /usr/src
# wget http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2
# tar -xjvf pjproject-2.*
# cd pjproject-2.*
# CFLAGS='-DPJ_HAS_IPV6=1' ./configure --prefix=/usr --enable-shared --disable-sound --disable-resample --disable-video --disable-opencore-amr --libdir=/usr/lib64
# make dep
# make
# make install</pre>
<p>Скачиваем и устанавливаем <strong>jansson</strong>:</p>
<pre># cd /usr/src
# wget -O jansson.tar.gz https://github.com/akheron/jansson/archive/v2.7.tar.gz
# tar vxfz jansson.tar.gz
# cd jansson-*
# autoreconf -i
# ./configure --libdir=/usr/lib64
# make
# make install</pre>
<p>Скачиваем и устанавливаем <strong>asterisk 13</strong>:</p>
<pre># cd /usr/src
# wget http://downloads.asterisk.org/pub/telephony/asterisk/asterisk-13-current.tar.gz
# tar xvfz asterisk-13-current.tar.gz
# cd asterisk-*
# contrib/scripts/install_prereq install
# contrib/scripts/get_mp3_source.sh
# ./configure --libdir=/usr/lib64
# make menuselect</pre>
<p>Выбираем необходимые модули и звуки:</p>
<ul style="list-style-type: square;">
<li><strong>Add-ons</strong>: format_mp3, res_config_mysql, app_mysql и cdr_mysql.</li>
<li><strong>Core Sound Packages</strong>: Выбираем русские звуки RU-WAV.</li>
<li><strong>Music On Hold File Packages</strong>: Выбираем звук WAV.</li>
<li><strong>Extras Sound Packages</strong>: Выбираем английский EN-WAV, русского к сожалению нет.</li>
</ul>
<p><img class="aligncenter wp-image-3238 size-full" src="//serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-01.png" alt="Выбор параметров установки" width="1099" height="584" srcset="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-01.png 1099w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-01-300x159.png 300w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-01-768x408.png 768w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-01-1024x544.png 1024w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-01-310x165.png 310w" sizes="(max-width: 1099px) 100vw, 1099px" /></p>
<p style="text-align: justify;">Все остальные настройки оставляем по-умолчанию. Ставится много модулей. Все они не нужны, но мало ли, пригодится что-то в будущем. Неиспользуемые модули можно будет потом отключить в конфигурации.</p>
<p>Продолжаем установку:</p>
<pre># make
# make install
# make samples
# make config
# ldconfig</pre>
<p>Устанавливаем русскую <strong>core</strong> озвучку хорошего качества и английскую для <strong>extra</strong>, русской к сожалению нету:</p>
<pre># cd /var/lib/asterisk/sounds
# wget http://downloads.asterisk.org/pub/telephony/sounds/asterisk-core-sounds-ru-wav-current.tar.gz
# wget http://downloads.asterisk.org/pub/telephony/sounds/asterisk-extra-sounds-en-wav-current.tar.gz
# tar xvf asterisk-core-sounds-ru-wav-current.tar.gz
# tar xvf asterisk-extra-sounds-en-wav-current.tar.gz</pre>
<p>Добавляем астериск в автозагрузку и запускаем:</p>
<pre># chkconfig asterisk on
# service asterisk start</pre>
<p>Проверим, запустился ли он, зайдя в консоль:</p>
<pre># asterisk -r</pre>
<p><img class="aligncenter wp-image-3239 size-full" src="//serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-02.png" alt="Проверка работы asterisk" width="719" height="198" srcset="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-02.png 719w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-02-300x83.png 300w" sizes="(max-width: 719px) 100vw, 719px" /></p>
<p>Если получили такой же вывод команды, значит все в порядке, астериск установлен.</p>
<h2><span id="_iptables_asterisk_NAT">Настройка iptables, asterisk за NAT, проброс портов</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Сразу же уделим внимание настройке iptables для работы астериск. У нас может быть 2 ситуации, которые требуют двух принципиально различных настроек:</p>
<ol>
<li>Сервер телефонии имеет свой внешний ip адрес и напрямую смотрит через него в интернет.</li>
<li>Сервер стоит за шлюзом, не имеет своего внешнего адреса, доступ в интернет с помощью NAT.</li>
</ol>
<p style="text-align: justify;">В первом случае нам нужно открыть на iptables необходимые порты для работы, все остальное закрыть. Подробно вопрос <a href="//serveradmin.ru/nastroyka-iptables-v-centos-7/" target="_blank">настройки iptables</a> я рассматривал в отдельной статье. Там есть примеры и пояснения, рассказан мой подход к настройке.</p>
<p style="text-align: justify;">Я не могу привести универсальные настройки для всех случаев. У каждого будут свои нюансы. Кто-то, к примеру, будет пользоваться phpmyadmin для настройки базы mysql для хранения статистики звонков. Потом эту же статистику будет просматривать через cdr viewer, установленный на веб сервере. Доступ к этому веб серверу можно открыть через внешний IP адрес, а можно только через локальную сеть. Настройки iptables в данном случае будут разные.</p>
<p style="text-align: justify;">В моем примере сервер будет находиться в локальной сети офиса за nat. Доступ в интернет осуществляется через офисный шлюз, на котором установлены iptables. На нем будет сделан проброс необходимых портов для работы внешних телефонных аппаратов. В случае, если у вас все телефоны будут находиться в локальной сети офиса вместе с сервером телефонии, пробрасывать ничего не нужно. С сервисом zadarma все будет работать без проброса портов. Пиры зарегистрируются на внешнем сервере провайдера и этого будет достаточно для приема и совершения звонков.</p>
<p style="text-align: justify;">С другими провайдерами этого может быть не достаточно. В общем случае для настройки asterisk за nat нужно будет на шлюзе пробросить порт 5060 и диапазон 10000:20000. По-умолчанию астериск использует UDP порты. Если вы не будете менять эти настройки, то пробрасывать нужно именно UDP.</p>
<p>В моем случае получается следующая картина. На шлюзе сделан проброс необходимых портов:</p>
<pre>iptables -t nat -A PREROUTING -p udp --dst $WAN_IP --dport 5060 -j DNAT --to 192.168.1.25:5060
iptables -t nat -A PREROUTING -p udp --dst $WAN_IP --dport 10000:20000 -j DNAT --to 192.168.1.25</pre>
<table>
<tbody>
<tr>
<td>$WAN_IP</td>
<td>Внешний IP адрес на шлюзе</td>
</tr>
<tr>
<td>192.168.1.25</td>
<td>Локальный адрес сервера астериск</td>
</tr>
</tbody>
</table>
<p style="text-align: justify;">Настройкой фаервола на самом астериске я не хочу сейчас заниматься, статья и так масштабная получается. С этим без проблем можно разобраться с помощью моей статьи по iptables, ссылку на которую я привел в начале раздела. Нужно просто открыть указанные выше порты, и любые другие, которые будут использоваться на сервере.</p>
<h2><span id="i-3">Подключение абонентов и проверка внутренних звонков</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Астериск у нас установлен, firewall настроен. Можно попробовать подключиться и протестировать работу АТС. Я для отладки использую бесплатную софтовую звонилку 3CXPhone 6-й версии. Не знаю, где ее сейчас найти в интернете. У самого производителя давно уже вышли более новые и платные версии, которые работают только с его АТС. А эта версия универсальная. В ней отличный функционал, удобные настройки, есть дебаг режим с подробным логированием. Пользоваться программой удобно и приятно. <a href="https://yadi.sk/d/isxyAx3Qo7gTD" target="_blank">Скачиваем</a> ее у меня и устанавливаем.</p>
<p style="text-align: justify;">Теперь нам нужно сделать некоторые общие настройки и добавить пользователей. Работать будем с файлом конфигурации <em>/etc/asterisk/sip.conf</em>. Файлы настроек астера хорошо закомментированы, но мне это мешает с ними работать. Они слишком большие и громоздкие, неудобно прокручивать вверх и вниз, поэтому я их полностью чищу и вношу только те настройки, которые мне нужны. Так удобнее и нагляднее получается. Сохраните на всякий случай куда-нибудь оригинальный файл <em>sip.conf</em> и начинайте новую настройку. Вот мой пример конфига для нашего случая:</p>
<pre>[general]
;Внешний ip адрес
externaddr=212.78.136.18:5060
;Указываем использовать русскую озвучку
language=ru
context=default
allowoverlap=no
udpbindaddr=0.0.0.0
tcpenable=no
tcpbindaddr=0.0.0.0
transport=udp
srvlookup=yes
allowguest=no
limitonpeers=yes

[authentication]

;Создаем шаблон для телефонов менеджеров
[managers-phones](!)
type=friend
context=call-out
secret=123
host=dynamic
nat=no
qualify=yes
canreinvite=no
callgroup=1
pickupgroup=1
call-limit=1
dtmfmode=auto
disallow=all
allow=alaw
allow=ulaw
allow=g729
allow=g723
allow=g722

;Создаем пользователей менеджеров
[100](managers-phones)
callerid="Number 100" &lt;100&gt;
[101](managers-phones)
callerid="Number 101" &lt;101&gt;
[102](managers-phones)
callerid="Number 102" &lt;102&gt;
[103](managers-phones)
callerid="Number 103" &lt;103&gt;
[104](managers-phones)
callerid="Number 104" &lt;104&gt;
[105](managers-phones)
callerid="Number 105" &lt;105&gt;
[106](managers-phones)
callerid="Number 106" &lt;106&gt;
[107](managers-phones)
callerid="Number 107" &lt;107&gt;
[108](managers-phones)
callerid="Number 108" &lt;108&gt;
[109](managers-phones)
callerid="Number 109" &lt;109&gt;
[110](managers-phones)
callerid="Number 110" &lt;110&gt;

;Создаем шаблон для телефонов поддержки
[support-phones](!)
type=friend
context=call-out
secret=456
host=dynamic
nat=no
qualify=yes
canreinvite=no
callgroup=2
pickupgroup=2
call-limit=1
dtmfmode=auto
disallow=all
allow=alaw
allow=ulaw
allow=g729
allow=g723
allow=g722

;Создаем пользователей техподдержки
[111](support-phones)
callerid="Number 111" &lt;111&gt;
[112](support-phones)
callerid="Number 112" &lt;112&gt;
[113](support-phones)
callerid="Number 113" &lt;113&gt;
[114](support-phones)
callerid="Number 114" &lt;114&gt;
[115](support-phones)
callerid="Number 115" &lt;115&gt;
[116](support-phones)
callerid="Number 116" &lt;116&gt;
[117](support-phones)
callerid="Number 117" &lt;117&gt;
[118](support-phones)
callerid="Number 118" &lt;118&gt;
[119](support-phones)
callerid="Number 119" &lt;119&gt;
[120](support-phones)
callerid="Number 120" &lt;120&gt;

;Создаем шаблон для телефонов топов
[top-phones](!)
type=friend
context=call-out
secret=789
host=dynamic
nat=no
qualify=yes
canreinvite=no
callgroup=3
pickupgroup=3
call-limit=1
dtmfmode=auto
disallow=all
allow=alaw
allow=ulaw
allow=g729
allow=g723
allow=g722

;Создаем пользователей топов
[121](top-phones)
callerid="Number 111" &lt;121&gt;
[122](top-phones)
callerid="Number 122" &lt;122&gt;
[123](top-phones)
callerid="Number 123" &lt;123&gt;
[124](top-phones)
callerid="Number 124" &lt;124&gt;
[125](top-phones)
callerid="Number 125" &lt;125&gt;
[126](top-phones)
callerid="Number 126" &lt;126&gt;
[127](top-phones)
callerid="Number 127" &lt;127&gt;
[128](top-phones)
callerid="Number 128" &lt;128&gt;
[129](top-phones)
callerid="Number 129" &lt;129&gt;
[130](top-phones)
callerid="Number 130" &lt;130&gt;</pre>
<p style="text-align: justify;">Я немного пояснил комментариями отдельные моменты. Чтобы сократить размер <strong>sip.conf</strong>, я использую шаблоны групп номеров, где задаю общие настройки для группы. Затем просто создаю пользователей и указываю их принадлежность к группе. Они берут все настройки этой группы. Если вам необходимо будет задать отдельные настройки для какого-то пользователя, как у меня, к примеру, <strong>callerid</strong>, то вы просто в его разделе указываете эти настройки.</p>
<p style="text-align: justify;">У меня стоит один и тот же пароль для всей группы. Это удобно, если все телефоны стационарные и стоят в офисе, настраивают их только сисадмины. Делать каждому персональный пароль особого смысла нет. Если вам это не нужно, то указывайте персональный пароль для каждого пользователя. Я просто привожу примеры использования тех или иных настроек, но не призываю делать так же, как я. Во многих случаях так делать нельзя. Уточню еще некоторые нюансы.</p>
<ul style="list-style-type: square;">
<li style="text-align: justify;">Параметры <strong>callgroup</strong> и <strong>pickupgroup</strong> задают группы перехвата звонков. Люди из одной группы могут перехватывать звонки друг друга. Удобно заводить в одну группу людей, сидящих в одной комнате. Так они видят, что человека нет на месте и перехватывают его звонок. Эти параметры можно индивидуально задать для каждого пользователя в отдельности, если разбивка по шаблонам настроек не соответствует реальной рассадке людей в офисе.</li>
<li style="text-align: justify;">Параметр <strong>callerid</strong> можно задать кириллицей, но могут возникнуть проблемы с некоторыми телефонами и точно возникнут проблемы, когда вы будете вести статистику звонков в mysql. Я не смог победить эту проблему с кодировками, поэтому использую только латиницу в этом параметре. Туда можно писать либо должность, либо ФИО человека.</li>
<li style="text-align: justify;"><strong>call-limit</strong>=1 задает количество одновременных соединений на линию. Если у вас один человек = один телефонный аппарат, то разрешать больше одной линии на пользователя нет смысла. Ему будет идти новый звонок в тот момент, как он разговаривает. Конечно, если есть необходимость переключаться между разговорами и ставить кого-то на удержание, то можно делать и больше линий. Но мне кажется, это неудобно. Если ты разговариваешь, пусть звонящий лучше услышит занято и перезвонит.</li>
<li style="text-align: justify;">Я всех добавляю в один context. В данном примере у нас будет только один номер телефона на всех. Если у вас их будет несколько, то контекстами можно будет разводить звонки на разные номера. Эту ситуацию я рассмотрю в отдельной статье.</li>
</ul>
<p style="text-align: justify;">Сохраняем <em>sip.conf</em>. Теперь нам нужно добавить план звонков, для того, чтобы можно было совершать вызовы. Для этого как и с предыдущим конфигурационным файлом, очищаем файл <em>extensions.conf</em> и записываем туда следующую информацию:</p>
<pre>[general]
static=yes
writeprotect=no
[globals]
[default]

;Вешаем трубку
[handup-sip]
exten =&gt; _X!,1,HangUp()

;Исходящие звонки
[call-out]
;Звонок на внутренний номер
exten =&gt; _XXX,1,Dial(SIP/${EXTEN})
include =&gt; handup-sip</pre>
<p style="text-align: justify;">Мы просто добавили один план звонков на трехзначные номера. Я сразу добавляю комментарии с заделом на дальнейшее расширение этого файла, чтобы потом было проще разбираться. Сохраняем файл.</p>
<p>У нас все готово для внутренних звонков через asterisk. Заходим в консоль и перезагружаем его:</p>
<pre># asterisk -r</pre>
<pre>CLI&gt; reload</pre>
<p style="text-align: justify;">Вы увидите некоторые предупреждения и ошибки. Это не страшно, так и должно быть, так как мы многое еще не настроили. Загружаются модули, которым не хватает настроек. Проверим список созданных пользователей с помощью команды в консоли:</p>
<pre>CLI&gt; sip show users</pre>
<p><img class="aligncenter wp-image-3240 size-full" src="//serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-03.png" alt="sip show users" width="784" height="568" srcset="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-03.png 784w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-03-300x217.png 300w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-03-768x556.png 768w" sizes="(max-width: 784px) 100vw, 784px" /></p>
<p style="text-align: justify;">Видим всех наших пользователей, их пароли и контекст. Список отсортирован не по порядку, не пугайтесь, если не заметите какой-то номер.</p>
<p style="text-align: justify;">Дальше устанавливайте любую софтовую звонилку на компьютер или можете сразу использовать телефон, если он у вас под рукой. С телефонами удобнее, но не всегда они есть. В <strong>3CXPhone</strong> задаем следующие настройки подключения к нашей ip атс:</p>
<p><img class="aligncenter wp-image-3241 size-full" src="//serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-04.png" alt="Пример подключения телефона к asterisk" width="423" height="610" srcset="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-04.png 423w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-04-208x300.png 208w" sizes="(max-width: 423px) 100vw, 423px" /></p>
<p>Я сразу открываю дебаг окно для отладки. Корректное подключение к серверу будет выглядеть вот так:</p>
<p><img class="aligncenter wp-image-3242 size-full" src="//serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-05.png" alt="Подключение 3CXPhone к астериск" width="835" height="578" srcset="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-05.png 835w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-05-300x208.png 300w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-05-768x532.png 768w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-05-110x75.png 110w" sizes="(max-width: 835px) 100vw, 835px" /></p>
<p>Проверим на сервере список подключенных пиров с помощью команды:</p>
<pre>CLI&gt; sip show peers</pre>
<p>Должна быть строка с подключенным пиром:</p>
<pre>100/100                   192.168.1.100                            D  No         No             59891    OK (104 ms)</pre>
<p style="text-align: justify;">Если у вас так же, то все в порядке. Чтобы протестировать звонки, нам нужно подключить двух абонентов. Настраивайте еще один телефон или софтофон. Проверяйте в списке подключенных пиров чтобы было 2 подключения и попробуйте позвонить друг другу. Если вы все сделали правильно, то локальные звонки должны работать.</p>
<p>После звонка в файле <em>/var/log/asterisk/cdr-csv/Master.csv</em> появится запись о совершенном звонке:</p>
<pre>"","100","121","call-out","""Number 100"" &lt;100&gt;","SIP/100-00000000","SIP/121-00000001","Dial","SIP/121","2016-04-21 12:32:37","2016-04-21 12:32:42","2016-04-21 12:32:46",9,4,"ANSWERED","DOCUMENTATION","1461241957.0",""</pre>
<p style="text-align: justify;">В этом файле будет накапливаться статистика звонков. Позже мы перенесем ее в mysql. Я позвонил с номера 100 на номер 121, там мне ответили. В файле отражены все основные данные этого звонка.</p>
<p>Один небольшой шажок по настройке voip атс asterisk мы сделали. Будем двигаться дальше.</p>
<h2><span id="_sip_trunk">Настройка sip trunk (транка) и добавление номера</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Регистрируемся у какого-нибудь sip провайдера и получаем настройки транков для подключения. Как я говорил выше, я буду использовать провайдера <strong>zadarma</strong>. После регистрации в личном кабинете я вижу свой логин, пароль для подключения и адрес сервера. Там же можно узнать <a href="https://zadarma.com/en/support/instructions/asterisk/" target="_blank">пример</a> настройки подключения для астериска и номера для тестовых звонков:</p>
<ul style="list-style-type: square;">
<li>Номер для эхо-теста: 4444.</li>
<li>Информация про остаток на счету: 1111</li>
<li>Прямой звонок: Москва +7 (495) 777-66-75 и внутренний номер клиента (логин)</li>
</ul>
<p style="text-align: justify;">Нам этого будет достаточно для полноценного тестирования конфигурации астериска. Добавляем необходимые настройки sip транка, чтобы выполнить его регистрацию. Редактируем <em>sip.conf</em>, добавляем в самый конец нового пира в соответствии с инструкцией провайдера:</p>
<pre>[397945]
host=sip.zadarma.com
insecure=invite,port
type=friend
fromdomain=sip.zadarma.com
disallow=all
allow=alaw
dtmfmode=auto
secret=password
defaultuser=397945
trunkname=397945
fromuser=397945
callbackextension=397945
context=call-in
qualify=400
directmedia=no
nat=force_rport,comedia</pre>
<p>В данном случае <strong>397945</strong> мой внутренний номер в сервисе, password &#8212; пароль. Сохраняем файл и даем команду астеру перечиать его:</p>
<pre>CLI&gt; sip reload</pre>
<p>Тут же в консоли, если все в порядке, вы получите сообщение:</p>
<pre>chan_sip.c:24403 handle_response_peerpoke: Peer '397945' is now Reachable. (55ms / 400ms)</pre>
<p>Это означает, что наш пир успешно зарегистрировался у провайдера. Проверить это можно с помощью уже известной команды:</p>
<pre>CLI&gt; sip show peers
397945/397945             185.45.152.161                              Auto (No)  No             5060     OK (54 ms)</pre>
<p>Все, транк настроили, по сути подключили номер. Но этого не достаточно, чтобы совершать и принимать звонки. Надо отредактировать <strong>dialplan</strong>.</p>
<h2><span id="Dial-plan_8212">Dial-plan &#8212; пример маршрутизации звонков</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Начало построения диалплана для маршрутизации звонков мы уже положили, когда настраивали внутренние звонки. Теперь нужно дополнить <strong>dial-plan</strong> для совершения исходящих и приема входящих звонков. Редактируем <em>extensions.conf </em>и приводим его к следующему виду:</p>
<pre>[general]
static=yes
writeprotect=no
[globals]
[default]

;Вешаем трубку
[handup-sip]
exten =&gt; _X!,1,HangUp()

;Исходящие звонки
[call-out]
;Звонок на внутренний номер
exten =&gt; _XXX,1,Dial(SIP/${EXTEN})
;Звонок на внешний номер
<span style="color: #0000ff;">exten =&gt; _XXX.,1,Dial(SIP/${EXTEN}@397945)

</span>include =&gt; handup-sip

;Входящие звонки
<span style="color: #0000ff;">[call-in]</span>
<span style="color: #0000ff;">exten =&gt; 397945,1,Dial(SIP/100)</span></pre>
<p>Я выложил полную версию файла, а не только то, что добавил. Добавленные строки выделил цветом.</p>
<p style="text-align: justify;">В нашем примере в контекст исходящих звонков мы добавили правило набора любого номера длиннее трех символов через транк 397954. Если в локальных звонках маска экстеншена задается тремя любыми символами, то тут мы в конец добавили точку, которая означает любое количество символов.</p>
<p style="text-align: justify;">С таким диалпланом при наборе трехзначного номера вы позвоните на локальный номер, а при наборе любого городского номера сможете позвонить на него без каких-либо добавочных цифр. Сразу набираете номер с 8 и так далее.</p>
<p style="text-align: justify;">Контекст [call-in] описывает поведение при входящем звонке. В нашем случае все входящие звонки с транка 397945 будут направляться на номер секретаря 100. К этому контексту мы еще вернемся позже, когда будем настраивать голосовое меню.</p>
<p>Сохраняем dial-plan и перезагружаем астериск единой командой reload, либо отдельно перезагружаем sip и dialplan командами:</p>
<pre>CLI&gt; sip reload
CLI&gt; dialplan reload</pre>
<p style="text-align: justify;">Теперь можно попробовать позвонить, к примеру, на тестовый номер zadarma &#8212; 4444 для эхотеста. Если все получилось, значит вы правильно настроили исходящие звонки. Для проверки входящего звонка, позвоните в Москве на номер +7 (495) 777-66-75 и введите свой добавочный номер в виде логина. Звонок должен переключиться на номер 100. Чтобы это произошло, необходимо, чтобы peer с номером 100 был подключен к астериску.</p>
<p style="text-align: justify;">Я проверил, без проблем дозвонился и по исходящему номеру, и по входящему. В файле <em>Master.csv</em> появилась информация о совершенных звонках:</p>
<pre>"","100","4444","call-out","""Number 100"" &lt;100&gt;","SIP/100-00000002","SIP/397945-00000003","Dial","SIP/4444@397945","2016-04-21 14:07:05","2016-04-21 14:07:05","2016-04-21 14:07:34",28,28,"ANSWERED","DOCUMENTATION","1461247625.3",""
"","79998056609","397945","call-in","""79998056609"" &lt;79998056609&gt;","SIP/397945-00000004","SIP/100-00000005","Dial","SIP/100","2016-04-21 14:09:32","2016-04-21 14:09:40","2016-04-21 14:09:44",12,4,"ANSWERED","DOCUMENTATION","1461247772.6",""</pre>
<p>После звонков в консоли астера и в логе <em>/var/log/asterisk/messages</em> вы увидите множество ошибок:</p>
<pre>res_hep.c: Unable to send packet: Address Family mismatch between source/destination</pre>
<p>Чтобы их не было, вам нужно на сервере <a href="//serveradmin.ru/nastroyka-seti-v-centos/#_ipv6_CentOS_7" target="_blank">отключить протокол ipv6</a>.</p>
<p style="text-align: justify;">В таком виде АТС уже вполне работоспособна, можно пользоваться, но есть ряд неудобств. Например, если позвонить на трехзначный номер, которого не существует, или на номер, который не зарегистрирован в данный момент на устройстве, вы просто получите сброс звонка и не поймете, в чем проблема. Для этих событий нужна отдельная обработка. Чтобы не загружать сразу файл конфигурации длинными и непонятными конструкциями, я рассмотрю этот момент ниже, когда буду рассказывать про голосовую почту. Это не критичная настройка, в таком виде все будет замечательно работать, но не так удобно, как могло бы.</p>
<h2><span id="__ivr">Приветствие и голосовое меню (ivr)</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Основной функционал asterisk реализован. Будем его расширять. Практически на всех АТС присутствует голосовое меню, которое встречает звонящего. Я рассмотрю настройку самого простого варианта голосового меню, как его еще называют <strong>ivr</strong>. Позвонив, человек услышит какое-то приветствие, далее ему будет предложено ввести внутренний номер абонента, если он его знает, либо дождаться ответа секретаря.</p>
<p style="text-align: justify;">Для простоты настройки и отладки, поделюсь способом, который использую я. У проекта zadarma есть клиент под андроид &#8212; <strong>Zadarma SIP</strong>. Скачиваете его на телефон и регистрируете еще одну учетную запись в проекте. Логинитесь под ней в телефоне и можете звонить на свой астериск, просто набирая 6-ти значный номер аккаунта, который используете на сервере. Таким образом вы быстро, удобно и бесплатно эмулируете входящие звонки с внешних линий на свой сервер.</p>
<p style="text-align: justify;">Начнем настройку с того, что создадим возможность для записи приветствия. Вы можете записать его где угодно и потом скопировать на сервер astersik. Но можно поступить удобнее &#8212; записать прямо с телефонного аппарата приветствие и использовать его в голосовом меню. Чтобы это сделать, необходимо добавить в dialplan в контекст исходящих звонков, в моем примере это [call-out], в самое начало следующую конструкцию:</p>
<pre>;Номер для записи звуков, окончание записи #
exten =&gt; _35X, 1, NoOp()
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Playback(beep)
exten =&gt; _35X, n, Record(/tmp/music${EXTEN:2}:wav)
exten =&gt; _35X, n, Wait(1)
exten =&gt; _35X, n, Playback(/tmp/music${EXTEN:2})
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Hangup()</pre>
<p>Перезагружаем dialplan:</p>
<pre>CLI&gt; dialplan reload</pre>
<p style="text-align: justify;">Теперь при звонке на любой из номеров 350-359 вы услышите бип, после которого начнется запись всего, что сказано в трубку. Чтобы завершить запись, нажмите <strong>#</strong>. После этого вы прослушаете то, что было записано. Файл с записью будет сохранен в папку /temp. Если вы позвоните на номер 351, то файл будет иметь имя music1.wav, если на 355, то music5.wav. Можно записать до 10-ти разных вариантов и потом из них выбирать.</p>
<p style="text-align: justify;">Сохраните подходящую запись с именем <em>ivr-main.wav</em> и разместите его в какой-нибудь папке. Я положил в папку <em>/etc/asterisk/ivr</em>. Добавим пример голосового меню в нашу конфигурацию asterisk. Для этого снова открываем <em>extensions.conf</em> и добавляем в него новый контекст [ivr-main] следующего содержания:</p>
<pre>[ivr-main]
exten =&gt; s,1,Answer()
;Проигрываем приветствие
exten =&gt; s,2,Background(/etc/asterisk/ivr/ivr-main)
;Ждем 5 секунд ввода добавочного номера
exten =&gt; s,3,WaitExten(5)
;Звоним по введенному добавочному
exten =&gt; _XXX,1,Dial(SIP/${EXTEN})
;Если введен не существующий номер, то говорим об этом и отправляем в начало приветствия
exten =&gt; _XXX,2,Playback(privacy-incorrect)
exten =&gt; _XXX,3,Goto(ivr-main,s,1)
;Если звонящий ничего не вводит, то звоним секретарю
exten =&gt; t,1,Dial(SIP/100)</pre>
<p style="text-align: justify;">В комментариях я сделал все пояснения. Мы создали контекст для ivr. Теперь его надо добавить в контекст входящих звонков. Для этого изменяем существующий контекст [call-in], заменяя в нем единственную строку на новую:</p>
<pre>exten =&gt; 397945,1,Goto(ivr-main,s,1)</pre>
<p style="text-align: justify;">Перезапускаем диал план и звоним снаружи на внешний номер. Вы должны услышать голосовое приветствие ivr, которое мы только что настроили. После этого этапа ваш файл <em>extensions.conf</em> должен выглядеть примерно так (комментарии вырезал):</p>
<pre>[general]
static=yes
writeprotect=no
[globals]
[default]

[handup-sip]
exten =&gt; _X!,1,HangUp()

[call-out]
exten =&gt; _35X, 1, NoOp()
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Playback(beep)
exten =&gt; _35X, n, Record(/tmp/music${EXTEN:2}:wav)
exten =&gt; _35X, n, Wait(1)
exten =&gt; _35X, n, Playback(/tmp/music${EXTEN:2})
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Hangup()
exten =&gt; _XXX,1,Dial(SIP/${EXTEN})
exten =&gt; _XXX.,1,Dial(SIP/${EXTEN}@397945)
include =&gt; handup-sip

[call-in]
exten =&gt; 397945,1,Goto(ivr-main,s,1)

[ivr-main]
exten =&gt; s,1,Answer()
exten =&gt; s,2,Background(/etc/asterisk/ivr/ivr-main)
exten =&gt; s,3,WaitExten(5)
exten =&gt; _XXX,1,Dial(SIP/${EXTEN})
exten =&gt; _XXX,2,Playback(privacy-incorrect)
exten =&gt; _XXX,3,Goto(ivr-main,s,1)
exten =&gt; t,1,Dial(SIP/100)</pre>
<h2><span id="i-4">Включаем голосовую почту</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Продолжаем наращивать функционал voip атс. В данном разделе опишу настройку голосовой почты в asterisk. Для начала пару слов о том, что это такое. Если адресат звонка долго не отвечает, мы можем предложить звонящему оставить для него голосовое сообщение. Когда получатель вернется на место, он сможет прослушать оставленные ему сообщения. При этом, после записи голосового сообщения, будет отправлено письмо с записью этого сообщения на почтовый адрес получателя.</p>
<p style="text-align: justify;">На практике я не видел, чтобы голосовую почту активно использовали. Но для полноты картины расскажу про нее, возможно вам она пригодится. Открываем файл <em>voicemail.conf</em> на редактирование. Я не трогал настройки по-умолчанию, просто добавляем в секцию [default] ящики голосовой почты для нужных нам сотрудников в следующем виде:</p>
<pre>130 =&gt; 1234,Number 130,user130@mail.ru
100 =&gt; 1234,Number 100,user100@mail.ru</pre>
<table style="width: 901px;">
<tbody>
<tr>
<td style="width: 166px;">130</td>
<td style="width: 721px;">внутренний номер абонента</td>
</tr>
<tr>
<td style="width: 166px;">1234</td>
<td style="width: 721px;">пароль доступа к ящику голосовой почты</td>
</tr>
<tr>
<td style="width: 166px;">user130@mail.ru</td>
<td style="width: 721px;">почтовый адрес, куда будет отправлено записанное голосовое сообщение</td>
</tr>
</tbody>
</table>
<p>Для корректной отправки почтовых сообщений сразу на внешние почтовые ящики необходимо правильно настроить локальный почтовый сервер, либо использовать внешний. Я рекомендую использовать отдельный сервер, наверняка он есть в организации, либо на локальном использовать какой-то публичный с авторизацией по smtp.</p>
<p>В консоли перезапускаем модуль голосовой почты и проверяем пользователей:</p>
<pre>CLI&gt; voicemail reload
Reloading voicemail configuration...
asterisk*CLI&gt; voicemail show users
Context Mbox User Zone NewMsg
default 130 Number 121 0
default 100 Number 100 0
other 1234 Company2 User 0
3 voicemail users configured.</pre>
<p style="text-align: justify;">Наши два добавленных пользователя и один тестовый остался из дефолтной конфигурации. Его можно удалить. Их вообще два должно быть. Одного я уже удалил, второго забыл.</p>
<p style="text-align: justify;">Это пол дела. Теперь нам нужно добавить голосовую почту в dialplan. Причем в 2 разных места. Я буду использовать номер 500 для звонка в панель управления голосовой почтой. Позвонив на этот номер, пользователь введет свой пароль и сможет управлять голосовыми сообщениями (слушать, удалять, менять настройки). Добавим в контекст для исходящих звонков звонок на этот номер. Добавлять следует сразу за номерами для записи, которые мы ранее создали и перед правилом набора трехзначных номеров.</p>
<pre>[call-out]
;Номер для записи звуков, окончание записи #
exten =&gt; _35X, 1, NoOp()
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Playback(beep)
exten =&gt; _35X, n, Record(/tmp/music${EXTEN:2}:wav)
exten =&gt; _35X, n, Wait(1)
exten =&gt; _35X, n, Playback(/tmp/music${EXTEN:2})
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Hangup()
;Управление голосовой почтой
<span style="color: #0000ff;">exten =&gt; 500,1,VoiceMailMain()</span>
;Звонок на внутренний номер
exten =&gt; _XXX,1,Dial(SIP/${EXTEN},<span style="color: #0000ff;">15)</span>
;Звонок на внешний номер
exten =&gt; _XXX.,1,Dial(SIP/${EXTEN}@397945)</pre>
<p style="text-align: justify;">Добавленные данные выделил цветом. Обращаю внимание на цифру <strong>15</strong>. Ранее этой настройки не было, сейчас я добавил. Она будет означать, что звонок будет длиться 15 секунд. Если за это время никто не ответит, он будет сброшен. До использования голосовой почты, можно было не устанавливать этот параметр, оставить его значение по-умолчанию, оно очень большое, не помню точно сколько по времени. Но сейчас нам нужно при неснятии трубки дольше 15-ти секунд, включать запись голосового сообщения.</p>
<p style="text-align: justify;">Конкретно в контексте внутренних звонков этот параметр не принципиален, так как я не добавляю голосовую почту для звонков внутри организации, хотя можно это сделать. Не вижу в этом смысла. Я добавил сюда этот параметр, чтобы время ожидания ответа было одинаково во всех звонках. В следующих изменениях это уже будет играть принципиальное значение.</p>
<p style="text-align: justify;">Пока мы просто добавили номер, куда можно позвонить для управления голосовой почтой. Теперь добавим непосредственно возможность записи голосовых сообщений по событиям. Остановимся на этом пункте поподробнее. Для начала уясним, в каких состояниях может пребывать номер:</p>
<ol>
<li>Номера вообще не существует на сервере. В нашем случае, к примеру, это любой номер не из диапазона 100-130.</li>
<li>Номер существует, но он не зарегистрирован на АТС, то есть аппарат с этим номером не подключен.</li>
<li>Номер существует, зарегистрирован, но при звонке на него никто не отвечает.</li>
<li>Номер существует, зарегистрирован, но в данный момент занят.</li>
</ol>
<p style="text-align: justify;">Каждое из этих четырех состояний обрабатывается отдельно. Я считаю, что голосовую почту уместно будет включать по событию номер 3. Но это не обязательно, можно и на занято повесить возможность оставить сообщение. Тут на ваше усмотрение. Я покажу пример, как это делается, а вы сможете настроить так, как вам нужно.</p>
<p style="text-align: justify;">Обработка этих событий не такая простая, как кажется на первый взгляд. Я сразу же столкнулся с трудностью следующего характера. С параметром call-limit=1 при звонке на номер, который занят в данный момент, астериск возвращает статус CHANUNAVAIL, что может означать, к примеру, что канал недоступен. На статус занято BUSY это совсем не похоже. Для разрешения этой ситуации я воспользуюсь функцией <strong>ChanIsAvail, </strong>которая проверяет не статус пира, а статус канала и возвращает значение 2 или 3, когда он занят.</p>
<p>Для различения несуществующих и не подключенных пиров я буду использовать функцию <strong>SIPPEER</strong>. Если она ничего не возвращает, значит номера не существует, если значение UNKNOWN, значит номер не подключен. С отсутствием ответа какое-то время проще всего. Если пир возвращает статус NOANSWER, включаем голосовую почту. Собираем все статусы в одно место и добавляем голосовую почту.</p>
<p>Для этого в контекст [ivr-main] добавляем новые параметры и приводим его к следующему виду:</p>
<pre>[ivr-main]
exten =&gt; s,1,Answer()
exten =&gt; s,2,Background(/etc/asterisk/ivr/ivr-main)
exten =&gt; s,3,WaitExten(5)
exten =&gt; _XXX,1,Dial(SIP/${EXTEN},15)
;Задаем переменную для передачи в голосовую почту
exten =&gt; _XXX,n,Set(dstNUM=${EXTEN})
;Проверяем статус пира, существует или нет
exten =&gt; _XXX,n,GotoIf($["${SIPPEER(${EXTEN},status)}" = ""]?num-not-exist,1)
;Проверяем статус пира, подключен или нет
exten =&gt; _XXX,n,GotoIf($["${SIPPEER(${EXTEN},status):0:2}" = "UN"]?num-not-connected,1)
;Проверяем канал на занятость
exten =&gt; _XXX,n,ChanIsAvail(SIP/${EXTEN},s)
;Выводим в лог значение функции ChanIsAvail, нужно только для отладки, можно удалить строку
exten =&gt; _XXX,n,NoOp(=========== ChanIsAvail STATUS: ${AVAILSTATUS} ===========)
;Если функция возвращает 2 или 3, значит абонент занят
exten =&gt; _XXX,n,GoToIf($[${AVAILSTATUS} = 2]?num-BUSY,1)
exten =&gt; _XXX,n,GoToIf($[${AVAILSTATUS} = 3]?num-BUSY,1)
;Обрабатываем остальные статусы
exten =&gt; _XXX,n,Goto(num-${DIALSTATUS},1)
;Если номера не существует говорим "Ошибочный номер, попробуйте еще раз"
exten =&gt; num-not-exist,1,Wait(2)
exten =&gt; num-not-exist,n,Playback(invalid)
;Если номер не подключен, говорим "Набранный вами номер отключен, проверьте номер и повторите попытку
exten =&gt; num-not-connected,1,Wait(2)
exten =&gt; num-not-connected,n,Playback(ss-noservice)
;Если номер занят, говорим "Занято"
exten =&gt; num-BUSY,1,Wait(2)
exten =&gt; num-BUSY,n,Playback(vm-isonphone)
;Если номер не отвечает, включаем голосовую почту
exten =&gt; num-NOANSWER,1,Wait(2)
exten =&gt; num-NOANSWER,n,Voicemail(${dstNUM},u)
;Если еще по какой-то причине будет статус CHANUNAVAIL, говорим, что номер не доступен в данный момент
exten =&gt; num-CHANUNAVAIL,1,Wait(2)
exten =&gt; num-CHANUNAVAIL,n,Playback(vm-isunavail)
;Если в голосовом меню не выбрали внутренний номер, адресуем звонок секретарю
exten =&gt; t,1,Dial(SIP/100,15)</pre>
<p style="text-align: justify;">Если вам нужна обработка статусов номеров для внутренних звонков, то скопируйте обработку состояний в контекст [call-out], за исключением последней строки, которая отвечает за звонок секретарю. Полностью контекст внутренних звонков будет выглядеть вот так:</p>
<pre>[call-out]
;Номер для записи звуков, окончание записи #
exten =&gt; _35X, 1, NoOp()
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Playback(beep)
exten =&gt; _35X, n, Record(/tmp/music${EXTEN:2}:wav)
exten =&gt; _35X, n, Wait(1)
exten =&gt; _35X, n, Playback(/tmp/music${EXTEN:2})
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Hangup()
;Управление голосовой почтой
exten =&gt; 500,1,VoiceMailMain()
;Звонок на внутренний номер
exten =&gt; _XXX,1,Dial(SIP/${EXTEN},15)
exten =&gt; _XXX,n,Set(dstNUM=${EXTEN})
exten =&gt; _XXX,n,GotoIf($["${SIPPEER(${EXTEN},status)}" = ""]?num-not-exist,1)
exten =&gt; _XXX,n,GotoIf($["${SIPPEER(${EXTEN},status):0:2}" = "UN"]?num-not-connected,1)
exten =&gt; _XXX,n,ChanIsAvail(SIP/${EXTEN},s)
exten =&gt; _XXX,n,NoOp(=========== ChanIsAvail STATUS: ${AVAILSTATUS} ===========)
exten =&gt; _XXX,n,GoToIf($[${AVAILSTATUS} = 2]?num-BUSY,1)
exten =&gt; _XXX,n,GoToIf($[${AVAILSTATUS} = 3]?num-BUSY,1)
exten =&gt; _XXX,n,Goto(num-${DIALSTATUS},1)
exten =&gt; num-not-exist,1,Wait(2)
exten =&gt; num-not-exist,n,Playback(invalid)
exten =&gt; num-not-connected,1,Wait(2)
exten =&gt; num-not-connected,n,Playback(ss-noservice)
exten =&gt; num-BUSY,1,Wait(2)
exten =&gt; num-BUSY,n,Playback(vm-isonphone)
exten =&gt; num-NOANSWER,1,Wait(2)
exten =&gt; num-NOANSWER,n,Voicemail(${dstNUM},u)
exten =&gt; num-CHANUNAVAIL,1,Wait(2)
exten =&gt; num-CHANUNAVAIL,n,Playback(vm-isunavail)
;Звонок на внешний номер
exten =&gt; _XXX.,1,Dial(SIP/${EXTEN}@397945)
include =&gt; handup-sip</pre>
<p>Я во всех звонках установил время ожидания ответа 15 секунд. Если вы считаете, что нужно больше, измените этот параметр.</p>
<div class="box warning  "><div class="box-inner-block"><i class="fa tie-shortcode-boxicon"></i>
			Обращаю ваше внимание, что в контексте голосового меню я не сделал обработку статусов состояния телефона секретаря, хотя это может быть нужно, если у вас будет один секретарь принимать звонки. Ему и голосовая почта может пригодиться. В следующем пункте я расскажу про случай, когда в офисе работают 2 секретаря и обработкой звонков будет заниматься очередь (queue), поэтому статусы в том виде, как они реализованы здесь будут не нужны. Вы можете использовать любую конфигурацию, которая вам подойдет. Например, использовать очередь, но с одним секретарем в ней. Настраивайте по аналогии, я даю базовый функционал. Все возможные случаи разобрать невозможно.
			</div></div>
<p style="text-align: justify;">Перечитывайте диалплан и тестируйте конфигурацию. При звонке абоненту и его неответе, звонящий услышит в трубке сообщение о том, что номер не отвечает и предложение оставить голосовую почту. Если звонивший оставит сообщение, то получатель получит это сообщение по email и сможет его прослушать там, либо позвонить на номер 500, ввести свой номер и пароль, заданные в <em>voicemail.conf</em> и послушать сообщение по телефону.</p>
<p style="text-align: justify;">Я сталкивался с ошибкой, когда у пользователя в настройках отключена голосовая почта, но он все равно получал сообщения. У него мигало оповещение на телефонном аппарате. Нужно было оперативно удалить все оставленные сообщения без прослушивания. <a href="//serveradmin.ru/kak-udalit-golosovuyu-pochtu-v-asterisk/" target="_blank">Как удалить голосовую почту в астериск</a> я написал в отдельной заметке.</p>
<p>На этом настройка голосовой почты окончена. Можно пользоваться, не забывая добавлять новых пользователей в voicemail.conf и перечитывая конфигурацию голосовой почты.</p>
<h2><span id="_queues">Очереди (queues) входящих звонков</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">С помощью очередей в астериске можно управлять потоком входящих звонков, перераспределяя их по определенным правилам. В нашей конфигурации asterisk мы настроим очередь (queue) для направления звонка двум секретарям одновременно. Кто первый ответит, тот и будет разговаривать со звонящим. Если один секретарь уже разговаривает, новый звонок поступит к другому. Если оба секретаря будут заняты, звонящий будет слушать мелодию и ожидать, пока кто-нибудь не освободится. Как только один из секретарей освободится, звонящего из очереди направит на освободившийся номер.</p>
<p style="text-align: justify;">Номер первого секретаря &#8212; 100, второго &#8212; 130. Я настраиваю простейшую конфигурацию очереди в астериск для понимания принципа работы. Более сложный вариант настройки это сделать 3 очереди для каждого отдела и в голосовом меню-приветствии сделать возможность позвонить в конкретный отдел. Эту конфигурацию я рассмотрю в отдельной статье, хотя в нем и нет ничего сложного. Делается по аналогии с приведенным примером.</p>
<p>Открываем файл <em>queues.conf</em> и добавляем в самый конец:</p>
<pre>[secretary]
strategy = ringall
member =&gt; SIP/100
member =&gt; SIP/130</pre>
<p>Все остальные настройки оставляю по-умолчанию. Параметр <strong>strategy</strong> может принимать следующие значения:</p>
<table>
<tbody>
<tr>
<td style="width: 78px;">ringall</td>
<td style="width: 524px;">вызываются все доступные участники до тех пор, пока кто-то из них не ответит на вызов (по умолчанию).</td>
</tr>
<tr>
<td style="width: 78px;">leastrecent</td>
<td style="width: 524px;">Вызывается первый свободный участник, который меньше всего вызывался из этой очереди.</td>
</tr>
<tr>
<td style="width: 78px;">fewestcalls</td>
<td style="width: 524px;">Вызывается первый свободный участник, который обработал наименьшее количество вызовов из данной очереди.</td>
</tr>
<tr>
<td style="width: 78px;">random</td>
<td style="width: 524px;">случайным образом вызывается не занятый участник, обрабатывающий очередь.</td>
</tr>
<tr>
<td style="width: 78px;">rrmemory</td>
<td style="width: 524px;">циклическое распределение с памятью, запоминается последний участник, ответивший на вызов.</td>
</tr>
</tbody>
</table>
<p style="text-align: justify;">Вы можете выбрать наиболее подходящую вам стратегию распределения звонков в очереди. Дальше нужно добавить в <em>extensions.conf</em> в созданный нами ранее контекст с голосовым меню отправку звонка в очередь с секретарями. Для этого меняем строку в [ivr-main]:</p>
<pre>exten =&gt; t,1,Dial(SIP/100,15)</pre>
<p>на новую:</p>
<pre>exten =&gt; t,1,Queue(secretary,t)</pre>
<p style="text-align: justify;">Если раньше при звонке на внешний номер, звонящий не набирал внутренний номер абонента, то через 5 секунд он перенаправлялся к секретарю с номером 100. Теперь он будет отправляться в очередь secretary, в которую мы завели 2 номера &#8212; 100 и 130. Можно добавить и больше номеров, если есть необходимость.</p>
<p>Перечитываем полностью конфигурацию asterisk:</p>
<pre>CLI&gt; reload</pre>
<p>Состояние созданной очереди:</p>
<pre>CLI&gt; queue show secretary
secretary has 0 calls (max unlimited) in 'ringall' strategy (0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
Members:
SIP/100 (ringinuse enabled) (Not in use) has taken no calls yet
SIP/130 (ringinuse enabled) (Not in use) has taken no calls yet
No Callers</pre>
<p style="text-align: justify;">Теперь можете позвонить на внешний номер и дождаться перенаправления на секретаря. Зазвонят оба аппарата. Если оба заняты, звонок будет висеть в очереди и ждать освобождения. После звонка статистика очереди изменится:</p>
<pre>CLI&gt; queue show secretary
secretary has 0 calls (max unlimited) in 'ringall' strategy (0s holdtime, 2s talktime), W:0, C:1, A:1, SL:0.0% within 0s
Members:
SIP/100 (ringinuse enabled) (Not in use) <strong>has taken 1 calls</strong> (last was 63 secs ago)
SIP/130 (ringinuse enabled) (Not in use) has taken no calls yet
No Callers</pre>
<p>Вот так легко организовать простую queue (очередь) в asterisk. Более сложные примеры я буду рассматривать в отдельных статьях.</p>
<h2><span id="___cdr_viewer">Учет и просмотр статистики звонков (cdr viewer)</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Важной и нужной возможностью современной АТС на базе asterisk является сбор и просмотр статистики звонков. По умолчанию, астериск ведет статистику в файле <em>/var/log/asterisk/cdr-csv/Master.csv</em>. Разобрать этот файл и передать куда-то в обработку не очень сложно, если у вас есть что-то или кто-то, кто способен написать на каком-нибудь языке программирования обработку.</p>
<p style="text-align: justify;">Мы будем использовать готовые бесплатные инструменты для просмотра статистики звонков. Все необходимое для этого мы установили в самом начале. Перенесем сбор статистики в mysql базу. Для этого запускаем mariadb сервер, добавляем в автозагрузку и устанавливаем пароль администратора:</p>
<pre># systemctl start mariadb
# systemctl enable mariadb.service
# /usr/bin/mysql_secure_installation</pre>
<p>Подключаемся к mysql и создаем пользователя и базу данных:</p>
<pre># mysql -uroot -p
MariaDB [(none)]&gt; create database asterisk;
MariaDB [(none)]&gt; use asterisk;
MariaDB [asterisk]&gt; CREATE TABLE `cdr` (   `id` int(9) unsigned NOT NULL auto_increment,   `calldate` datetime NOT NULL default '0000-00-00 00:00:00',   `clid` varchar(80) NOT NULL default '',   `src` varchar(80) NOT NULL default '',   `dst` varchar(80) NOT NULL default '',   `dcontext` varchar(80) NOT NULL default '',   `channel` varchar(80) NOT NULL default '',   `dstchannel` varchar(80) NOT NULL default '',   `lastapp` varchar(80) NOT NULL default '',   `lastdata` varchar(80) NOT NULL default '',   `duration` int(11) NOT NULL default '0',   `billsec` int(11) NOT NULL default '0',   `disposition` varchar(45) NOT NULL default '',   `amaflags` int(11) NOT NULL default '0',   `accountcode` varchar(20) NOT NULL default '',   `uniqueid` varchar(32) NOT NULL default '',   `userfield` varchar(255) NOT NULL default '',   PRIMARY KEY  (`id`),   KEY `calldate` (`calldate`),   KEY `accountcode` (`accountcode`),   KEY `uniqueid` (`uniqueid`),   KEY `dst` (`dst`),   KEY `src` (`src`) ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
MariaDB [asterisk]&gt; grant all on asterisk.* to 'asterisk_user'@'localhost' identified by '12345678';</pre>
<table>
<tbody>
<tr>
<td style="width: 96px;">asterisk</td>
<td style="width: 417px;">имя базы данных</td>
</tr>
<tr>
<td style="width: 96px;">asterisk_user</td>
<td style="width: 417px;">пользователь базы данных</td>
</tr>
<tr>
<td style="width: 96px;">12345678</td>
<td style="width: 417px;">пароль пользователя бд</td>
</tr>
</tbody>
</table>
<p>Устанавливаем odbc коннекторы:</p>
<pre># yum install -y mysql-connector-odbc.x86_64 unixODBC-devel.x86_64</pre>
<p>Редактируем файлы конфигурации. Добавляем в самый конец <em>/etc/asterisk/res_odbc.conf</em>:</p>
<pre>[asterisk]
enabled =&gt; yes
dsn =&gt; MySQL-asterisk
username =&gt; asterisk_user
password =&gt; 12345678</pre>
<p>В конец файла <em>/etc/asterisk/cdr_adaptive_odbc.conf</em>:</p>
<pre>[cdr_adaptive_connection]
connection=asterisk
table=cdr
alias start =&gt; calldate</pre>
<p>Создаем файл <em>/etc/odbc.ini</em> следующего содержания:</p>
<pre>[MySQL-asterisk]
Description = MySQL Asterisk database
Driver = MySQL
Server = localhost
User = asterisk_user
Password = 12345678
Socket = /var/lib/mysql/mysql.sock
Database = asterisk</pre>
<p>Редактируем файл <em>/etc/odbcinst.ini</em>. Я его не трогал, оставил по-умолчанию, только в самый конец секции [MySQL] добавил две недостающие строки. Я не разбирался нужны они или нет, просто подсмотрел в другой инструкции. Вот как этот файл выглядит у меня:</p>
<pre>[MySQL]
Description = ODBC for MySQL
Driver = /usr/lib/libmyodbc5.so
Setup = /usr/lib/libodbcmyS.so
Driver64 = /usr/lib64/libmyodbc5.so
Setup64 = /usr/lib64/libodbcmyS.so
FileUsage = 1
CPTimeout =
CPReuse =</pre>
<p>Настроим использование нашего часового пояса в записях cdr. По-умолчанию там стоит часовой пояс GTM. Для этого в файле <em>/etc/asterisk/cdr.conf</em> указываем параметр:</p>
<pre>usegmtime=no</pre>
<p>После этого перезапускаем астериск:</p>
<pre># service asterisk restart</pre>
<p style="text-align: justify;">Совершаем звонок и проверяем таблицу. Для удобства дальнейшей проверки и настройки, я запустил httpd и настроил phpmyadmin. Они должны были установиться в самом начале. Запускаем httpd и добавляем в автозагрузку:</p>
<pre># systemctl start httpd
# systemctl enable httpd</pre>
<p style="text-align: justify;">С phpmyadmin сами разберитесь, в интернете море инструкций, либо воспользуйтесь моей по <a href="https://serveradmin.ru/ustanovit-i-nastroit-phpmyadmin-na-centos-7/" target="_blank">установке и настройке phpmyadmin</a>. Теперь астериск сохраняет статистику звонков в <strong>mysql</strong> базу asterisk в таблицу <strong>cdr</strong>. Дальше нам надо настроить какую-нибудь web панель для просмотра этой статистики. Я решил сразу установить панель, которая позволяет не только смотреть статистику, но прослушивать записанные разговоры. Поэтому дальнейшая настройка панели просмотра статистики переходит в следующий раздел, в котором я расскажу, как записывать звонки.</p>
<h2><span id="_record">Запись (record) разговоров</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Запись разговоров в asterisk настраивается относительно не сложно. Буквально нужно добавить несколько строк в dialplan. Но мы сразу сделаем более расширенную настройку. Мы будем не просто записывать все разговоры, но станем хранить информацию о звонках в mysql, чтобы их можно было прослушивать через удобную web панель просмотра статистики.</p>
<p style="text-align: justify;">Хранить записи будем в <strong>mp3</strong>, потому нам понадобится утилита <strong>lame</strong>, для конвертации файлов из формата wav в mp3. Скачаем ее и установим.</p>
<pre># cd /usr/src
# wget http://sourceforge.net/projects/lame/files/lame/3.98.4/lame-3.98.4.tar.gz
# tar zxvf lame-3.*
# cd lame-3.*
# ./configure
# make
# make install</pre>
<p style="text-align: justify;">В качестве web панели я буду использовать <a href="http://prog-it.github.io/Asterisk-CDR-Viewer-Mod/" target="_blank">Asterisk-CDR-Viewer-Mod</a>. Очень простая и функциональная штука. Настраивается легко, пользоваться удобно. Скачиваем исходники с github:</p>
<pre># cd /usr/src
# wget https://github.com/prog-it/Asterisk-CDR-Viewer-Mod/tarball/master 
# tar xzvf master</pre>
<p style="text-align: justify;">Копируем содержимое папки <i>/usr/src/master</i> в корень web сервера. Если вам нужно, можете в отдельную папку положить. У меня обычно на сервере с астериском больше ничего нет, так что сойдет и корень &#8212; <em>/var/www/html</em></p>
<p style="text-align: justify;">В папке docs подробная инструкция по настройке. Все дальнейшие действия делаются в соответствии с ней. Исправляются только некоторые особенности данной версии системы. Нам необходимо добавить дополнительное поле в таблицу <strong>cdr</strong> для хранения имени файла. Для этого либо в консоли mysql, либо через phpmyadmin выполните код:</p>
<pre>alter table  `cdr` add column `filename` varchar(120) DEFAULT 'none' after `userfield`;</pre>
<p>Редактируем файл <em>/etc/asterisk/cdr_mysql.conf</em>, добавляя в самый конец 2 строки:</p>
<pre>alias realdst =&gt; realdst
alias filename =&gt; filename</pre>
<p style="text-align: justify;">Дальше редактируем диалплан. Открываем <em>/etc/asterisk/extensions.conf</em> и добавляем в секцию globals переменную, соответствующую папке, где будут храниться записи разговоров.</p>
<pre>[globals]
DIR_RECORDS=/mnt/calls/</pre>
<p>Добавляем макрос для записи перед контекстами звонков:</p>
<pre>[macro-recording]
exten =&gt; s,1,Set(fname=${UNIQUEID}-${STRFTIME(${EPOCH},,%Y-%m-%d-%H_%M)}-${ARG1}-${ARG2});
exten =&gt; s,n,Set(monopt=nice -n 19 /usr/local/bin/lame -b 32 --silent "${DIR_RECORDS}${fname}.wav" "${DIR_RECORDS}${fname}.mp3" &amp;&amp; rm -f "${DIR_RECORDS}${fname}.wav" &amp;&amp; chmod o+r "${DIR_RECORDS}${fname}.mp3");
exten =&gt; s,n,Set(CDR(filename)=${fname}.mp3);
exten =&gt; s,n,Set(CDR(realdst)=${ARG2});
exten =&gt; s,n,MixMonitor(${DIR_RECORDS}${fname}.wav,b,${monopt});
exten =&gt; s,n(no),Verbose(Exit record);</pre>
<p style="text-align: justify;">И редактируем контексты входящих и исходящих разговоров, добавляя туда макрос на запись. Он идет самым первым, перед набором номера. Вот так у меня выглядит контекст локальных звонков и входящих через ivr меню с учетом всех сделанных ранее настроек:</p>
<pre>[call-out]
;Номер для записи звуков, окончание записи #
exten =&gt; _35X, 1, NoOp()
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Playback(beep)
exten =&gt; _35X, n, Record(/tmp/music${EXTEN:2}:wav)
exten =&gt; _35X, n, Wait(1)
exten =&gt; _35X, n, Playback(/tmp/music${EXTEN:2})
exten =&gt; _35X, n, Wait(2)
exten =&gt; _35X, n, Hangup()
;Управление голосовой почтой
exten =&gt; 500,1,VoiceMailMain()
;Звонок на внутренний номер
<span style="color: #0000ff;">exten =&gt; _XXX,1,Macro(recording,${CALLERID(num)},${EXTEN})</span>
exten =&gt; _XXX,n,Dial(SIP/${EXTEN},10)
exten =&gt; _XXX,n,Set(dstNUM=${EXTEN})
exten =&gt; _XXX,n,GotoIf($["${SIPPEER(${EXTEN},status)}" = ""]?num-not-exist,1)
exten =&gt; _XXX,n,GotoIf($["${SIPPEER(${EXTEN},status):0:2}" = "UN"]?num-not-connected,1)
exten =&gt; _XXX,n,ChanIsAvail(SIP/${EXTEN},s)
exten =&gt; _XXX,n,NoOp(=========== ChanIsAvail STATUS: ${AVAILSTATUS} ===========)
exten =&gt; _XXX,n,GoToIf($[${AVAILSTATUS} = 2]?num-BUSY,1)
exten =&gt; _XXX,n,GoToIf($[${AVAILSTATUS} = 3]?num-BUSY,1)
exten =&gt; _XXX,n,Goto(num-${DIALSTATUS},1)
exten =&gt; num-not-exist,1,Wait(2)
exten =&gt; num-not-exist,n,Playback(invalid)
exten =&gt; num-not-connected,1,Wait(2)
exten =&gt; num-not-connected,n,Playback(ss-noservice)
exten =&gt; num-BUSY,1,Wait(2)
exten =&gt; num-BUSY,n,Playback(vm-isonphone)
exten =&gt; num-NOANSWER,1,Wait(2)
exten =&gt; num-NOANSWER,n,Voicemail(${dstNUM},u)
exten =&gt; num-CHANUNAVAIL,1,Wait(2)
exten =&gt; num-CHANUNAVAIL,n,Playback(vm-isunavail)
;Звонок на внешний номер
<span style="color: #0000ff;">exten =&gt; _XXX.,1,Macro(recording,${CALLERID(num)},${EXTEN})</span>
exten =&gt; _XXX.,n,Dial(SIP/${EXTEN}@397945)
include =&gt; handup-sip

[ivr-main]
exten =&gt; s,1,Answer()
exten =&gt; s,2,Background(/etc/asterisk/ivr/ivr-main)
exten =&gt; s,3,WaitExten(5)
<span style="color: #0000ff;">exten =&gt; _XXX,1,Macro(recording,${CALLERID(num)},${EXTEN})</span>
exten =&gt; _XXX,n,Dial(SIP/${EXTEN},10)
exten =&gt; _XXX,n,Set(dstNUM=${EXTEN})
exten =&gt; _XXX,n,GotoIf($["${SIPPEER(${EXTEN},status)}" = ""]?num-not-exist,1)
exten =&gt; _XXX,n,GotoIf($["${SIPPEER(${EXTEN},status):0:2}" = "UN"]?num-not-connected,1)
exten =&gt; _XXX,n,ChanIsAvail(SIP/${EXTEN},s)
exten =&gt; _XXX,n,NoOp(=========== ChanIsAvail STATUS: ${AVAILSTATUS} ===========)
exten =&gt; _XXX,n,GoToIf($[${AVAILSTATUS} = 2]?num-BUSY,1)
exten =&gt; _XXX,n,GoToIf($[${AVAILSTATUS} = 3]?num-BUSY,1)
exten =&gt; _XXX,n,Goto(num-${DIALSTATUS},1)
exten =&gt; num-not-exist,1,Wait(2)
exten =&gt; num-not-exist,n,Playback(invalid)
exten =&gt; num-not-connected,1,Wait(2)
exten =&gt; num-not-connected,n,Playback(ss-noservice)
exten =&gt; num-BUSY,1,Wait(2)
exten =&gt; num-BUSY,n,Playback(vm-isonphone)
exten =&gt; num-NOANSWER,1,Wait(2)
exten =&gt; num-NOANSWER,n,Voicemail(${dstNUM},u)
exten =&gt; num-CHANUNAVAIL,1,Wait(2)
exten =&gt; num-CHANUNAVAIL,n,Playback(vm-isunavail)
<span style="color: #0000ff;">exten =&gt; t,1,Macro(recording,${CALLERID(num)},${EXTEN})</span>
exten =&gt; t,n,Queue(secretary,t)
</pre>
<p>Перезапускаем астериск для применения всех настроек:</p>
<pre># service asterisk restart</pre>
<p style="text-align: justify;">Осталось только указать настройки подключения к базе данных cdr viewer. Эти настройки находятся в файле <em>inc/config.inc.php</em>. Задаем там следующие параметры:</p>
<pre>Mysql
$db_type = 'mysql';
$db_host = 'localhost';
$db_port = '3306';
$db_user = 'asterisk_user';
$db_pass = '12345678';
$db_name = 'asterisk';
$db_table_name = 'cdr';

$system_storage_format = 5;
$system_monitor_dir = '/mnt/calls';</pre>
<p style="text-align: justify;">Остальные параметры я оставил без изменений. Можно звонить и тестировать запись разговоров, просмотр статистики через Asterisk CDR Viewer Mod. Все записанные файлы складываются в одну папку /mnt/calls. В readme.txt описан пример, как настроить сортировку записей по папкам с датами. Если вам это нужно, сделайте, ничего сложного нет, все рассказано подробно. В web панель можно зайти просто набрав в браузере ip адрес сервера, если скрипты положили в корень веб сервера.</p>
<p style="text-align: justify;"><img class="aligncenter wp-image-3243 size-full" src="//serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-06.png" alt="Просмотр статистики и записей звонков" width="1446" height="827" srcset="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-06.png 1446w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-06-300x172.png 300w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-06-768x439.png 768w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-06-1024x586.png 1024w" sizes="(max-width: 1446px) 100vw, 1446px" /></p>
<h2 style="text-align: justify;"><span id="__on_hold">Музыка на ожидании (on hold)</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Вы можете назначить любую мелодию для проигрывания во время нахождения звонка в очереди.  Можете крутить мелодию вместо длинных гудков во время вызова, хотя считаю это лишним. Уместней всего мелодию пускать, как я уже сказал, во время ожидания в очереди и во время удержания звонка по какой-то причине. По-умолчанию в эти моменты проигрывается дефолтная мелодия.</p>
<p style="text-align: justify;">За конфигурацию <strong>music on hold</strong> отвечает соответствующий файл настроек &#8212; <em>/etc/asterisk/musiconhold.conf</em>. Изначально он выглядит так:</p>
<pre style="text-align: justify;">[general]
[default]
mode=files
directory=moh</pre>
<p style="text-align: justify;">Директория указана как moh, полный ее путь <em>/var/lib/asterisk/moh</em>, мелодии проигрываются отсюда. Я не буду менять настройки по-умолчанию. Добавим еще один класс музыки и укажем его в свойствах очереди, где будем ее проигрывать.</p>
<p style="text-align: justify;"><div class="box info  "><div class="box-inner-block"><i class="fa tie-shortcode-boxicon"></i>
			Я привожу пример использования. Если у вас везде будет одна и та же мелодия, то отредактируйте канал default. Так вам не придется каждый раз указывать добавленный канал. 
			</div></div>
<p style="text-align: justify;">Копируем любым способом mp3 файл на сервер в домашнюю директорию root. Создаем директорию /var/lib/asterisk/mohmp3 и кодируем в нее мелодию из mp3 в wav:</p>
<pre style="text-align: justify;"># mkdir  /var/lib/asterisk/mohmp3
# lame --decode /root/music.mp3 /var/lib/asterisk/mohmp3/music.wav</pre>
<p style="text-align: justify;">Добавляем новый класс в musiconhold.conf в самый конец:</p>
<pre style="text-align: justify;">[mp3]
mode=files
directory=mohmp3</pre>
<p style="text-align: justify;">Теперь добавим эту мелодию в свойства очереди. Для этого в описание очереди добавьте новый параметр:</p>
<pre style="text-align: justify;">[secretary]
<span style="color: #0000ff;">music = mp3</span>
strategy = ringall
member =&gt; SIP/100
member =&gt; SIP/130</pre>
<p style="text-align: justify;">Теперь нужно перечитать настройки очереди и мелодии. Проще перезапустить сам астериск:</p>
<pre style="text-align: justify;"># service asterisk restart</pre>
<p style="text-align: justify;">Можно звонить на внешний номер и ждать попадания в очередь. Вы должны услышать добавленную мелодию во время ожидания.</p>
<p style="text-align: justify;">Чтобы добавить эту мелодию вместо длинного гудка, необходимо отредактировать dialplan, добавив новый параметр в правило набора. Если добавляете свой класс музыки, то указываете его в свойствах:</p>
<pre style="text-align: justify;">exten =&gt; _XXX,1,Dial(SIP/${EXTEN},15<span style="color: #0000ff;">,m(mp3)</span>)</pre>
<p style="text-align: justify;">Если используете музыку по-умолчанию, то достаточно написать вот так:</p>
<pre style="text-align: justify;">exten =&gt; _XXX,1,Dial(SIP/${EXTEN},15,<span style="color: #0000ff;">m</span>)</pre>
<p style="text-align: justify;">Для отладки музыки на ожидании, я рекомендую добавить в dialplan в контекст локальных звонков такую конструкцию:</p>
<pre style="text-align: justify;">exten =&gt; 336,1,Answer
exten =&gt; 336,2,MusicOnHold()</pre>
<p style="text-align: justify;">336 &#8212; любой не занятый реальным пиром номер. При звонке на этот номер, вы услышите заданную дефолтную мелодию в соответствии с настройками в файле <em>musiconhold.conf</em>. Для проигрывания не дефолтного класса, укажите его имя в скобках. Так вы можете прослушать как звучат ваши мелодии, протестировать порядок проигрывания и т.д.</p>
<p style="text-align: justify;">Не забывайте перезагружать диалплан после редактирования. На этом настройка music on hold закончена. Можете добавлять разные мелодии и использовать в необходимых местах диалплана или очередях.</p>
<h2 style="text-align: justify;"><span id="i-5">Настройка конференций</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Полезным и востребованным функционалом офисной телефонной станции является создание конференций для одновременного разговора нескольких человек. В asterisk конференция настраивается следующим образом. В специальном файле конфигурации задаются параметры комнаты для конференций. В диалплане назначается отдельный номер для комнаты с конференцией.</p>
<p style="text-align: justify;">Создаем конфигурацию конференции. Для этого в файл <em>confbridge.conf</em> добавляем в самый конец:</p>
<pre style="text-align: justify;">[confer]
type=bridge
max_members=20
mixing_interval=10
internal_sample_rate=auto
record_conference=yes</pre>
<p style="text-align: justify;">В контекст исходящих звонков [call-out] добавляем в самое начало:</p>
<pre style="text-align: justify;">exten =&gt; 999,1,Answer()
exten =&gt; 999,n,ConfBridge(1,confer)</pre>
<p style="text-align: justify;">Перезапускаем астериск. Теперь при звонке на номер 999 человек попадает в комнату для конференций. Следующим участникам конференции необходимо будет так же позвонить на номер 999 для участия в совместной конференции. Если вы с кем-то уже разговариваете, хотите создать конференцию и добавить туда еще участников, то необходимо вашего собеседника переадресовать на номер конференции, затем позвонить новому абоненту и его направить туда же. После этого звоните сами на номер конференции и сможете общаться с тремя абонентами одновременно.</p>
<p style="text-align: justify;">Как выполнять переводы и переадресации звонков я расскажу ниже.</p>
<h2 style="text-align: justify;"><span id="i-6">Перевод, перехват, переадресация звонка</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Рассмотрим несколько необходимых функций и возможностей телефонной станции asterisk. Начнем с перевода звонка. Как перевести звонок на другого абонента? По-умолчанию в астериске для трансфера звонка предусмотрена клавиша #. Посмотреть, так ли это в вашей конфигурации, введите в консоли астера команду:</p>
<pre>CLI&gt; features show
Builtin Feature               Default Current
---------------               ------- -------
Pickup                           *8     *8
<strong>Blind Transfer                    #      #</strong>
Attended Transfer
One Touch Monitor
Disconnect Call                   *      *
Park Call</pre>
<p style="text-align: justify;">Во время разговора нужно нажать <strong>#</strong> и набрать номер, куда вы хотите перевести звонок. Для того, чтобы трансфер состоялся, он должен быть разрешен в диалплане в команде Dial следующим образом:</p>
<pre>exten =&gt; _XXX,n,Dial(SIP/${EXTEN},15<span style="color: #0000ff;">,Tt</span>)</pre>
<table>
<tbody>
<tr>
<td>T</td>
<td>дать возможность звонящему (вызывающему) абоненту совершать перевод звонка на другой номер.</td>
</tr>
<tr>
<td>t</td>
<td>дать возможность вызываемому абоненту сделать перевод звонка на другой номер</td>
</tr>
</tbody>
</table>
<p style="text-align: justify;">В предыдущих примерах я не указывал этот параметр. Сейчас пришло время рассказать о нем и добавить во все участки диалплана, если вам необходимо осуществлять перевод звонков в asterisk.</p>
<p style="text-align: justify;">Перевод звонка можно сделать с помощью функции самого телефона. Мне еще не попадалось ни одного телефона, который бы не умел переводить звонок. Обычно для этих целей предназначена отдельная клавиша или функция в меню телефона. Для уточнения информации о переводе нужно воспользоваться инструкцией самого телефона. В софтфоне, которым я пользуюсь, есть отдельная клавиша для перевода звонка:</p>
<p style="text-align: justify;"><img class="aligncenter wp-image-3244 size-full" src="//serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-07.png" alt="Кнопка перевода звонка" width="278" height="471" srcset="https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-07.png 278w, https://serveradmin.ru/wp-content/uploads/2016/06/asterisk-nastroyka-07-177x300.png 177w" sizes="(max-width: 278px) 100vw, 278px" /></p>
<p style="text-align: justify;">С включенным по-умолчанию <strong>Blind Transfer</strong> есть проблемы. Например, вы перенаправляете звонок на другой номер, а он не ответил или у него занято. Входящий вызов сбрасывается. В астериске есть другой режим перевода звонка, он называется <strong>Attended Transfer</strong>, по-умолчанию он выключен. Работает он более изящно. Сначала вы звоните тому, куда хотите перевести номер, разговариваете с ним, убеждаетесь, что он доступен и готов принять звонок. Только после этого переводите звонок на этого абонента. Чтобы включить такое перенаправление вызова, нужно раскомментировать в <em>features.conf</em> строку:</p>
<pre style="text-align: justify;">atxfer =&gt; *2</pre>
<p style="text-align: justify;">Горячую клавишу можно переназначить на любую другую. На этом о переводе звонка в астериске все.</p>
<p style="text-align: justify;">Теперь поговорим о перехвате звонка. Хотя говорить тут особо нечего. В asteerisk перехват работает из коробки и не требует никаких настроек. Для того, чтобы перехватить звонок, нужно снять трубку и нажать комбинацию <strong>*8</strong>. Комбинация задается в том же файле, что и перехват &#8212; <em>features.conf</em>. Перехватывать звонки могут только абоненты в одной группе. Это задается в свойствах пользователя, я об этом рассказывал в самом начале, когда мы создавали sip аккаунты. Напомню, что речь идет о параметрах <strong>callgroup</strong> и <strong>pickupgroup</strong>.</p>
<p style="text-align: justify;">Разберем теперь переадресацию звонка на какой-то внешний номер, например, мобильный телефон. Многие телефоны имеют встроенный функционал по перенаправлению звонка. Читаете инструкцию к телефону, смотрите, можно ли на нем установить переадресацию и как, и делаете. Работает это только если ваш телефон подключен к АТС. Он принимает звонок и сам его переадресовывает на указанный номер. Это самый простой и быстрый вариант автоматической переадресации звонка на внешний номер.</p>
<p style="text-align: justify;">Рассмотрим другой случай переадресации на мобильный телефон. Допустим, у нас есть номер 115, который вообще отсутствует в офисе, у него нет стационарного телефона. Нам нужно, чтобы при звонке на этот номер, вызов переадресовывался на внешний номер, а конкретно на мобильный сотрудника. Для этого в dialplan нужно добавить следующую строку:</p>
<pre style="text-align: justify;">exten =&gt; 115,n,Dial(SIP/89151234567@397945)</pre>
<p style="text-align: justify;">Если вы хотите, чтобы переадресация работала только при звонках с внутренних номеров офиса, то добавить эту строку нужно в контекст [call-out] перед общим правилом набора на внутренние номера:</p>
<pre style="text-align: justify;"><span style="color: #0000ff;">exten =&gt; 115,n,Dial(SIP/89151234567@397945)</span>
exten =&gt; _XXX,n,Dial(SIP/${EXTEN},15,Tt)</pre>
<p style="text-align: justify;">Для того, чтобы переадресация на внешний номер работала и для звонков из вне, правило перенаправления на мобильный нужно поставить в контекст с голосовым приветствием [ivr-main]. Ставим туда же, перед строкой набора на внутренние номера:</p>
<pre style="text-align: justify;"><span style="color: #0000ff;">exten =&gt; 115,n,Dial(SIP/89151234567@397945)</span>
exten =&gt; _XXX,n,Dial(SIP/${EXTEN},15,Tt)</pre>
<p style="text-align: justify;">Вы можете поменять внешний номер для разных контекстов. К примеру, для сотрудников офиса сделать перенаправление на один мобильный, а для звонков клиентов на другой.</p>
<h2 style="text-align: justify;"><span id="_asterisk__fail2ban">Защита asterisk с помощью fail2ban</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Если ваш астериск имеет внешний ip адрес, либо на него сделан проброс портов с внешнего ip, то необходимо обеспечить защиту от перебора учеток и прочих множественных подключений. Организуем защиту с помощью известного и популярного средства <strong>fail2ban</strong>. Сделать это не сложно, fail2ban поддерживает astersik из коробки. Достаточно просто установить его и активировать некоторые настройки.</p>
<p style="text-align: justify;">Устанавливаем fail2ban на сервер с астериском:</p>
<pre style="text-align: justify;"># yum install -y fail2ban</pre>
<p style="text-align: justify;">Включаем запись в лог файл событий типа security. Для этого открываем файл <em>/etc/asterisk/logger.conf</em> и раскомментируем строку:</p>
<pre style="text-align: justify;">security =&gt; security</pre>
<p style="text-align: justify;">Перечитываем настройки хранения логов:</p>
<pre style="text-align: justify;"># asterisk -x "logger reload"</pre>
<p style="text-align: justify;">В папке <em>/var/log/asterisk</em> появился новый файл <em>security</em>. Его записи мы будем передавать в fail2ban для анализа. Открываем файл <em>/etc/fail2ban/jail.conf</em>, ищем там секцию [asterisk] и меняем путь к логфайлу и добавляем строку активации джейла:</p>
<pre style="text-align: justify;">logpath  = /var/log/asterisk/security
enabled  = true</pre>
<p style="text-align: justify;">Запускаем fail2ban и добавляем в автозапуск:</p>
<pre style="text-align: justify;"># systemctl start fail2ban
# systemctl enable fail2ban</pre>
<p style="text-align: justify;">Чтобы fail2ban работал, у вас должен быть запущен и настроен iptables. Отмечу также, что по-умолчанию fail2ban в centos 7 использует команды firewalld. Если вы его отключили и используете голые iptables, то вам необходимо удалить файл <em>/etc/fail2ban/jail.d/00-firewalld.conf</em> и перезапустить fail2ban. Если этого не сделать, работать он не будет.</p>
<p style="text-align: justify;">На этом подробная и многофункциональная настройка asterisk закончена. Я рассказал все, что запланировал, выделив наиболее востребованные функции.</p>
<h2 style="text-align: justify;"><span id="i-7">Заключение</span></h2><p style="text-align: center;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Статьи -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1310661631569687"
     data-ad-slot="3326828851"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
<p style="text-align: justify;">Время подвести итог проделанной работы. На всякий случай приведу полный конфиг основного файла, с которым мы работали &#8212; <a href="//serveradmin.ru/files/extensions.conf" target="_blank" class="shortc-button small red ">extensions.conf</a>. Я писал статью почти 2 месяца, что-то добавляя, проверяя, редактируя. Она актуальна полностью на момент написания. Можно простым копипастом переносить конфигурацию и все заработает. Я проверил перед публикацией. Со временем что-то может измениться, но не думаю, что сильно. Синтаксис конфигурационных файлов почти не меняется в разных версиях астера, это позволяет без проблем переносить настройки между версиями, и тем более между операционными системами.</p>
<p style="text-align: justify;">Я планирую раскрыть более широко затронутую тему. У меня есть примеры интересных и полезных конфигураций. По мере возможности буду писать новые статьи по серверу телефонии. На сегодня у меня все, хороших вам настроек  🙂</p>
<p style="text-align: justify;"><div class="box shadow  aligncenter"><div class="box-inner-block"><i class="fa tie-shortcode-boxicon"></i>
			Обсуждение статьи на <strong>форуме</strong> — <a href="//serveradmin.ru/forum/astersik/asterisk-sip-ats-dlya-ofisa-poshagovaya-instruktsiya-po-nastroyke-s-nulya/" target="_blank">ссылка открывается в новой вкладке</a>.
			</div></div>
<p style="text-align: justify;"><!-- Start shortcoder --><hr />

<h4 style="text-align: center;">Помогла статья? Есть возможность отблагодарить автора</h4>
<p style="text-align: center;"><iframe src="https://money.yandex.ru/quickpay/shop-widget?account=4100198746754&amp;quickpay=shop&amp;payment-type-choice=on&amp;mobile-payment-type-choice=on&amp;writer=seller&amp;targets=%D0%A1%D0%BF%D0%B0%D1%81%D0%B8%D0%B1%D0%BE+%D0%B0%D0%B2%D1%82%D0%BE%D1%80%D1%83+%D0%B7%D0%B0+%D0%BF%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D1%83%D1%8E+%D1%81%D1%82%D0%B0%D1%82%D1%8C%D1%8E&amp;targets-hint=&amp;default-sum=&amp;button-text=03&amp;comment=on&amp;hint=&amp;successURL=" width="450" height="258" frameborder="0" scrolling="no"></iframe></p><!-- End shortcoder v4.1.1-->
										
									</div><!-- .entry /-->
				<span style="display:none"><a href="https://serveradmin.ru/tag/asterisk/" rel="tag">asterisk</a></span>				<span style="display:none" class="updated">2016-06-13</span>
								<div style="display:none" class="vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person"><strong class="fn" itemprop="name"><a href="https://serveradmin.ru/author/zerox/" title="Записи Zerox" rel="author">Zerox</a></strong></div>
								
								<div class="clear"></div>
			</div><!-- .post-inner -->
		</article><!-- .post-listing -->
		
		
		<div class="e3lan e3lan-post">			<!-- Yandex.RTB R-A-184428-1 -->
<div id="yandex_rtb_R-A-184428-1"></div>
<script type="text/javascript">
    (function(w, d, n, s, t) {
        w[n] = w[n] || [];
        w[n].push(function() {
            Ya.Context.AdvManager.render({
                blockId: "R-A-184428-1",
                renderTo: "yandex_rtb_R-A-184428-1",
                async: true
            });
        });
        t = d.getElementsByTagName("script")[0];
        s = d.createElement("script");
        s.type = "text/javascript";
        s.src = "//an.yandex.ru/system/context.js";
        s.async = true;
        t.parentNode.insertBefore(s, t);
    })(this, this.document, "yandexContextAsyncCallbacks");
</script>				</div>		
				
		
			
			<section id="related_posts">
		<div class="block-head">
			<h3>Похожие записи</h3><div class="stripe-line"></div>
		</div>
		<div class="post-listing">
						<div class="related-item">
							
				<div class="post-thumbnail">
					<a href="https://serveradmin.ru/ogranichenie-na-zvonki-dlya-gruppyi-nomerov-v-asterisk/">
						<img width="310" height="165" src="https://serveradmin.ru/wp-content/uploads/2017/08/asterisk-ogranichenie-310x165.png" class="attachment-tie-medium size-tie-medium wp-post-image" alt="" />						<span class="fa overlay-icon"></span>
					</a>
				</div><!-- post-thumbnail /-->
							
				<h3><a href="https://serveradmin.ru/ogranichenie-na-zvonki-dlya-gruppyi-nomerov-v-asterisk/" rel="bookmark">Ограничение на звонки для группы номеров в asterisk</a></h3>
				<p class="post-meta"><span class="tie-date"><i class="fa fa-clock-o"></i>09.08.2017</span></p>
			</div>
						<div class="related-item">
							
				<div class="post-thumbnail">
					<a href="https://serveradmin.ru/analiz-sip-trafika-v-asterisk-s-pomoshhyu-sngrep/">
						<img width="310" height="165" src="https://serveradmin.ru/wp-content/uploads/2017/04/asterisk-sngrep-310x165.png" class="attachment-tie-medium size-tie-medium wp-post-image" alt="" />						<span class="fa overlay-icon"></span>
					</a>
				</div><!-- post-thumbnail /-->
							
				<h3><a href="https://serveradmin.ru/analiz-sip-trafika-v-asterisk-s-pomoshhyu-sngrep/" rel="bookmark">Анализ SIP трафика в Asterisk с помощью sngrep</a></h3>
				<p class="post-meta"><span class="tie-date"><i class="fa fa-clock-o"></i>27.04.2017</span></p>
			</div>
						<div class="related-item">
							
				<div class="post-thumbnail">
					<a href="https://serveradmin.ru/zvonok-opoveshhenie-zabbix-cherez-asterisk-na-mobilnyiy-telefon/">
						<img width="310" height="165" src="https://serveradmin.ru/wp-content/uploads/2017/04/zabbix-asterisk-actions-310x165.png" class="attachment-tie-medium size-tie-medium wp-post-image" alt="" />						<span class="fa overlay-icon"></span>
					</a>
				</div><!-- post-thumbnail /-->
							
				<h3><a href="https://serveradmin.ru/zvonok-opoveshhenie-zabbix-cherez-asterisk-na-mobilnyiy-telefon/" rel="bookmark">Звонок-оповещение Zabbix через Asterisk на мобильный телефон</a></h3>
				<p class="post-meta"><span class="tie-date"><i class="fa fa-clock-o"></i>07.04.2017</span></p>
			</div>
						<div class="clear"></div>
		</div>
	</section>
			
					
		
				
<div id="comments">

	
	<div id="comments-box">
		<div class="block-head">
			<h3 id="comments-title">93 комментария </h3><div class="stripe-line"></div>
		</div>
		<div class="post-listing">

			
					
				
			<ol class="commentlist">	<li id="comment-312">
		<div  class="comment byuser comment-author-idis even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d2b40674f07912bbff723af1021a5c29?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d2b40674f07912bbff723af1021a5c29?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">idis</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-312">	14.07.2016 at 12:48</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Отличная статья, Большое Спасибо!!!<br />
Были некоторые моменты неясные, дошло ))</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=312#respond' onclick='return addComment.moveForm( "comment-312", "312", "respond", "2897" )' aria-label='Комментарий к записи idis'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-368">
		<div  class="comment byuser comment-author-dyuk odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Александр</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-368">	02.10.2016 at 14:48</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Статья правда хорошая, только вот столкнулся с проблемой:<br />
Сделал точно всё по приводимым в статье инструкциям, но входящие звонки с внешнего транка &#8212; не идут (Ошибка 486 : Busy Here, то бишь занято). Использовал сервис Zadarma. Внутренние звонки работают, исходящие наружу то же, а вот обратно нет. Пробовал отключать iptables &#8212; не помогло. В чём может быть проблема?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=368#respond' onclick='return addComment.moveForm( "comment-368", "368", "respond", "2897" )' aria-label='Комментарий к записи Александр'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-369">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-369">	03.10.2016 at 18:33</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Может быть сам zadarma глючит? Либо с фаерволом проблемы. Если он отключен, то проброс портов надо проверять, если он есть. Отсутствие входящих с нормальными исходящими очень похоже на не проброшенный порт 5060.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=369#respond' onclick='return addComment.moveForm( "comment-369", "369", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-370">
		<div  class="comment byuser comment-author-dyuk odd alt depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Александр</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-370">	03.10.2016 at 21:47</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Имеется ввиду проброс порта на роутере?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=370#respond' onclick='return addComment.moveForm( "comment-370", "370", "respond", "2897" )' aria-label='Комментарий к записи Александр'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-371">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-4 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-371">	03.10.2016 at 21:55</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Да. У меня такое было. Если неправильно проброшен порт, то исходящие звонки совершать можно, их инициирует сам астериск, если у него есть доступ в интернет, то он нормально позвонит. А вот входящие не проходят, соединение инициирует провайдер. Возможно он не может достучаться до сервера и выдает статус Занято.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=371#respond' onclick='return addComment.moveForm( "comment-371", "371", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-372">
		<div  class="comment byuser comment-author-dyuk odd alt depth-5 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Александр</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-372">	03.10.2016 at 22:03</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Да вроде пробросил. Куда-нибудь скрин бросить можно?, посмотрите?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=372#respond' onclick='return addComment.moveForm( "comment-372", "372", "respond", "2897" )' aria-label='Комментарий к записи Александр'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-373">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-6 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-373">	03.10.2016 at 22:05</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Давай продолжим на форуме:<br />
//serveradmin.ru/forum/astersik/problemyi-s-ishodyashhimi-zvonkami/</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=373#respond' onclick='return addComment.moveForm( "comment-373", "373", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-374">
		<div  class="comment byuser comment-author-dyuk odd alt thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Александр</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-374">	03.10.2016 at 22:10</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>ОК</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=374#respond' onclick='return addComment.moveForm( "comment-374", "374", "respond", "2897" )' aria-label='Комментарий к записи Александр'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-384">
		<div  class="comment byuser comment-author-dyuk even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/59977b20cb52a6a8e86a19ee275170f7?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Александр</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-384">	08.10.2016 at 00:48</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Настройка в menuselect:<br />
# make menuselect<br />
пункт: Core Sound Packages: Выбираем русские звуки RU-WAV,<br />
&#8212; Оные отсутствуют. Имются только EN-WAV.<br />
Почему? Всё делалось по последовательно по пунктам статьи. Русская озвучка потом будет работать?<br />
Тема добавлена в форум.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=384#respond' onclick='return addComment.moveForm( "comment-384", "384", "respond", "2897" )' aria-label='Комментарий к записи Александр'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-385">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-385">	08.10.2016 at 01:04</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Можно будет вручную скачать и установить. Возможно состав пакета установки изменился. Когда я последний раз настраивал астериск русский язык был по-умолчанию.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=385#respond' onclick='return addComment.moveForm( "comment-385", "385", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-420">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/4eccfe30d829d6e84a7548ca7bc1c769?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/4eccfe30d829d6e84a7548ca7bc1c769?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Артем</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-420">	12.11.2016 at 16:57</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Огромное спасибо за статью! Признаться я полный ноль не только в Asterisk но и VoIP, но хотел бы задать интересующий меня вопрос (надеюсь кто то ответит). Этот экстеншен: exten =&gt; _XXX.,1,Dial(SIP/${EXTEN}@397945) предназначен для звонков на внешние номера. Автор говорит что благодаря этому можно звонит на городские номера. Работает ли это для звонков на другие сервера Asterisk? Т.е. абонент набирает 6-и значный внутренний номер в сервисе zadarma и попадает на другой Asterisk сервер, правильно ли я понял?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=420#respond' onclick='return addComment.moveForm( "comment-420", "420", "respond", "2897" )' aria-label='Комментарий к записи Артем'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-424">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-424">	13.11.2016 at 20:48</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Да, все верно. Думаю, что звонок на другой астериск через сервис задарма возможен.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=424#respond' onclick='return addComment.moveForm( "comment-424", "424", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-427">
		<div  class="comment even depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/4eccfe30d829d6e84a7548ca7bc1c769?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/4eccfe30d829d6e84a7548ca7bc1c769?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Артем</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-427">	13.11.2016 at 21:23</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Большое спасибо!</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=427#respond' onclick='return addComment.moveForm( "comment-427", "427", "respond", "2897" )' aria-label='Комментарий к записи Артем'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-435">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Yura</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-435">	14.11.2016 at 18:50</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Все хорошо, кроме одного момента &#8212; вылезла ошибка с кодеками.<br />
[Nov 14 17:38:43] WARNING[28879][C-00000000]: translate.c:481 ast_translator_build_path: No translator path: (starting codec is not valid)<br />
[Nov 14 17:38:43] WARNING[28879][C-00000000]: translate.c:481 ast_translator_build_path: No translator path: (starting codec is not valid)<br />
[Nov 14 17:38:43] WARNING[28879][C-00000000]: translate.c:481 ast_translator_build_path: No translator path: (starting codec is not valid)<br />
[Nov 14 17:38:43] WARNING[28879][C-00000000]: translate.c:481 ast_translator_build_path: No translator path: (starting codec is not valid)<br />
Как исправить еще не доковырял.</p>
<p>Плюс ко всему необходимо в modules.conf  добавить<br />
MACRO &amp; MIXMONITOR  если их нет в арр</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=435#respond' onclick='return addComment.moveForm( "comment-435", "435", "respond", "2897" )' aria-label='Комментарий к записи Yura'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-439">
		<div  class="comment even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Yura</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-439">	15.11.2016 at 10:59</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>можно попросить ваш modules.conf, чтобы понять, что у меня не подгружено.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=439#respond' onclick='return addComment.moveForm( "comment-439", "439", "respond", "2897" )' aria-label='Комментарий к записи Yura'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-441">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-441">	15.11.2016 at 11:20</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Это был тестовый стенд, его уже нет. Но файл modules.conf я не трогал вообще. Какой он был после установки, такой и оставался.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=441#respond' onclick='return addComment.moveForm( "comment-441", "441", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-447">
		<div  class="comment even depth-4 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Yura</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-447">	15.11.2016 at 14:18</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Разобрался.<br />
Таки нехватка кодека. Астериск ставил без установки примеров и т.д., файл modules.conf был пустой. Решилось загрузкой module load codec_alaw.so<br />
Теперь осталось разобраться с тем, что в панели отображает звонки, но вместо файла записи &#8212; знак отсутствия файла.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=447#respond' onclick='return addComment.moveForm( "comment-447", "447", "respond", "2897" )' aria-label='Комментарий к записи Yura'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-448">
		<div  class="comment odd alt thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Yura</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-448">	15.11.2016 at 16:23</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Разобрался и с отсутствием файлов&#8230; в config.inc.php устанавливается размер файла, с которого файл не считается отсутствующим. Поэтому мои коротенькие тестовые звонки и не отображались в панели.<br />
Спасибо огромное за статью. Весьма подробно, а ко всему еще и позволило не только тупо накопипастить, но еще и изучить некоторые вопросы самостоятельно, поняв смысл написанного выше.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=448#respond' onclick='return addComment.moveForm( "comment-448", "448", "respond", "2897" )' aria-label='Комментарий к записи Yura'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-475">
		<div  class="comment even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/b164e56b71806c69bd5b404801d1232e?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/b164e56b71806c69bd5b404801d1232e?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Владимир</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-475">	19.11.2016 at 19:37</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Здравствуйте я новичек</p>
<p>В Asteriske хочу блокировать все номера с префиксом 001xxxxx, как мне это сделать или это нужно с делать с помощью iptables?</p>
<p>заранее спасибо</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=475#respond' onclick='return addComment.moveForm( "comment-475", "475", "respond", "2897" )' aria-label='Комментарий к записи Владимир'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-476">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-476">	19.11.2016 at 20:08</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Что значит блокировать номера? Запретить на них звонить, или запретить с них вызовы?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=476#respond' onclick='return addComment.moveForm( "comment-476", "476", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-491">
		<div  class="comment even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Yura</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-491">	23.11.2016 at 18:18</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>и советую почитать Asterisk: The Future of Telephony.Хотя бы 5 главу &#8212; Основы диаплана. Книга конечно старенькая &#8212; последняя редакция 2009 года, если не ошибаюсь, но десяток страниц даст вам много пищи для размышлений и понимания того, что описано в статье. Написано конечно хорошо, но тупо копипастить не годится &#8212; вы должны понимать, что делаете. Тогда и ошибок не будет. И не забывайте, что это деньги. Были случаи, когда неправильные настройки и защита астериска приводили к многотысячным счетам за телефонию.<br />
Судя по вашему вопросу по iptables &#8212; почитайте обязательно по защите сервера.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=491#respond' onclick='return addComment.moveForm( "comment-491", "491", "respond", "2897" )' aria-label='Комментарий к записи Yura'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-477">
		<div  class="comment odd alt thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/b164e56b71806c69bd5b404801d1232e?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/b164e56b71806c69bd5b404801d1232e?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Владимир</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-477">	19.11.2016 at 21:04</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>запретить с них вызовы</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=477#respond' onclick='return addComment.moveForm( "comment-477", "477", "respond", "2897" )' aria-label='Комментарий к записи Владимир'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-490">
		<div  class="comment even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Yura</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-490">	23.11.2016 at 18:11</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>exten =&gt; _8XX/_001xxxxx,1,Hangup()</p>
<p>такой конструкцией отбей. первое номер на который звонят (в данном случае шаблон), второе номер с которого звонят (тоже шаблон) &#8212; отбить, или любое действие какое ты хочешь.<br />
В данном примере при звонке на номера с 800 по 899 с номеров 001(00000-99999) будет положена трубка. Если я не так тебя понял, то шаблоны можно поменять местами.<br />
Причем тут iptables вообще непонятно &#8212; он нужен только для разруливания кто может к твоему астериску получить доступ.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=490#respond' onclick='return addComment.moveForm( "comment-490", "490", "respond", "2897" )' aria-label='Комментарий к записи Yura'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-510">
		<div  class="comment odd alt depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/b164e56b71806c69bd5b404801d1232e?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/b164e56b71806c69bd5b404801d1232e?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Владимир</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-510">	26.11.2016 at 17:36</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Спосибо тебе Yura</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=510#respond' onclick='return addComment.moveForm( "comment-510", "510", "respond", "2897" )' aria-label='Комментарий к записи Владимир'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-497">
		<div  class="comment even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/9c64df4a412cf040287d28dadeb2a14e?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/9c64df4a412cf040287d28dadeb2a14e?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Vladimir</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-497">	24.11.2016 at 21:28</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>точно так же все настроил но почему то выход в город только через +7 или 7, как 7ку заменить на 8ку?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=497#respond' onclick='return addComment.moveForm( "comment-497", "497", "respond", "2897" )' aria-label='Комментарий к записи Vladimir'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-498">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-498">	24.11.2016 at 21:35</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Это от оператора связи зависит. Заменить 7 на 8 можно в диалплане. В интернете без проблем можно найти пример, у меня нет под рукой.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=498#respond' onclick='return addComment.moveForm( "comment-498", "498", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-546">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo avatar-default' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Владимир</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-546">	29.11.2016 at 11:48</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Спасибо за информацию, долго не мог понять почему у меня не звонит через моего оператора связи, выяснилось что у него требуется обязательная регистрация, спасибо еще раз, все доходчиво написано.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=546#respond' onclick='return addComment.moveForm( "comment-546", "546", "respond", "2897" )' aria-label='Комментарий к записи Владимир'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-572">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/e640d67364780da35bc7bf244caa2d6a?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Юра</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-572">	02.12.2016 at 12:45</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>в конструкции<br />
exten =&gt; t,1,Macro(recording,${CALLERID(num)},${EXTEN})<br />
exten =&gt; t,n,Queue(secretary,t)<br />
есть один недостаток.<br />
Если в очереди 2 телефона секретаря, то в базу данных будет писаться два разговора.<br />
Для примера из статьи 100 и 130. Если трубку возьмет 100, то 130 будет отображаться в cdr viewer не отвеченным. Если два телефона &#8212; в принципе не проблема&#8230; если в очереди 10-20-30 тел, то при одном звонке &#8212; 9 лишних записей &#8212; немножко накладно по использованию ресурсов. Как обойти данную проблему еще не нашел решения. Если у кого-то есть наработки &#8212; намекните.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=572#respond' onclick='return addComment.moveForm( "comment-572", "572", "respond", "2897" )' aria-label='Комментарий к записи Юра'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-574">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-574">	02.12.2016 at 12:59</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Да, любопытно. Я не сталкивался с этим. Я стараюсь запись не включать, там, где она явна не нужна. Не стоит забывать про УК РФ, Статья 138. Без ведома людей, записывать их нельзя. Нужно предупреждать об этом и сотрудников компании, и их абонентов.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=574#respond' onclick='return addComment.moveForm( "comment-574", "574", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1008">
		<div  class="comment odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1008">	06.02.2017 at 20:11</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Максрос использовать непосредственно в очереди как вариант. т.е. в queue.conf непосредственно</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1008#respond' onclick='return addComment.moveForm( "comment-1008", "1008", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-730">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/40b5346f57399a890f07fc22d0b96e88?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/40b5346f57399a890f07fc22d0b96e88?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Александр</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-730">	23.12.2016 at 17:01</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Отличная статья. Спасибо.<br />
в контексте [ivr-main]:<br />
;Если введен не существующий номер, то говорим об этом и отправляем в начало приветствия<br />
exten =&gt; _XXX,2,Playback(privacy-incorrect)<br />
exten =&gt; _XXX,3,Goto(ivr-main,s,1)<br />
Есть специальный экстеншн &#171;i&#187; &#8212; Вызывается, при попытке вызова неизвестного екстеншена.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=730#respond' onclick='return addComment.moveForm( "comment-730", "730", "respond", "2897" )' aria-label='Комментарий к записи Александр'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-731">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-731">	23.12.2016 at 17:28</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Спасибо за дополнение. Я знаю про него, иногда использую. Для остальных, речь идет вот о чем. Просто после:<br />
exten => t,1,Dial(SIP/100)<br />
можно добавить например вот так:<br />
exten => i,1,Dial(SIP/100).<br />
И звонок уйдет на номер 100, если ввели неправильно внутренний номер.<br />
Так даже более правильно будет, чем то, что у меня сейчас, но я почему-то в статье сделал таким образом. Не помню почему.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=731#respond' onclick='return addComment.moveForm( "comment-731", "731", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1009">
		<div  class="comment even depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1009">	06.02.2017 at 20:27</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>И почти правильно делали, exten =&gt; i,1,Dial(SIP/100). это не отработает и будет сброс звонка. Эта проблема ранее не однократно обсуждалась. В данном случае нужно выпольнить по ошибке переход в определенный контекст, и из него уже выполнить набор абонента.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1009#respond' onclick='return addComment.moveForm( "comment-1009", "1009", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-739">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/0e638eead7e96d51a623d9afcc085232?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/0e638eead7e96d51a623d9afcc085232?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Gerasim</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-739">	25.12.2016 at 11:14</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Доброго дня. А можете подсказать откуда же запрашивается авторизация у свеже-установленного модуля статистики ? все перекопал. авторизацию сам не настраивал&#8230;</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=739#respond' onclick='return addComment.moveForm( "comment-739", "739", "respond", "2897" )' aria-label='Комментарий к записи Gerasim'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-740">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/0e638eead7e96d51a623d9afcc085232?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/0e638eead7e96d51a623d9afcc085232?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Gerasim</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-740">	25.12.2016 at 11:18</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Вопрос снимается)  переименовал каталог и авторизация ушла:) чтото в апачах и /var/www/html допилить забыл.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=740#respond' onclick='return addComment.moveForm( "comment-740", "740", "respond", "2897" )' aria-label='Комментарий к записи Gerasim'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-756">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/40b5346f57399a890f07fc22d0b96e88?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/40b5346f57399a890f07fc22d0b96e88?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Александр</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-756">	26.12.2016 at 16:49</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Еще по записи звуков хотел бы поправить:<br />
1. Не понятно, зачем нужна первая строка? NoOp() в данном случае ничего не делает, вместо этой команды логичнее поставить Answer()<br />
2. Перед командой Record() нет смысла в Playback(beep). Команда Record, сгенерирует beep на канале, перед началом записи</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=756#respond' onclick='return addComment.moveForm( "comment-756", "756", "respond", "2897" )' aria-label='Комментарий к записи Александр'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-757">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-757">	26.12.2016 at 20:07</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Спасибо за содержательные замечания. Я проверю информацию и исправлю статью, как будет возможность.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=757#respond' onclick='return addComment.moveForm( "comment-757", "757", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1993">
		<div  class="comment odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/765a83b289fa9dfd6046fdc813a1cfad?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/765a83b289fa9dfd6046fdc813a1cfad?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn"><a href='http://serviceplus.in.ua' rel='external nofollow' class='url'>Роман</a></cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1993">	06.07.2017 at 02:44</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>NoOp() &#8212; Эта команда выводит содержимое переменной без ее выполнения, то есть, Вы можете написать так:<br />
NoOp(${CALLERID(num)}) &#8212; и при просмотре в консоли лога Астериска будет выведено содержимое этой переменной<br />
NoOp(${EXTEN}) &#8212; тоже самое, вы в консоли увидите вызываемый экстеншен. Для отладки в основном используется</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1993#respond' onclick='return addComment.moveForm( "comment-1993", "1993", "respond", "2897" )' aria-label='Комментарий к записи Роман'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-923">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/af71a03f63468d13b8865906ae4cbd28?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/af71a03f63468d13b8865906ae4cbd28?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Mansur</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-923">	27.01.2017 at 22:51</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Zerox, благодарю за статью! Довольно доходчиво и понятно описаны основы. После прочтения за пару часов поднял тестовый астер, и что самое главное, я понял , что я сделал, и как это работает. (Я новичок, который никогда не занимался телефонией в принципе).<br />
Спасибо Вам огромное!</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=923#respond' onclick='return addComment.moveForm( "comment-923", "923", "respond", "2897" )' aria-label='Комментарий к записи Mansur'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-924">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-924">	27.01.2017 at 23:15</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Спасибо за отзыв. Я рад, что у меня получилось задуманное. Целью было написать наиболее понятным для новичка языком, как настроить функциональную и законченную систему телефонии на базе asterisk.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=924#respond' onclick='return addComment.moveForm( "comment-924", "924", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-999">
		<div  class="comment even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-999">	06.02.2017 at 12:48</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>iptables -t nat -A PREROUTING -p udp &#8212;dst $WAN_IP &#8212;dport 5060 -j DNAT &#8212;to 192.168.1.25:5060<br />
iptables -t nat -A PREROUTING -p udp &#8212;dst $WAN_IP &#8212;dport 10000:20000 -j DNAT &#8212;to 192.168.1.25</p>
<p>И влетаем на самые распространенные грабли с астериском за Nat, а потом курим почему голос ходит в одну сторону, не? 🙂</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=999#respond' onclick='return addComment.moveForm( "comment-999", "999", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1000">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1000">	06.02.2017 at 12:58</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>А в чем тут проблема? Сейчас нет времени вникать в суть, но у меня с натом не было каких-то особых проблем с iptables.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1000#respond' onclick='return addComment.moveForm( "comment-1000", "1000", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1001">
		<div  class="comment even depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1001">	06.02.2017 at 13:07</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Данный проброс дает возможность подключиться SIP клиенту из вне. Далее он подключился со своего IP(SIP_IP) к Вашему WAN_IP.  Тут проблем нет.<br />
При звонке будет попытка установить соединение SIP_IP к WAN_IP это пройдет на ура. А в обратную сторону не пойдет потому что астериск будет отправлять &#171;голос&#187; на SIP_IP в ответ.<br />
А так проблема не в Nat. А с самим RTP.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1001#respond' onclick='return addComment.moveForm( "comment-1001", "1001", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1002">
		<div  class="comment odd alt depth-4 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1002">	06.02.2017 at 13:13</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>ну кроме случаев если у вас SIP_IP это внешний белый IP. В таком случае проблем не будет</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1002#respond' onclick='return addComment.moveForm( "comment-1002", "1002", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1003">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-4 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1003">	06.02.2017 at 13:23</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Вечером приведу примеры работающих серверов с реальными примерами iptables, сравним.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1003#respond' onclick='return addComment.moveForm( "comment-1003", "1003", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1004">
		<div  class="comment odd alt depth-5 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1004">	06.02.2017 at 19:10</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Да, я посмотрел потом на конфиг астера что Вы приводите и там стоит canreinvite=no, он как  раз решает проблему. Правда он устарел еще в 11м астериске. Теперь используется Directmedia</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1004#respond' onclick='return addComment.moveForm( "comment-1004", "1004", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-1005">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1005">	06.02.2017 at 19:22</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Только не пойму зашем вам pj если у вас только SIP, и зачем у вас в конфиге g729 коммерческий кодек которого, если мне склероз не изменяет, его в обычной поставке астериска нет 🙂</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1005#respond' onclick='return addComment.moveForm( "comment-1005", "1005", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1006">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1006">	06.02.2017 at 19:29</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>А так вы молодец! Мне бы такую статью года 2 назад в руки!  В общем всяческие похвалы!</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1006#respond' onclick='return addComment.moveForm( "comment-1006", "1006", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1007">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/75a360f2373d6ce452c841dc4af4074b?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Om</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1007">	06.02.2017 at 19:50</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Добавить стоить в sip.conf  alwaysauthreject=yes, это при попытках брутфорса будет показывать всегда 401 Не авторизован. В связке с fail2ban который все же имеет ряд дырочек будет плюсом.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1007#respond' onclick='return addComment.moveForm( "comment-1007", "1007", "respond", "2897" )' aria-label='Комментарий к записи Om'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1018">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/c64eba9dc85795a75551c2f430a76dd4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/c64eba9dc85795a75551c2f430a76dd4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Sergey</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1018">	08.02.2017 at 15:02</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Камрад! Замечательная статья, настроил нужное по ней, но остались ошибки. Часть ошибок я нагуглил, но часть осталась, не могу сообразить, как исправить. Не сталкивались с такими ошибками:</p>
<p>[Feb  8 13:52:59] WARNING[9416]: res_odbc.c:526 load_odbc_config: The &#8216;pooling&#8217;, &#8216;shared_connections&#8217;, &#8216;limit&#8217;, and &#8216;idlecheck&#8217; options were replaced by &#8216;max_connections&#8217;.  See res_odbc.conf.sample.<br />
[Feb  8 13:52:59] WARNING[9416]: res_odbc.c:526 load_odbc_config: The &#8216;pooling&#8217;, &#8216;shared_connections&#8217;, &#8216;limit&#8217;, and &#8216;idlecheck&#8217; options were replaced by &#8216;max_connections&#8217;.  See res_odbc.conf.sample.<br />
[Feb  8 13:52:59] NOTICE[9416]: res_odbc.c:617 load_odbc_config: Registered ODBC class &#8216;asterisk&#8217; dsn-&gt;[MySQL-asterisk]<br />
[Feb  8 13:52:59] NOTICE[9417]: sorcery.c:1409 sorcery_object_load: Type &#8216;system&#8217; is not reloadable, maintaining previous values<br />
[Feb  8 13:52:59] WARNING[9416]: res_phoneprov.c:1231 get_defaults: Unable to find a valid server address or name.<br />
[Feb  8 13:52:59] ERROR[9416]: ari/config.c:314 process_config: No configured users for ARI<br />
[Feb  8 13:52:59] NOTICE[9416]: pbx_lua.c:1640 load_or_reload_lua_stuff: Lua PBX Switch loaded.<br />
[Feb  8 13:52:59] WARNING[9416]: res_config_pgsql.c:1355 parse_config: PostgreSQL RealTime: Not connected<br />
[Feb  8 13:52:59] NOTICE[9416]: chan_skinny.c:8424 config_load: Configuring skinny from skinny.conf<br />
[Feb  8 13:52:59] NOTICE[9416]: cel_custom.c:97 load_config: No mappings found in cel_custom.conf. Not logging CEL to custom CSVs.<br />
[Feb  8 13:52:59] NOTICE[9416]: app_queue.c:8839 reload_queue_rules: queuerules.conf has not changed since it was last loaded. Not taking any action.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1018#respond' onclick='return addComment.moveForm( "comment-1018", "1018", "respond", "2897" )' aria-label='Комментарий к записи Sergey'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1019">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1019">	08.02.2017 at 15:07</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Так это же не ошибки, а оповещения и предупреждения. В принципе, по тексту и так понятно, о чем идет речь. Это модули, которые не настроены. По хорошему их надо отключать и не загружать. Но у меня никак руки не доходят в них разобраться. И так работает 🙂</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1019#respond' onclick='return addComment.moveForm( "comment-1019", "1019", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1020">
		<div  class="comment odd alt depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/c64eba9dc85795a75551c2f430a76dd4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/c64eba9dc85795a75551c2f430a76dd4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Sergey</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1020">	08.02.2017 at 15:31</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Понял, спасибо! Да все работает, но смущали эти предупреждения. А понял что это модули, тока часть отключить не получалось, но как это обычно бывает, как только я опубликовал вопрос, так тут же что-то нашлось в инете. Вот тут &#8212; <a href="http://wikiadmin.net/asterisk/" rel="nofollow">http://wikiadmin.net/asterisk/</a> парень описал какие модули отключал у себя. Попробую сравнить имена в его списке и отключить у себя такие.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1020#respond' onclick='return addComment.moveForm( "comment-1020", "1020", "respond", "2897" )' aria-label='Комментарий к записи Sergey'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1021">
		<div  class="comment even depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/c64eba9dc85795a75551c2f430a76dd4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/c64eba9dc85795a75551c2f430a76dd4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Sergey</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1021">	08.02.2017 at 15:40</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Смушают оставшиеся 3 строки:<br />
WARNING[9416]: res_odbc.c:526 load_odbc_config: The &#8216;pooling&#8217;, &#8216;shared_connections&#8217;, &#8216;limit&#8217;, and &#8216;idlecheck&#8217; options were replaced by &#8216;max_connections&#8217;.  See res_odbc.conf.sample.<br />
NOTICE[9416]: res_odbc.c:617 load_odbc_config: Registered ODBC class &#8216;asterisk&#8217; dsn-&gt;[MySQL-asterisk]<br />
ERROR[9416]: ari/config.c:314 process_config: No configured users for ARI</p>
<p>по 1-му и 2-ому, мы же в мануале настраивали odbc конекты, если я отключу их, по идее работать не будет же то что настраивали с их помощью.<br />
по 3-ему Это ошибка непонятная, похожего модуля не нашел.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1021#respond' onclick='return addComment.moveForm( "comment-1021", "1021", "respond", "2897" )' aria-label='Комментарий к записи Sergey'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-1093">
		<div  class="comment odd alt thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/c64eba9dc85795a75551c2f430a76dd4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/c64eba9dc85795a75551c2f430a76dd4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Sergey</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1093">	17.02.2017 at 17:49</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Вопрос дилетанта: &#171;Вот поставили мы PJSIP и выбрали его в menuselect.&#187; Это означает что он по умолчанию на нем будет работать? Я просто почему спрашиваю, вот к примеру регистрирую ростелеком, не угадал с пароле и ошибка выдалась: &#187; WARNING[2397]:chan_sip.c:24286 handle_response_register: Forbidden &#8212; wrong password on authentication for REGISTER for &#8216;213162&#8217; to &#8216;10.10.10.100&#8217;&#187;<br />
И в ошибке четко видно &#171;chan_sip.c&#187;, разве там не должен быть pjsip? Как проверить что все работает на PJSIP ?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1093#respond' onclick='return addComment.moveForm( "comment-1093", "1093", "respond", "2897" )' aria-label='Комментарий к записи Sergey'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1385">
		<div  class="comment even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/4768304f1d30fb65ac66712be77310f4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/4768304f1d30fb65ac66712be77310f4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Дмитрий</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1385">	29.03.2017 at 11:22</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Добрый день!<br />
Что только не делал, выскакивает ошибка в веб-интерфейсе детализации звонков:<br />
PDO::errorInfo(): SQLSTATE[28000] [1045] Access denied for user &#8216;asterisk&#8217;@&#8217;localhost&#8217; (using password: YES)<br />
причём user у меня asterisk_user, всё делал по вашим конфигам.<br />
Где рыть, что копать? В логах ничего нет. Может, где-то можно включить режим логирования debug, и это что-то даст?&#8230;</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1385#respond' onclick='return addComment.moveForm( "comment-1385", "1385", "respond", "2897" )' aria-label='Комментарий к записи Дмитрий'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1386">
		<div  class="comment odd alt thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/4768304f1d30fb65ac66712be77310f4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/4768304f1d30fb65ac66712be77310f4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Дмитрий</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1386">	29.03.2017 at 11:47</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Разобрался.<br />
Почему-то после изменении необходимых параметров логина/пароля в файлике /var/www/html/inc/config.inc.php всё устранилось.<br />
А я правил /etc/phpMyAdmin/config.inc.php 🙁<br />
Допишите пожалуйста в статье полный путь этого файла..</p>
<p>И ещё&#8230; Огромное вам спасибо за ваш труд.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1386#respond' onclick='return addComment.moveForm( "comment-1386", "1386", "respond", "2897" )' aria-label='Комментарий к записи Дмитрий'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1391">
		<div  class="comment even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/4768304f1d30fb65ac66712be77310f4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/4768304f1d30fb65ac66712be77310f4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Дмитрий</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1391">	29.03.2017 at 14:52</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>А ещё, может кому-то потребуется, у меня никак asterisk не соединялся по odbc с mysql. Выдавал ошибку:<br />
res_odbc.c:958 odbc_obj_connect: res_odbc: Error SQLConnect=-1 errno=1045 [unixODBC][MySQL][ODBC 5.2(w) Driver]Access denied for user &#8216;asterisk_user&#8217;@&#8217;localhost&#8217; (using pass<br />
Проблема оказалась в том, что пароль пользователя asterisk_user содержал точку с запятой.<br />
Я так, понял, спецсимволов быть не должно.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1391#respond' onclick='return addComment.moveForm( "comment-1391", "1391", "respond", "2897" )' aria-label='Комментарий к записи Дмитрий'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1392">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1392">	29.03.2017 at 15:04</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Они могут быть, но их надо экранировать. Если нет большой необходимости, лучше некоторые спецсимволы не использовать. Например, с # обычно проблем не бывает, а вот с запятыми, кавычками очень часто.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1392#respond' onclick='return addComment.moveForm( "comment-1392", "1392", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-1414">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/4768304f1d30fb65ac66712be77310f4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/4768304f1d30fb65ac66712be77310f4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Дмитрий</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1414">	31.03.2017 at 12:47</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Я, конечно, извиняюсь, может быть вы мне подскажете, пол интернета перерыл.<br />
Мне нужно, чтобы ivr произносил числа (в т.ч. и отрицательные и дробные) из таблицы mysql на том же сервере (ну или на другом, значения не имеет).<br />
Сижу, всю голову поломал.<br />
Как можно написать это правило в extension.conf?<br />
Я бы туда ещё и рубли с копейками запихнул, которые в say.conf пытаюсь приделать.<br />
В интернете есть много примеров с произнесением времени и даты, но вот с деньгами проблема. Может, хоть немного поможете? Больше не к кому обратиться, за что зацепиться.<br />
Спасибо!</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1414#respond' onclick='return addComment.moveForm( "comment-1414", "1414", "respond", "2897" )' aria-label='Комментарий к записи Дмитрий'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1416">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1416">	31.03.2017 at 15:07</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Даже не знаю, с какой стороны подходить к решению данной задачи. Ни разу не сталкивался.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1416#respond' onclick='return addComment.moveForm( "comment-1416", "1416", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1630">
		<div  class="comment even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo avatar-default' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Аноним</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1630">	02.05.2017 at 16:47</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Я думаю вам путь в AGI. На хабре есть описание автоматизации текстов 1С + Астериск</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1630#respond' onclick='return addComment.moveForm( "comment-1630", "1630", "respond", "2897" )' aria-label='Комментарий к записи '>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-1426">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/c046b848091d36ed2ebe175754cfba5d?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/c046b848091d36ed2ebe175754cfba5d?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Марат</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1426">	03.04.2017 at 12:47</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Здравствуйте!<br />
Хотелось бы в первую очередь поблагодарить автора за действительно замечательную статью &#8212; СПАСИБО!<br />
Как полный новичок в IP-телефонии хотел бы спросить у гуру &#171;куда и где копать&#187; чтобы у локального пользователя заработал телефон в следующей ситуации:<br />
После выхода  с больничного у локального абонента перестала работать связь (ни туды и ни сюды). Забрался через браузер в FreePBX и в логах по нему нашел такую запись:<br />
&#171;&#8230; LocalAddress=&#187;IPV4/TCP/0.0.0.0/5038&#8243;,RemoteAddress=&#187;IPV4/TCP/127.0.0.1 &#8230;&#187;</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1426#respond' onclick='return addComment.moveForm( "comment-1426", "1426", "respond", "2897" )' aria-label='Комментарий к записи Марат'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1558">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo avatar-default' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Victor_VM</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1558">	20.04.2017 at 13:39</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Здравствуйте. Подскажите пожалуйста, у нас настроена атс Астериск. настроено 6 удаленных офисов. через впн. Телефоны грандстрим. Так вот сегодня на одной точке, возникла проблема. Если во время входящего разговора, приходит ещё один внешний звонок, то оператор перестаёт слышать абонента с которым уже разговаривает.<br />
Куда смотреть? интересно то. что если звонить внутри сети. т.е. разговаривает оператор точки 1 с оператором точки 2 и звонит на точку1 оператор точки3, то никаких проблем со звуком нет. Только при внешних звонках.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1558#respond' onclick='return addComment.moveForm( "comment-1558", "1558", "respond", "2897" )' aria-label='Комментарий к записи Victor_VM'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1560">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1560">	20.04.2017 at 16:57</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Даже нет идей. Если раньше все работало, то надо смотреть, что изменилось за последнее время.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1560#respond' onclick='return addComment.moveForm( "comment-1560", "1560", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1567">
		<div  class="comment even depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo avatar-default' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Victor_VM</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1567">	21.04.2017 at 08:56</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Ничего не менялось. в CDR репортсе, в это время нет записей о том. что я по внутренниму номеру разговаривал с проблемной точкой. А мы говорили и не раз и не по 10 секунд.<br />
А сегодня история повторилась. Я попытался с внешнего телефона дозвониться до точки, сработал автоответчик и когда подняли трубку, я кроме оператора. слышал длинные гудки. как будто мне ещё не ответили.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1567#respond' onclick='return addComment.moveForm( "comment-1567", "1567", "respond", "2897" )' aria-label='Комментарий к записи Victor_VM'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-1612">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/90af7923f068fd1e8b1e1ebe47c61f9e?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/90af7923f068fd1e8b1e1ebe47c61f9e?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Александр</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1612">	27.04.2017 at 21:29</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Здравствуйте.<br />
А не могли бы вы написать такую же подробную статью по отправке и приему факсов ..и при]м факса на емейл? спасибо</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1612#respond' onclick='return addComment.moveForm( "comment-1612", "1612", "respond", "2897" )' aria-label='Комментарий к записи Александр'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1613">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1613">	28.04.2017 at 00:26</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Я с факсами вообще не связываюсь. Мороки много &#8212; толку мало. Факс отжившая технология, вообще не вижу смысла ими пользоваться. Самый простой вариант &#8212; купить voip шлюз с аналоговой линией и подключить факс к нему. Хотя еще проще &#8212; воспользоваться онлайн сервисом каким-нибудь по приему факса. Я делал так, когда факс просили. Но обычно я отговариваю от факса. Зачем он нужен?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1613#respond' onclick='return addComment.moveForm( "comment-1613", "1613", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1631">
		<div  class="comment odd alt depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo avatar-default' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Аноним</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1631">	02.05.2017 at 16:50</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Аналоговая линия вообще не вариант. Факс все еще востребован в глубинке. А вот любой SIP провайдер с нормальной поддержкой T38 поможет, + допиливаение астериска</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1631#respond' onclick='return addComment.moveForm( "comment-1631", "1631", "respond", "2897" )' aria-label='Комментарий к записи '>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-1619">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/cffc0dafe7c598c329ff80728036d7c4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/cffc0dafe7c598c329ff80728036d7c4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Виктор</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1619">	29.04.2017 at 10:05</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>День добрый в инете не нешел подробностей по этой строчки exten =&gt; _X!,1,HangUp()<br />
почему именно так вешаете трубку?<br />
конкретно два вопроса<br />
1) что даёт восклецательный знак?<br />
2) почему приоретет 1 а не n ?<br />
заранее спасибо</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1619#respond' onclick='return addComment.moveForm( "comment-1619", "1619", "respond", "2897" )' aria-label='Комментарий к записи Виктор'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1620">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/cffc0dafe7c598c329ff80728036d7c4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/cffc0dafe7c598c329ff80728036d7c4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Виктор</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1620">	29.04.2017 at 10:38</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>+ exten =&gt; _X!,1,HangUp() это же наверное можно вписать в блок [default] и не испоьовать include верно?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1620#respond' onclick='return addComment.moveForm( "comment-1620", "1620", "respond", "2897" )' aria-label='Комментарий к записи Виктор'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1621">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/cffc0dafe7c598c329ff80728036d7c4?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/cffc0dafe7c598c329ff80728036d7c4?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">виктор</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1621">	29.04.2017 at 17:24</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>и спасибо за суперский мануал!</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1621#respond' onclick='return addComment.moveForm( "comment-1621", "1621", "respond", "2897" )' aria-label='Комментарий к записи виктор'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1828">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/40c41c79bfe13f222eccd9252e90de3d?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/40c41c79bfe13f222eccd9252e90de3d?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Илья</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1828">	01.06.2017 at 13:19</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Большое спасибо за подробную статью! Очень познавательно и полезно.<br />
Скажите пожалуйста, правильно ли я понимаю, что использование внешнего SIP-провайдера (zadarma в примере) опционально? Т.е., как я понял, необходимо для связи нашего Астерикса с ТФОП?<br />
Например, можно ли поднять Астерикс на машине с белым IP, абоненты А и Б через интернет подключены к этому Астериксу. Возможно ли абоненту А звонить через городскую линию абонента Б?</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1828#respond' onclick='return addComment.moveForm( "comment-1828", "1828", "respond", "2897" )' aria-label='Комментарий к записи Илья'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-1887">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/cb4fbca35cecb242807dfb456f193d75?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/cb4fbca35cecb242807dfb456f193d75?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn"><a href='http://anisimov.top' rel='external nofollow' class='url'>Алексей</a></cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1887">	12.06.2017 at 15:55</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Статья супер! Пройдя поэтапно получилось разобраться в астере, и начал понимать конфиги. Перед этим пробовал freepbx, так и не смог совладать, с конфигами както проще, знаешь где что. Поставили задачу по переезду коллцентра на свое железо, благо всего 6 опеаторов работает.</p>
<p>Один вопрос. Не играет приветствие, ни Background, ни Playback. В трубке тишина, гудков тоже нет.<br />
wav конвертил, брал готовые, нет звука. В чем проблема может быть? Ставил все по статье, ничего лишнего, из коробки.</p>
<p>;голосовое приветствие<br />
[ivr-main]<br />
exten =&gt; s,1,Set(CALLERID(name)=ZADARMA)<br />
exten =&gt; s,2,Answer()<br />
exten =&gt; s,n,Playback(queue-callswaiting) ;/etc/asterisk/ivr/welcome<br />
exten =&gt; s,n,Queue(queue-5zvezd,Tt)</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1887#respond' onclick='return addComment.moveForm( "comment-1887", "1887", "respond", "2897" )' aria-label='Комментарий к записи Алексей'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1888">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1888">	12.06.2017 at 20:26</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Надо включить full лог и посмотреть на сообщения в момент, когда должно проигрываться приветствие. Скорее всего что-то с музыкальными файлами &#8212; либо формат не тот, либо путь к файлу не правильно указан.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1888#respond' onclick='return addComment.moveForm( "comment-1888", "1888", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-1890">
		<div  class="comment even depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/cb4fbca35cecb242807dfb456f193d75?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/cb4fbca35cecb242807dfb456f193d75?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn"><a href='http://anisimov.top' rel='external nofollow' class='url'>Алексей</a></cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1890">	12.06.2017 at 22:05</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Подставлял родные мелодии из самого астера. Также тишина. В логах написано что типа играет.<br />
 == Using SIP RTP CoS mark 5<br />
    &#8212; Executing [zadarma@zadarma-in:1] BackGround(&#171;SIP/zadarma-00000015&#187;, &#171;/etc/asterisk/ivr/welcome_sold&#187;) in new stack<br />
    &#8212;  Playing &#8216;/etc/asterisk/ivr/welcome_sold.slin&#8217; (language &#8216;ru&#8217;)<br />
    &#8212; Executing [zadarma@zadarma-in:2] Dial(&#171;SIP/zadarma-00000015&#187;, &#171;SIP/100&#187;) in new stack<br />
  == Using SIP RTP CoS mark 5<br />
    &#8212; Called SIP/100<br />
    &#8212; SIP/100-00000016 is ringing<br />
  == Spawn extension (zadarma-in, zadarma, 2) exited non-zero on &#8216;SIP/zadarma-00000015&#8217;<br />
в папке лежит wav файл, в логах slin. Вот это пока не понятно, вроде как на лету декодит астер.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1890#respond' onclick='return addComment.moveForm( "comment-1890", "1890", "respond", "2897" )' aria-label='Комментарий к записи Алексей'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-1901">
		<div  class="comment odd alt thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/2be033a80d8d7f0f2b467953bfb016c7?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/2be033a80d8d7f0f2b467953bfb016c7?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Данил</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-1901">	13.06.2017 at 21:21</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Здравствуйте! Столкнулся с такой проблемой: при попытке состыковать астериск и MySql через ODBC, по написанному в Вашей статье образцу, получаю ошибку: res_odbc.c:962 odbc_obj_connect: res_odbc: Error SQLConnect=-1 errno=-201315904 [iODBC][Driver Manager]MySQL: cannot open shared object file: No such file or directory. При этом isql -v MYSQL-asterisk asterisk_user 12345678 спокойно соединяется с БД.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=1901#respond' onclick='return addComment.moveForm( "comment-1901", "1901", "respond", "2897" )' aria-label='Комментарий к записи Данил'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-2305">
		<div  class="comment even thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/c5841a4c6754c3f0c36c3c204b3dcea5?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/c5841a4c6754c3f0c36c3c204b3dcea5?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn"><a href='http://smolenskcci.ru' rel='external nofollow' class='url'>Карен Григорьевич</a></cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2305">	03.09.2017 at 15:59</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>На виртуальной машине поднял сервер Астерикса за натом. При звонке с одного софтофона на другой случилась проблема. Не было слышно 1 абонента. Звонил шел через внешний ип по внутреннему номеру. 100 слышно, 101 нет. пробовал directmedia, пробросы портов на роутере, отрубал iptables, а помогло указание внутренней под сети сервера в sip.conf &#8212; localnet=192.168.1.0/255.255.255.0 над externaddr</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2305#respond' onclick='return addComment.moveForm( "comment-2305", "2305", "respond", "2897" )' aria-label='Комментарий к записи Карен Григорьевич'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2309">
		<div  class="comment odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/c5841a4c6754c3f0c36c3c204b3dcea5?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/c5841a4c6754c3f0c36c3c204b3dcea5?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn"><a href='http://smolenskcci.ru' rel='external nofollow' class='url'>Карен Григорьевич</a></cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2309">	04.09.2017 at 21:52</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>дополнение для sip.conf для поддержки видео звонков.</p>
<p>[general]<br />
videosupport=yes</p>
<p>[managers-phones](!)<br />
type=friend<br />
context=call-out<br />
secret=123<br />
host=dynamic<br />
nat=no<br />
qualify=yes<br />
canreinvite=no<br />
callgroup=1<br />
pickupgroup=1<br />
call-limit=1<br />
dtmfmode=auto<br />
disallow=all<br />
allow=alaw<br />
allow=ulaw<br />
allow=g729<br />
allow=g723<br />
allow=g722<br />
allow=h261<br />
allow=h263<br />
allow=h263p</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2309#respond' onclick='return addComment.moveForm( "comment-2309", "2309", "respond", "2897" )' aria-label='Комментарий к записи Карен Григорьевич'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-2334">
		<div  class="comment even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d4bec846b26fed595f2e38bcb12ffc43?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d4bec846b26fed595f2e38bcb12ffc43?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Олег</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2334">	07.09.2017 at 17:07</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Добрый день!<br />
очень помогают ваши статьи. Спасибо вам за этот труд.<br />
Все получалось до пункта &#171;запись разговора&#187;, а именно на команде<br />
# tar zxvf lame-3.*<br />
текст ошибки:<br />
/usr/src# tar zxvf lame-3.*<br />
tar (child): lame-3.98.4: Функция read завершилась с ошибкой: Это каталог<br />
tar (child): Начало ленты, завершение работы<br />
tar (child): Error is not recoverable: exiting now</p>
<p>gzip: stdin: unexpected end of file<br />
tar: Child returned status 2<br />
tar: Error is not recoverable: exiting now</p>
<p>Я новичок и в основном делаю все по вашим командам, большинство не понимая. но все таки пытаюсь разобраться.<br />
Не могли бы вы мне помочь, что пошло не так?<br />
и если не трудно можете привести пример файла extensions.conf в варианте, если звонки будут просто писаться в какую-то папку, без конвертирования в mp3 и без заморочек с БД.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2334#respond' onclick='return addComment.moveForm( "comment-2334", "2334", "respond", "2897" )' aria-label='Комментарий к записи Олег'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2335">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2335">	07.09.2017 at 17:11</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>tar (child): lame-3.98.4: Функция read завершилась с ошибкой: Это каталог</p>
<p>Эта ошибка говорит о том, что имя файла с маской &#171;lame-3.*&#187; возвращает имя каталога, а не файл архива. Вместо lame-3.* напишите полностью имя скачанного файла.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2335#respond' onclick='return addComment.moveForm( "comment-2335", "2335", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2338">
		<div  class="comment even depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d4bec846b26fed595f2e38bcb12ffc43?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d4bec846b26fed595f2e38bcb12ffc43?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Олег</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2338">	07.09.2017 at 18:16</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Спасибо помогло.<br />
но теперь ошибка на команде #make</p>
<p>Makefile:306: ошибка выполнения рецепта для цели «xmm_quantize_sub.lo»<br />
make[3]: *** [xmm_quantize_sub.lo] Ошибка 1<br />
make[3]: выход из каталога «/usr/src/lame-3.98.4/libmp3lame/vector»<br />
Makefile:489: ошибка выполнения рецепта для цели «all-recursive»<br />
make[2]: *** [all-recursive] Ошибка 1<br />
make[2]: выход из каталога «/usr/src/lame-3.98.4/libmp3lame»<br />
Makefile:312: ошибка выполнения рецепта для цели «all-recursive»<br />
make[1]: *** [all-recursive] Ошибка 1<br />
make[1]: выход из каталога «/usr/src/lame-3.98.4»<br />
Makefile:240: ошибка выполнения рецепта для цели «all»<br />
make: *** [all] Ошибка 2</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2338#respond' onclick='return addComment.moveForm( "comment-2338", "2338", "respond", "2897" )' aria-label='Комментарий к записи Олег'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2339">
		<div  class="comment byuser comment-author-zerox bypostauthor odd alt depth-4 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2339">	07.09.2017 at 19:08</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Возможно файл скачался не полностью. В принципе, можно не ставить lame и либо вообще отключить запись разговоров, либо оставить их несжатыми в wav. Потом уже, после настройки основного, вернуться к этому вопросу.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2339#respond' onclick='return addComment.moveForm( "comment-2339", "2339", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2341">
		<div  class="comment even depth-5 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d4bec846b26fed595f2e38bcb12ffc43?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d4bec846b26fed595f2e38bcb12ffc43?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Олег</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2341">	08.09.2017 at 09:15</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>В любом случае спасибо. в остальном проблем не возникло.<br />
Для таких новичков как я, не хватает пояснений по каждой команде. Но тогда статья удвоится в объеме&#8230;<br />
Успехов Вам.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2341#respond' onclick='return addComment.moveForm( "comment-2341", "2341", "respond", "2897" )' aria-label='Комментарий к записи Олег'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-2388">
		<div  class="comment odd alt thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d6fc9565abb901ebb3b3d75b492dddb1?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d6fc9565abb901ebb3b3d75b492dddb1?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">вадим</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2388">	15.09.2017 at 18:28</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>tar -xjvf pjproject-2.*<br />
у меня не отрабатывает, не подскажите что это?<br />
пишет<br />
[root@MiWiFi-R1CL-srv src]# wget <a href="http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2" rel="nofollow">http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2</a><br />
&#8212;2017-09-15 18:25:41&#8212;  <a href="http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2" rel="nofollow">http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2</a><br />
Resolving <a href="http://www.pjsip.org" rel="nofollow">http://www.pjsip.org</a> (www.pjsip.org)&#8230; 207.38.94.48<br />
Connecting to <a href="http://www.pjsip.org" rel="nofollow">http://www.pjsip.org</a> (www.pjsip.org)|207.38.94.48|:80&#8230; connected.<br />
HTTP request sent, awaiting response&#8230; 200 OK<br />
Length: 4631778 (4.4M) [application/x-bzip2]<br />
Saving to: ‘pjproject-2.4.tar.bz2.4’</p>
<p>100%[======================================&gt;] 4,631,778    853KB/s   in 5.9s</p>
<p>2017-09-15 18:25:47 (763 KB/s) &#8212; ‘pjproject-2.4.tar.bz2.4’ saved [4631778/4631778]</p>
<p>[root@MiWiFi-R1CL-srv src]# tar -xjvf pjproject-2.*                             tar (child): bzip2: Cannot exec: No such file or directory<br />
tar (child): Error is not recoverable: exiting now<br />
tar: Child returned status 2<br />
tar: Error is not recoverable: exiting now</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2388#respond' onclick='return addComment.moveForm( "comment-2388", "2388", "respond", "2897" )' aria-label='Комментарий к записи вадим'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2389">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2389">	15.09.2017 at 18:31</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Напишите полностью имя файла &#8212; pjproject-2.4.tar.bz2.4. Не понял только, почему на конце .4, скорее всего вы этот файл скачали уже 4 раза, поэтому команда tar -xjvf pjproject-2.* не понимает, какой из этих файлов нужно распаковать.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2389#respond' onclick='return addComment.moveForm( "comment-2389", "2389", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2391">
		<div  class="comment odd alt depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d6fc9565abb901ebb3b3d75b492dddb1?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d6fc9565abb901ebb3b3d75b492dddb1?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">вадим</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2391">	15.09.2017 at 20:06</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>таже беда, переустановил cent<br />
php-pdo.x86_64 0:5.4.16-42.el7<br />
  php-php-gettext.noarch 0:1.0.12-1.el7<br />
  php-tcpdf.noarch 0:6.2.13-1.el7<br />
  php-tcpdf-dejavu-sans-fonts.noarch 0:6.2.13-1.el7<br />
  php-tidy.x86_64 0:5.4.16-7.el7<br />
  pixman.x86_64 0:0.34.0-1.el7<br />
  pixman-devel.x86_64 0:0.34.0-1.el7<br />
  procmail.x86_64 0:3.22-36.el7<br />
  pulseaudio-libs.x86_64 0:10.0-3.el7<br />
  rsync.x86_64 0:3.0.9-18.el7<br />
  slang-devel.x86_64 0:2.2.4-11.el7<br />
  subversion-libs.x86_64 0:1.7.14-11.el7_4<br />
  t1lib.x86_64 0:5.1.2-14.el7<br />
  trousers.x86_64 0:0.3.14-2.el7<br />
  unbound-libs.x86_64 0:1.4.20-34.el7<br />
  uuid.x86_64 0:1.6.2-26.el7<br />
  vim-common.x86_64 2:7.4.160-2.el7<br />
  vim-filesystem.x86_64 2:7.4.160-2.el7<br />
  wavpack.x86_64 0:4.60.1-9.el7<br />
  xorg-x11-proto-devel.noarch 0:7.7-20.el7<br />
  xz-devel.x86_64 0:5.2.2-1.el7<br />
  zlib-devel.x86_64 0:1.2.7-17.el7</p>
<p>Complete!<br />
[root@MiWiFi-R1CL-srv ~]# cd /usr/src<br />
[root@MiWiFi-R1CL-srv src]# wget <a href="http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2" rel="nofollow">http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2</a><br />
&#8212;2017-09-15 12:56:00&#8212;  <a href="http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2" rel="nofollow">http://www.pjsip.org/release/2.4/pjproject-2.4.tar.bz2</a><br />
Resolving <a href="http://www.pjsip.org" rel="nofollow">http://www.pjsip.org</a> (www.pjsip.org)&#8230; 207.38.94.48<br />
Connecting to <a href="http://www.pjsip.org" rel="nofollow">http://www.pjsip.org</a> (www.pjsip.org)|207.38.94.48|:80&#8230; connected.<br />
HTTP request sent, awaiting response&#8230; 200 OK<br />
Length: 4631778 (4.4M) [application/x-bzip2]<br />
Saving to: ‘pjproject-2.4.tar.bz2’</p>
<p>100%[======================================&gt;] 4,631,778   1.27MB/s   in 3.6s</p>
<p>2017-09-15 12:56:04 (1.22 MB/s) &#8212; ‘pjproject-2.4.tar.bz2’ saved [4631778/4631778]</p>
<p>[root@MiWiFi-R1CL-srv src]# tar -xjvf pjproject-2.*<br />
tar (child): bzip2: Cannot exec: No such file or directory<br />
tar (child): Error is not recoverable: exiting now<br />
tar: Child returned status 2<br />
tar: Error is not recoverable: exiting now<br />
[root@MiWiFi-R1CL-srv src]# tar xjvf pjproject-2.*<br />
tar (child): bzip2: Cannot exec: No such file or directory<br />
tar (child): Error is not recoverable: exiting now<br />
tar: Child returned status 2<br />
tar: Error is not recoverable: exiting now<br />
[root@MiWiFi-R1CL-srv src]#</p>
<p>на 6.4 отрабатывали следующие<br />
wget <a href="http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/dahdi-linux-complete-current.tar.gz" rel="nofollow">http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/dahdi-linux-complete-current.tar.gz</a><br />
wget <a href="http://downloads.asterisk.org/pub/telephony/libpri/old/libpri-1.4.15.tar.gz" rel="nofollow">http://downloads.asterisk.org/pub/telephony/libpri/old/libpri-1.4.15.tar.gz</a><br />
wget <a href="http://downloads.asterisk.org/pub/telephony/asterisk/asterisk-11-current.tar.gz" rel="nofollow">http://downloads.asterisk.org/pub/telephony/asterisk/asterisk-11-current.tar.gz</a><br />
d) Распаковываем скаченные архивы:<br />
tar zxvf dahdi-linux-complete*<br />
tar zxvf libpri*<br />
tar zxvf asterisk*</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2391#respond' onclick='return addComment.moveForm( "comment-2391", "2391", "respond", "2897" )' aria-label='Комментарий к записи вадим'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2392">
		<div  class="comment byuser comment-author-zerox bypostauthor even depth-4 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/021a5c3751266898c63b1b4431985d02?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Zerox</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2392">	15.09.2017 at 20:08</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Я же написал, используйте полное имя файла в команде распаковки, а не маску со звездочкой на конце.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2392#respond' onclick='return addComment.moveForm( "comment-2392", "2392", "respond", "2897" )' aria-label='Комментарий к записи Zerox'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2393">
		<div  class="comment odd alt depth-5 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d6fc9565abb901ebb3b3d75b492dddb1?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d6fc9565abb901ebb3b3d75b492dddb1?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">вадим</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2393">	15.09.2017 at 20:29</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>да, но перед этим советую проделать следующее, тогда точно будет работать<br />
yum install -y gcc gcc-c++ lynx bison mariadb-devel mariadb-server mariadb gmime-devel psmisc php php-mysql php-pear php-mbstring yum install tftp-server httpd make ncurses-devel libtermcap-devel sendmail sendmail-cf caching-nameserver sox newt-devel libxml2-devel libtiff-devel audiofile-devel gtk2-devel subversion kernel-devel yum install kernel-devel-$(uname -r) git subversion kernel-devel php-process crontabs cronie cronie-anacron wget vim php-xml uuid-devel libtool sqlite-devel libuuid-devel bzip2<br />
systemctl enable mariadb.service systemctl start mariadb.service</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2393#respond' onclick='return addComment.moveForm( "comment-2393", "2393", "respond", "2897" )' aria-label='Комментарий к записи вадим'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li id="comment-2481">
		<div  class="comment even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d3aa623ccff154e8a98bf1d3c0fa3768?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d3aa623ccff154e8a98bf1d3c0fa3768?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Лидия</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2481">	26.09.2017 at 07:25</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Добрый день. Вы можете подсказать, как должны выглядеть настройки sip.conf, если я не подключаюсь к провайдеру, а внешние номера прокидываю на sip-шлюз (плата TM.IP) в нашей АТС. Для одного номера (2055) работает, а вот как сделать чтобы и на другие номера можно было звонить? номера серии 7XXX &#8212; sip,  2055 &#8212; номер УПАТС.  конфиг выглядит так:<br />
Extensions.conf</p>
<p>[general]<br />
static=yes<br />
writeprotect=no<br />
[globals]<br />
[default]</p>
<p>[handup-sip]<br />
exten =&gt; _XX!,1,HangUp()</p>
<p>[call-out]</p>
<p>exten =&gt; _XXXX,1,Dial(SIP/${EXTEN})<br />
include =&gt; handup-sip<br />
exten =&gt; _XXXX.,1,Dial(SIP/${EXTEN}@2055)</p>
<p>[call-in]<br />
exten =&gt; 2055,1,Dial(SIP/7000)</p>
<p>sip.conf</p>
<p>[general]<br />
externaddr=192.168.0.140:5060<br />
language=ru<br />
context=default<br />
allowoverlap=no<br />
udpbindaddr=0.0.0.0<br />
tcpenable=no<br />
tcpbindaddr=0.0.0.0<br />
transport=udp<br />
srvlookup=yes<br />
allowguest=no<br />
limitonpeers=yes</p>
<p>[authentication]</p>
<p>[managers-phones](!)<br />
type=friend<br />
context=call-out<br />
secret=123<br />
host=dynamic<br />
nat=no<br />
qualify=yes<br />
canreinvite=no<br />
callgroup=1<br />
pickupgroup=1<br />
call-limit=1<br />
dtmfmode=auto<br />
disallow=all<br />
allow=alaw<br />
allow=ulaw<br />
allow=g729<br />
allow=g723<br />
allow=g722</p>
<p>[7000](managers-phones)<br />
callerid=&#187;Number 7000&#8243;<br />
[7001](managers-phones)<br />
callerid=&#187;Number 7001&#8243;<br />
[7002](managers-phones)<br />
callerid=&#187;Number 7002&#8243; </p>
<p>[2055]<br />
host=192.168.0.140<br />
insecure=invite,port<br />
type=friend<br />
fromdomain=192.168.0.140<br />
disallow=all<br />
allow=alaw<br />
dtmfmode=auto<br />
secret=123<br />
defaultuser=2055<br />
trunkname=2055<br />
fromuser=2055<br />
callbackextensions=2055</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2481#respond' onclick='return addComment.moveForm( "comment-2481", "2481", "respond", "2897" )' aria-label='Комментарий к записи Лидия'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-2486">
		<div  class="comment odd alt thread-even depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/d3aa623ccff154e8a98bf1d3c0fa3768?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/d3aa623ccff154e8a98bf1d3c0fa3768?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Лидия</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2486">	26.09.2017 at 12:12</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>сама разобралась. все ок.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2486#respond' onclick='return addComment.moveForm( "comment-2486", "2486", "respond", "2897" )' aria-label='Комментарий к записи Лидия'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li id="comment-2531">
		<div  class="comment even thread-odd thread-alt depth-1 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/605e785e4e15200d8df64c5051d061a1?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/605e785e4e15200d8df64c5051d061a1?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Михаил</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2531">	29.09.2017 at 12:12</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Здравствуйте, спасибо за статью, на многое открыли глаза.<br />
Единственное что: не показывает сохраненный звонок на web интерфейсе.<br />
в config.php изменил на свою папку и все равно без изменений.</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2531#respond' onclick='return addComment.moveForm( "comment-2531", "2531", "respond", "2897" )' aria-label='Комментарий к записи Михаил'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2532">
		<div  class="comment odd alt depth-2 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/605e785e4e15200d8df64c5051d061a1?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/605e785e4e15200d8df64c5051d061a1?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Михаил</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2532">	29.09.2017 at 12:47</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>Если ввести ip Сервера/records то файлы видны хоть и в wav.<br />
А вот через веб сервер их не видно</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2532#respond' onclick='return addComment.moveForm( "comment-2532", "2532", "respond", "2897" )' aria-label='Комментарий к записи Михаил'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li id="comment-2555">
		<div  class="comment even depth-3 comment-wrap" >
			<div class="comment-avatar"><img alt='' src='https://secure.gravatar.com/avatar/605e785e4e15200d8df64c5051d061a1?s=65&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/605e785e4e15200d8df64c5051d061a1?s=130&amp;d=identicon&amp;r=g 2x' class='avatar avatar-65 photo' height='65' width='65' /></div>

			<div class="comment-content">
				<div class="author-comment">
					<cite class="fn">Михаил</cite> 					<div class="comment-meta commentmetadata"><a href="https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/#comment-2555">	04.10.2017 at 12:54</a></div><!-- .comment-meta .commentmetadata -->
					<div class="clear"></div>
				</div>
			
									
				<p>заработало. теперь проблема осталась только в том, что не конвертирует из wav в mp3</p>
			</div>
			<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://serveradmin.ru/nastroyka-servera-telefonii-asterisk-s-nulya/?replytocom=2555#respond' onclick='return addComment.moveForm( "comment-2555", "2555", "respond", "2897" )' aria-label='Комментарий к записи Михаил'>Ответить</a></div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
				
		 

			
					
			
		</div>
	</div><!-- #comments-box -->
			

<div class="clear"></div>
	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Добавить комментарий <small><a rel="nofollow" id="cancel-comment-reply-link" href="/nastroyka-servera-telefonii-asterisk-s-nulya/#respond" style="display:none;">Отменить ответ</a></small></h3>			<form action="https://serveradmin.ru/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate>
				<p class="comment-notes"><span id="email-notes">Ваш e-mail не будет опубликован.</span></p><p class="comment-form-comment"><label for="comment">Комментарий</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p><div  id="g-recaptcha-0" class="g-recaptcha" data-sitekey="6Lf-awsUAAAAANpq5nIhOaMMW6KOoPLtqoNqzHjw" data-theme="light"></div><noscript>Пожалуйста, разрешите JavaScript чтобы отправить эту форму.<br></noscript></p><p class="comment-form-author"><label for="author">Имя</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">E-mail</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" /></p>
<p class="comment-form-url"><label for="url">Сайт</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Отправить комментарий" /> <input type='hidden' name='comment_post_ID' value='2897' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><!-- BEGIN: Email notification plugin by Elance360 --><p><label for='subscribe-reloaded'> Подписка на новые комментарии:<br /><select name='subscribe-reloaded' id='subscribe-reloaded'><option value='none'>Не отправлять уведомлений</option><option value='yes' selected='selected'>Отправить уведомление только при ответе на мой комментарий</option><option value='replies'>Отправить уведомление при появлении любого комментария</option></select></label></p><!-- END: Email notification plugin by Elance360 -->			</form>
			</div><!-- #respond -->
	

</div><!-- #comments -->
		
	</div><!-- .content -->
<aside id="sidebar">
	<div class="theiaStickySidebar">
<div id="text-html-widget-21" class="widget text-html"><div class="widget-top"><h4> </h4><div class="stripe-line"></div></div>
						<div class="widget-container"><div style="text-align:center;"><div id="kwork-widget"></div>
            <script type="text/javascript">
                (function() {
                    widgetOptions = {
                        width: 350,
                        catType:'42',    
                        count:'5',
                        ref:249810};

                    var script = document.createElement('script');
                    script.type = 'text/javascript';
                    script.async = true;
                    script.src = "https://kwork.ru/js/kwork_widget.js";
                    document.getElementsByTagName('head')[0].appendChild(script);
                })();
            </script>
				</div><div class="clear"></div></div></div><!-- .widget /--><div id="text-html-widget-8" class="widget text-html"><div class="widget-top"><h4>Хостинг</h4><div class="stripe-line"></div></div>
						<div class="widget-container"><div style="text-align:center;"><table style="width: 330px; height: 70px;" cellspacing="3">
<tbody>
<tr>
<td width="120"><a href="https://www.ihor.ru/?from=84981" onclick="trackOutboundLink('https://www.ihor.ru/?from=84981'); return false;" target="_blank"><img class="alignleft wp-image-2659 size-full" title="Надежный и быстрый хостинг на SSD за небольшие деньги" src="https://serveradmin.ru/wp-content/uploads/2016/01/hosting.gif" alt="Быстрый хостинг" width="120" height="60" /></a></td>
<td style="line-height:20px;padding:.4em;text-align: left;">Надежный и быстрый хостинг на SSD за небольшие деньги. Рекомендую, использую сам.</td>
</tr>
</tbody>
</table>
				</div><div class="clear"></div></div></div><!-- .widget /--><div id="text-html-widget-13" class="widget text-html"><div class="widget-top"><h4>Группа Вконтакте</h4><div class="stripe-line"></div></div>
						<div class="widget-container"><div ><script type="text/javascript" src="//vk.com/js/api/openapi.js?126"></script>

<!-- VK Widget -->
<div id="vk_groups"></div>
<script type="text/javascript">
VK.Widgets.Group("vk_groups", {redesign: 1, mode: 1, width: "350", height: "400", color1: 'FFFFFF', color2: '000000', color3: '5E81A8'}, 95686747);
</script>
				</div><div class="clear"></div></div></div><!-- .widget /--><div id="text-html-widget-20" class="widget text-html"><div class="widget-top"><h4>Чат в Telegram</h4><div class="stripe-line"></div></div>
						<div class="widget-container"><div style="text-align:center;"><a href="https://t.me/joinchat/AAAAAD_H1pmIcX3yfRlG_Q" target="_blank"><img class="aligncenter wp-image-4864 size-full" src="https://serveradmin.ru/wp-content/uploads/2017/02/chat-2.png" alt="Чат системных администраторов" width="330" height="45" /></a>
				</div><div class="clear"></div></div></div><!-- .widget /--><div id="text-html-widget-6" class="widget text-html"><div class="widget-top"><h4>Прикольная игра</h4><div class="stripe-line"></div></div>
						<div class="widget-container"><div ><a href="https://serveradmin.ru/igra-sistemnyiy-administrator/"><img class="aligncenter wp-image-2248 size-full" title="Симулятор системного администратора" src="https://serveradmin.ru/wp-content/uploads/2015/10/sysadmin-game.png" alt="Игра Системный администратор" width="330" height="245" />
				</div><div class="clear"></div></div></div><!-- .widget /--><div id="posts-list-widget-2" class="widget posts-list"><div class="widget-top"><h4>Популярное		</h4><div class="stripe-line"></div></div>
						<div class="widget-container">				<ul>
								<li >
						
				<div class="post-thumbnail">
					<a href="https://serveradmin.ru/vault-virus/" title="Как расшифровать файл с расширением vault после вируса шифровальщика" rel="bookmark"><img width="110" height="75" src="https://serveradmin.ru/wp-content/uploads/2015/04/virus-110x75.png" class="attachment-tie-small size-tie-small wp-post-image" alt="" /><span class="fa overlay-icon"></span></a>
				</div><!-- post-thumbnail /-->
							<h3><a href="https://serveradmin.ru/vault-virus/">Как расшифровать файл с расширением vault после вируса шифровальщика</a></h3>
				 <span class="tie-date"><i class="fa fa-clock-o"></i>12.08.2015</span>									<span class="post-views-widget"><span class="post-views"><i class="fa fa-eye"></i>264,175 </span> <span>
							</li>
				<li >
						
				<div class="post-thumbnail">
					<a href="https://serveradmin.ru/bazovaya-nastroyka-routera-mikrotik/" title="Как настроить микротик routerboard RB951G-2HnD" rel="bookmark"><img width="110" height="75" src="https://serveradmin.ru/wp-content/uploads/2015/12/mikrotik-settings-110x75.png" class="attachment-tie-small size-tie-small wp-post-image" alt="" /><span class="fa overlay-icon"></span></a>
				</div><!-- post-thumbnail /-->
							<h3><a href="https://serveradmin.ru/bazovaya-nastroyka-routera-mikrotik/">Как настроить микротик routerboard RB951G-2HnD</a></h3>
				 <span class="tie-date"><i class="fa fa-clock-o"></i>20.12.2015</span>									<span class="post-views-widget"><span class="post-views"><i class="fa fa-eye"></i>222,118 </span> <span>
							</li>
				<li >
						
				<div class="post-thumbnail">
					<a href="https://serveradmin.ru/centos-7-nastroyka-servera/" title="CentOS 7 настройка сервера" rel="bookmark"><img width="110" height="75" src="https://serveradmin.ru/wp-content/uploads/2015/03/centos-configure-110x75.png" class="attachment-tie-small size-tie-small wp-post-image" alt="Centos настройка" /><span class="fa overlay-icon"></span></a>
				</div><!-- post-thumbnail /-->
							<h3><a href="https://serveradmin.ru/centos-7-nastroyka-servera/">CentOS 7 настройка сервера</a></h3>
				 <span class="tie-date"><i class="fa fa-clock-o"></i>20.12.2015</span>									<span class="post-views-widget"><span class="post-views"><i class="fa fa-eye"></i>208,280 </span> <span>
							</li>
				<li >
						
				<div class="post-thumbnail">
					<a href="https://serveradmin.ru/nastroyka-seti-v-centos/" title="Сетевые настройки в CentOS 7" rel="bookmark"><img width="110" height="75" src="https://serveradmin.ru/wp-content/uploads/2015/09/network-logo-110x75.png" class="attachment-tie-small size-tie-small wp-post-image" alt="Настройка сети в CentOS" /><span class="fa overlay-icon"></span></a>
				</div><!-- post-thumbnail /-->
							<h3><a href="https://serveradmin.ru/nastroyka-seti-v-centos/">Сетевые настройки в CentOS 7</a></h3>
				 <span class="tie-date"><i class="fa fa-clock-o"></i>23.08.2015</span>									<span class="post-views-widget"><span class="post-views"><i class="fa fa-eye"></i>171,803 </span> <span>
							</li>
				<li >
						
				<div class="post-thumbnail">
					<a href="https://serveradmin.ru/mikrotik-nastroyka-prostogo-firewall/" title="Mikrotik настройка простого Firewall" rel="bookmark"><img width="110" height="75" src="https://serveradmin.ru/wp-content/uploads/2015/02/firewall-110x75.jpg" class="attachment-tie-small size-tie-small wp-post-image" alt="" /><span class="fa overlay-icon"></span></a>
				</div><!-- post-thumbnail /-->
							<h3><a href="https://serveradmin.ru/mikrotik-nastroyka-prostogo-firewall/">Mikrotik настройка простого Firewall</a></h3>
				 <span class="tie-date"><i class="fa fa-clock-o"></i>28.02.2015</span>									<span class="post-views-widget"><span class="post-views"><i class="fa fa-eye"></i>112,562 </span> <span>
							</li>
		
				</ul>
		<div class="clear"></div>
	</div></div><!-- .widget /--><div id="categories-4" class="widget widget_categories"><div class="widget-top"><h4>Рубрики</h4><div class="stripe-line"></div></div>
						<div class="widget-container">		<ul>
	<li class="cat-item cat-item-174"><a href="https://serveradmin.ru/category/1c/" >1C</a> (6)
</li>
	<li class="cat-item cat-item-133"><a href="https://serveradmin.ru/category/asterisk/" >Asterisk</a> (12)
</li>
	<li class="cat-item cat-item-65"><a href="https://serveradmin.ru/category/freebsd/" >Freebsd</a> (19)
</li>
	<li class="cat-item cat-item-31"><a href="https://serveradmin.ru/category/linux/" >Linux</a> (68)
<ul class='children'>
	<li class="cat-item cat-item-67"><a href="https://serveradmin.ru/category/linux/centos/" >CentOS</a> (39)
</li>
	<li class="cat-item cat-item-68"><a href="https://serveradmin.ru/category/linux/debian/" >Debian</a> (19)
</li>
</ul>
</li>
	<li class="cat-item cat-item-66"><a href="https://serveradmin.ru/category/mikrotik/" >Mikrotik</a> (9)
</li>
	<li class="cat-item cat-item-33"><a href="https://serveradmin.ru/category/synology/" >Synology</a> (3)
</li>
	<li class="cat-item cat-item-30"><a href="https://serveradmin.ru/category/windows/" >Windows</a> (15)
</li>
	<li class="cat-item cat-item-117"><a href="https://serveradmin.ru/category/zabbix/" >Zabbix</a> (27)
</li>
	<li class="cat-item cat-item-69"><a href="https://serveradmin.ru/category/virtual/" >Виртуализация</a> (22)
<ul class='children'>
	<li class="cat-item cat-item-70"><a href="https://serveradmin.ru/category/virtual/hyperv/" >Hyper-V</a> (9)
</li>
	<li class="cat-item cat-item-175"><a href="https://serveradmin.ru/category/virtual/kvm/" >KVM</a> (1)
</li>
	<li class="cat-item cat-item-146"><a href="https://serveradmin.ru/category/virtual/proxmox/" >Proxmox</a> (1)
</li>
	<li class="cat-item cat-item-72"><a href="https://serveradmin.ru/category/virtual/vmware/" >VMware</a> (2)
</li>
	<li class="cat-item cat-item-71"><a href="https://serveradmin.ru/category/virtual/xenserver/" >XenServer</a> (11)
</li>
</ul>
</li>
	<li class="cat-item cat-item-138"><a href="https://serveradmin.ru/category/lichnoe/" >Личное</a> (5)
</li>
	<li class="cat-item cat-item-91"><a href="https://serveradmin.ru/category/virus/" >Осторожно, вирус!</a> (8)
</li>
	<li class="cat-item cat-item-129"><a href="https://serveradmin.ru/category/errors/" >Ошибки</a> (18)
</li>
	<li class="cat-item cat-item-95"><a href="https://serveradmin.ru/category/poleznyie-sovetyi/" >Полезные советы</a> (24)
</li>
	<li class="cat-item cat-item-20"><a href="https://serveradmin.ru/category/raznoe/" >Разное</a> (9)
</li>
		</ul>
</div></div><!-- .widget /--><div id="text-html-widget-4" class="widget text-html"><div class="widget-top"><h4>Новости сайта на почту</h4><div class="stripe-line"></div></div>
						<div class="widget-container"><div style="text-align:center;"><form style="border:0px solid #ccc;padding:3px;text-align:center;" action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=serveradmin_ru', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
<input type="text" style="width:200px;margin:6px;" name="email" value=" Введите Ваш E-mail"/>
<input type="hidden" value="serveradmin_ru" name="uri"/>
<input type="hidden" name="loc" value="ru_RU"/><input type="submit"  style="width:100px;margin:6px;"value="Подписаться" /></form>
				</div><div class="clear"></div></div></div><!-- .widget /-->			<div id="text-html-widget-18" class="text-html-box" >
			<table class=" aligncenter" style="width: 310px; height: 255px;">
<tbody>
<tr>
<td>
<!-- Yandex.RTB R-A-184428-4 -->
<div id="yandex_rtb_R-A-184428-4"></div>
<script type="text/javascript">
    (function(w, d, n, s, t) {
        w[n] = w[n] || [];
        w[n].push(function() {
            Ya.Context.AdvManager.render({
                blockId: "R-A-184428-4",
                renderTo: "yandex_rtb_R-A-184428-4",
                async: true
            });
        });
        t = d.getElementsByTagName("script")[0];
        s = d.createElement("script");
        s.type = "text/javascript";
        s.src = "//an.yandex.ru/system/context.js";
        s.async = true;
        t.parentNode.insertBefore(s, t);
    })(this, this.document, "yandexContextAsyncCallbacks");
</script>
</td>
</tr>
</tbody>
</table>			</div>
			</div><!-- .theiaStickySidebar /-->
</aside><!-- #sidebar /-->	<div class="clear"></div>
</div><!-- .container /-->

<footer id="theme-footer">
	<div id="footer-widget-area" class="footer-2c">

			<div id="footer-first" class="footer-widgets-box">
			<div id="login-widget-2" class="footer-widget login-widget"><div class="footer-widget-top"><h4>Вход/Регистрация</h4></div>
						<div class="footer-widget-container">		<div id="login-form">
			<form name="loginform" id="loginform" action="https://serveradmin.ru/wp-login.php" method="post">
				<p id="log-username"><input type="text" name="log" id="log" title="Username" value="Username" onfocus="if (this.value == 'Username') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Username';}"  size="33" /></p>
				<p id="log-pass"><input type="password" name="pwd" id="pwd" title="Password" value="Password" onfocus="if (this.value == 'Password') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Password';}" size="33" /></p>
				<input type="submit" name="submit" value="Log in" class="login-button" />
				<label for="rememberme"><input name="rememberme" id="rememberme" type="checkbox" checked="checked" value="forever" /> Remember Me</label>
				<input type="hidden" name="redirect_to" value="/nastroyka-servera-telefonii-asterisk-s-nulya/"/>
			</form>
			<ul class="login-links">
				<li><a rel="nofollow" href="https://serveradmin.ru/wp-login.php?action=register">Регистрация</a></li>				<li><a href="https://serveradmin.ru/wp-login.php?action=lostpassword&redirect_to=https://serveradmin.ru">Lost your password?</a></li>
			</ul>
		</div>
	</div></div><!-- .widget /-->		</div>
	
			<div id="footer-second" class="footer-widgets-box">
			<div id="text-2" class="footer-widget widget_text"><div class="footer-widget-top"><h4>Статистика</h4></div>
						<div class="footer-widget-container">			<div class="textwidget"><!-- Yandex.Metrika informer -->
<a href="https://metrika.yandex.ru/stat/?id=23506456&amp;from=informer"
target="_blank" rel="nofollow"><img src="https://informer.yandex.ru/informer/23506456/3_0_FFB953FF_FF9933FF_0_pageviews"
style="width:88px; height:31px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" class="ym-advanced-informer" data-cid="23506456" data-lang="ru" /></a>
<!-- /Yandex.Metrika informer -->

<!-- begin of Top100 code -->
<script id="top100Counter" type="text/javascript" src="https://counter.rambler.ru/top100.jcn?3152045"></script>
<noscript>
<a href="http://top100.rambler.ru/navi/3152045/">
<img src="http://counter.rambler.ru/top100.cnt?3152045" alt="Rambler's Top100" border="0" />
</a>
</noscript>
<!-- end of Top100 code -->

<!-- Rating@Mail.ru logo -->
<a href="http://top.mail.ru/jump?from=2722258" target="_blank">
<img src="//top-fwz1.mail.ru/counter?id=2722258;t=494;l=1" 
style="border:0;" height="31" width="88" alt="Рейтинг@Mail.ru" /></a>
<!-- //Rating@Mail.ru logo --></div>
		</div></div><!-- .widget /-->		</div><!-- #second .widget-area -->
	

	
		
	</div><!-- #footer-widget-area -->
	<div class="clear"></div>
</footer><!-- .Footer /-->
				
<div class="clear"></div>
<div class="footer-bottom">
	<div class="container">
		<div class="alignright">
					</div>
				
		<div class="alignleft">
					</div>
		<div class="clear"></div>
	</div><!-- .Container -->
</div><!-- .Footer bottom -->

</div><!-- .inner-Wrapper -->
</div><!-- #Wrapper -->
</div><!-- .Wrapper-outer -->
	<div id="topcontrol" class="fa fa-angle-up" title="Scroll To Top"></div>
<div id="fb-root"></div>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N32MZXJ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><!-- Rating@Mail.ru counter -->
<script type="text/javascript">
var _tmr = window._tmr || (window._tmr = []);
_tmr.push({id: "2722258", type: "pageView", start: (new Date()).getTime()});
(function (d, w, id) {
  if (d.getElementById(id)) return;
  var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true; ts.id = id;
  ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
  var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
  if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
})(document, window, "topmailru-code");
</script><noscript><div style="position:absolute;left:-10000px;">
<img src="//top-fwz1.mail.ru/counter?id=2722258;js=na" style="border:0;" height="1" width="1" alt="Рейтинг@Mail.ru" />
</div></noscript>
<!-- //Rating@Mail.ru counter --><div id="reading-position-indicator"></div>
<!-- BEGIN recaptcha, injected by plugin wp-recaptcha-integration  -->
<script type="text/javascript">
		var recaptcha_widgets={};
		function wp_recaptchaLoadCallback(){ 
			try {
				grecaptcha;
			} catch(err){
				return;
			}
			var e = document.querySelectorAll ? document.querySelectorAll('.g-recaptcha:not(.wpcf7-form-control)') : document.getElementsByClassName('g-recaptcha'),
				form_submits;

			for (var i=0;i<e.length;i++) {
				(function(el){
					var wid;
					// check if captcha element is unrendered
					if ( ! el.childNodes.length) {
						wid = grecaptcha.render(el,{
							'sitekey':'6Lf-awsUAAAAANpq5nIhOaMMW6KOoPLtqoNqzHjw',
							'theme':el.getAttribute('data-theme') || 'light'
						});
						el.setAttribute('data-widget-id',wid);
					} else {
						wid = el.getAttribute('data-widget-id');
						grecaptcha.reset(wid);
					}
				})(e[i]);
			}
		}
		
		// if jquery present re-render jquery/ajax loaded captcha elements 
		if ( typeof jQuery !== 'undefined' )
			jQuery(document).ajaxComplete( function(evt,xhr,set){
				if( xhr.responseText && xhr.responseText.indexOf('6Lf-awsUAAAAANpq5nIhOaMMW6KOoPLtqoNqzHjw') !== -1)
					wp_recaptchaLoadCallback();
			} );
		
		</script><script src="https://www.google.com/recaptcha/api.js?onload=wp_recaptchaLoadCallback&#038;render=explicit&#038;hl=ru" async defer></script>
<!-- END recaptcha -->
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter23506456 = new Ya.Metrika({
                    id:23506456,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/23506456" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter --><script type='text/javascript'>
/* <![CDATA[ */
var tocplus = {"smooth_scroll":"1"};
var tocplus = {"smooth_scroll":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://serveradmin.ru/wp-content/plugins/table-of-contents-plus/front.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var tie = {"mobile_menu_active":"true","mobile_menu_top":"","lightbox_all":"true","lightbox_gallery":"","woocommerce_lightbox":"","lightbox_skin":"dark","lightbox_thumb":"vertical","lightbox_arrows":"","sticky_sidebar":"1","is_singular":"1","SmothScroll":"","reading_indicator":"true","lang_no_results":"No Results","lang_results_found":"Results Found"};
var tie = {"mobile_menu_active":"true","mobile_menu_top":"","lightbox_all":"true","lightbox_gallery":"","woocommerce_lightbox":"","lightbox_skin":"dark","lightbox_thumb":"vertical","lightbox_arrows":"","sticky_sidebar":"1","is_singular":"1","SmothScroll":"","reading_indicator":"true","lang_no_results":"No Results","lang_results_found":"Results Found"};
/* ]]> */
</script>
<script type='text/javascript' src='https://serveradmin.ru/wp-content/themes/sahifa/js/tie-scripts.js'></script>
<script type='text/javascript' src='https://serveradmin.ru/wp-content/themes/sahifa/js/ilightbox.packed.js'></script>
<script type='text/javascript' src='https://serveradmin.ru/wp-includes/js/comment-reply.min.js'></script>
<script type='text/javascript' src='https://serveradmin.ru/wp-includes/js/wp-embed.min.js'></script>
</body>
</html>
<!-- Dynamic page generated in 1.044 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2017-10-07 15:24:36 -->

<!-- Compression = gzip -->