<!DOCTYPE html>
<html lang="ru"><head><!-- base href="http://centos.name/" -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Хитрости работы с Yum и RPM - CentOS Wiki</title>
<link rel="stylesheet" href="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/text.css">
<link rel="stylesheet" href="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/layout.css">
<link rel="stylesheet" href="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/page.css"></head>
<body class="layout">

<div class="main">
    <div class="head">
        <div class="logo"></div>
        <div class="baner"><script src="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/ca-pub-0552076863461993.js"></script><script type="text/javascript"><!--
google_ad_client = "pub-0552076863461993";
/* 468x60, centos */
google_ad_slot = "7407787877";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript" src="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/show_ads.js">
</script><ins id="aswift_0_expand" style="display:inline-table;border:none;height:60px;margin:0;padding:0;position:relative;visibility:visible;width:468px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:60px;margin:0;padding:0;position:relative;visibility:visible;width:468px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:468px;height:60px;" width="468" height="60" frameborder="0"></iframe></ins></ins></div>
        <div class="menu">
            <ul>
                
                    <li>
                        <a href="" class="">Главная</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/documentation" class="">Помощь</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/tipsandtricks" class="">Полезные советы</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/howto" class="">How to</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/FAQ" class="">FAQs</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/events" class="">События </a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/contribute/contribute" class="">Вклад</a>
                    </li>
                
                
            </ul>
        </div>
    </div>
    <div class="body text">
        <div class="page">
    <h1>Хитрости работы с Yum и RPM - CentOS Wiki</h1>
    
<h1>Советы по работе с Yum и RPM</h1>
<p>Yum и RPM являются отличными инструментами управления пакетами, но 
они имеют несколько малоизвестных вариантов и возможностей, которые 
позволяют делать некоторые весьма интересные вещи. Вам не обязательно 
непременно использовать их, но они могут вам пригодится когда-нибудь.</p>
<h2>1. Отображение типа архитектуры в получаемом RPM</h2>
<p>Эту простую мелочь довольно легко выполнить, и она будет очнь полезна
 людям, использующих x86_64 системы. Одна строка в файле ~/.rpmmacros 
спасет от неприятностей в дальнейшем.</p>
<p>

</p><pre>echo "%_query_all_fmt %%{name}-%%{version}-%%{release}.%%{arch}" &gt;&gt; ~/.rpmmacros</pre>
<p></p> 
<h2>2. Запрос пакетов не из CentOS</h2>
<p>Хотите получить список пакетов установленных из сторонних репозиториев, не CentOS?</p>
<p>

</p><pre>rpm -qa --qf '%{NAME} %{VENDOR}\n' | grep -v CentOS</pre>
<p></p> 
<h2>3. Сбросить права доступа на файлы</h2>
<p>У вас возникла полная неразбериха с правами доступа на файлы в пакете? Не беда, RPM об этом позаботится.</p>
<p>
</p><pre>rpm --setperms &lt;packagename&gt;</pre>
<p></p> 
<h2>4. Просмотр изменений</h2>
<p>Поскольку CentOS и исходный поставщик кода выпускают обновления 
безопасности, номера версий могут ввести в заблуждение, когда вы 
смотрите на CVE исправления. Проверка наличия изменений в пакете есть 
хороший способ увидеть - внесены ли исправления или нет. И снова RPM 
приходит на помощь.</p>
<p>
</p><pre>rpm -q --changelog &lt;packagename&gt; | less</pre>
<p></p> 
<p>Использование 'less' не является обязательным, но для некоторых 
пакетов, таких как ядро, изменения могут быть довольно обширными. 
Поэтому данное дополнение делает вывод более читабельным.</p>
<h2>5. Где документация?</h2>
<p>Чтобы быстро получить документацию, связанную с пакетом, вы можете использовать следующие два варианта:</p>
<p>
</p><pre> rpm -qd &lt;packagename&gt; </pre>
<p></p> 
<ul>
  <li>Это покажет вам документацию, содержащуюся в этом rpm. Если у вас есть только название файла то:</li>
</ul>
<p>
</p><pre>rpm -qdf /path/to/file</pre>
<p></p>

<ul>
  <li>и rpm покажет вам документацию в пакете, который владеет этим файлом.</li>
</ul>
<h2>6. Происхождение пакета</h2>
<p>Иногда хочется знать, где вы получили пакет или пакеты, сколько в 
вашей системе пакетов от конкретного репозитория или поставщика. Есть 
несколько параметров поиска, которые можно использовать. Хотя они не 
100% совершенны, тем не менее они могут помочь. Большинство пакетов из 
репозиториев имеют теги с идентификатором в строке Release. Например <a href="http://rpmforge.net/">rpmforge</a> использует <strong>rf</strong> в качестве идентификатора. Вы можете использовать это, чтобы посмотреть, что у вас установлено оттуда:</p>
<p>
</p><pre>rpm -qa release="*rf*"</pre>
<p></p> 
<p>а если вы хотите увидеть, как много пакетов у вас установлено от <a href="http://wiki.centos.org/JohnnyHughes">Johnny Hughes-а</a> можно использовать:</p>
<p>
</p><pre>rpm -qa packager="Johnny*"</pre>
<p></p>
<p>Этот метод работает на большинстве категорий вида rpm -qi &lt;packagename&gt; </p>
<p>&nbsp;</p>
<pre>rpm -qa
</pre>
<p>Данная команда выдаст весь список установленных пакетов.</p>
<h2>7. Извлечение только одного файла</h2>
<p>Если вам нужно извлечь только один файл из rpm без переустановки 
всего пакета, вы можете сделать это с rpm2cpio. Например, чтобы извлечь 
только один файл из logrotate rpm, используйте следующее:</p>
<p>
</p><pre>rpm2cpio logrotate-1.0-1.i386.rpm |cpio -ivd etc/logrotate.conf</pre>
<p></p> 
<h2>8. Запрос даты установки пакета</h2>
<p>Полезно после обновления найти старые пакеты, которые не были обновлены.</p>
<p>
</p><pre>rpm -qa --last &gt;~/RPMS_by_Install_Date</pre>
<p></p> 
<p>Можно использовать 'less' для вывода, чтобы найти все RPMS старше, 
чем дата установки. Используя также grep - конкретизировать пакеты и 
дату установки.</p>
<h2>9. Запрос имеющихся пакетов из репозитория</h2>
<p>Найти все пакеты, доступные из определенного репозитория, например 
RPMforge. Пакеты уже установленные из этого репозитория показываться не 
будут.</p>
<p>
</p><pre>yum --disable "*" --enable "rpmforge" list available
</pre>
<p></p> 
<h2>10. Поиск с помощью YUM в репозитории пакета по заданной строке</h2>
<p>Поиск пакетов, содержащих нужную строку в названии или описании пакета.</p>
<p>
</p><pre>yum search buildrpmtree | less
</pre>
<p></p> 
<h2>11. Использование Yum с прокси-сервером</h2>
<p>Для того чтобы заставить Yum работать через прокси-сервер необходимо добавить следующий параметр в /etc/yum.conf:</p>
<p>
</p><pre>proxy=http://yourproxy:8080/</pre>
<p></p>
<p>где - yourproxy это имя прокси-сервера, а 8080 это порт 
прокси-сервера. Если сервер требует аутентификации, вы можете указать 
логин как:</p>
<p>
</p><pre>proxy=http://username:password@yourproxy:8080/
</pre>
<p></p> 
<p>RPM Package Manager позволяет использовать прокси-переменные среды.  
Это может быть задано в /etc/profile или специфизированно для 
конкретного пользователя в файле ~/.bash_profile::</p>
<p>
</p><pre>export http_proxy=http://yourproxy:8080/<br>export ftp_proxy=http://yourproxy:8080/
</pre>
<p></p>
<p>Для использования wget через прокси-сервер, добавте следующие строки в /etc/wgetrc </p>
<p>
</p><pre>http_proxy = http://yourproxy:8080/ <br>ftp_proxy = http://yourproxy:8080/ 
</pre>
<p></p> 
<p>В обоих случаях логин и пароль могут быть заданы как в примере выше.</p>
<h2>12. Использование Yum для установки локального пакета, автоматически проверяя и удовлетворяя зависимости</h2>
<p>
</p><pre>yum --nogpgcheck localinstall packagename.arch.rpm
</pre>
<p></p> 
<h2>13. Получение и пересборка пакета, не будучи при этом root-ом</h2>
<p>Иногда вам просто необходимо пересобрать определенный пакет - 
возможно, лишь добавить конфигурационные опции, которые просто не 
существуют в основном пакете. Или потому, что вы нашли необходимый 
пакет, который отсутствует в репозитории, а на сайте разработчика RPMs 
для другого дистрибутива. Таким образом, вы должны получить src.rpm и 
востановить его под себя. Но в действительности вы не хотите делать 
этого в качестве суперпользователя. Итак, как пересобрать свои пакеты в 
вашей домашней директории под собственной учетной записью.</p>
<h3>13.1 Метод А</h3>
<p>Для начало необходимо настроить каталог для работы. Он имеет довольно полное сходство по структуре с каталогом /usr/src/redhat:</p>
<p>

</p><pre>[testuser@shutdown ~]$ cd<br>[testuser@shutdown ~]$ mkdir -p redhat/{SRPMS,RPMS,SPECS,BUILD,SOURCES}<br>[testuser@shutdown ~]$ ls redhat/<br>BUILD RPMS SOURCES SPECS SRPMS<br>[testuser@shutdown ~]$</pre>
<p></p>
<p>С помощью  rpm макроса произведем подмену, для того чтобы rpmbuild узнал о нас и о том что нужно собрать:</p>
<p>
</p><pre>[testuser@shutdown ~]$ echo "%_topdir /home/testuser/redhat" &gt;&gt; .rpmmacros<br>[testuser@shutdown ~]$ echo "%packager Test User &lt;testuser@example.com&gt;" &gt;&gt; .rpmmacros<br>[testuser@shutdown ~]$ cat .rpmmacros<br>%_topdir /home/testuser/redhat<br>%packager Test User &lt;testuser@example.com&gt;<br>[testuser@shutdown ~]$</pre>
<p></p> 
<p>Именно так. Следующее действие - задание rpmbuild-у --rebuild 
foo.src.rpm, результат работы будет в файле ~/redhat/RPMS/i386 (или та 
архитектура с которой вы строили пакет).</p>
<h3>13.2 Метод Б </h3>
<p>Для CentOS-4, настроить репозиторий kbs-Extras repo (опционально добавить kbs-Misk) со страницы <a href="http://centos.name/?page/additionalresources/repositories">репозиториев</a>
 и 'yum install fedora-rpmdevtools' под root-ом используя 'sudo' или 'su
 -'. Завести юзера (возможно вы захотите использовать специальный 
аккаунт для того, чтобы избежать проблем в своей обычной домашней 
директории) и выполнить "fedora-buildrpmtree" и ~/rpmbuild/...в дереве 
каталогов и ~/.rpmmacros файл будет автоматически создан. (Примечание 
"rpmbuild" против "RedHat" в методе А.)</p>
<p>Для CentOS-5 - пакет rpmdevtools отсутствует в наличии. В FC6 SRPM rpmdevtools-5.3-1.fc6.src.rpm собирается и работает.</p>
<p>Ниже представлен макрос для получения надлежащих имен некоторых 
пакетов (замените соответствующую версию дистрибутива для "el4" на 
свою):</p>
<p>
</p><pre>[testuser@shutdown ~]$ echo "%dist .el4" &gt;&gt; .rpmmacros
</pre>
<p></p>
<h2>14. Отображение приоритетов для всех установленных репозиториев</h2>
<p>Вы можете получить список всех установленных у вас репозиториев - <strong>yum repolist all</strong>.
 Однако, он не показывает индекс приоритета. Вот  строка необходимая для
 этого. Если номер не определен, по умолчанию, это самый низкий 
приоритет (99).</p>
<p>
</p><pre>cat /etc/yum.repos.d/*.repo | sed -n -e "/^\[/h; /priority *=/{ G; s/\n/ /; s/ity=/ity = /; p }"  | sort -k3n
</pre>
<p></p> 
<h2>15. Yum получить список пакетов по заданному словосочетанию</h2>
<pre>[root@isp ~]# yum list 'vim*'</pre>
<pre>Installed Packages
vim-minimal.i386                 2:7.0.109-7.el5                       installed
Available Packages
vim-X11.i386                     2:7.0.109-7.el5                       base     
vim-augeas.i386                  0.9.0-2.el5.rf                        rpmforge 
vim-clustershell.noarch          1.5.1-1.el5                           epel     
vim-common.i386                  2:7.0.109-7.el5                       base     
vim-enhanced.i386                2:7.0.109-7.el5                       base     
vim-halibut.i386                 1.0-2.20100504svn8934.el5.1           epel     
vim-puppet.noarch                2.7.9-1.el5.rf                        rpmforge 
</pre>
<h2>16. Показать все установленные ключи GPG</h2>
<p>Показать список всех ключей с соответствующей информацией репозитория:</p>
<pre>rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release} --&gt; %{summary}\n' </pre>
<h2>17. Подпись пакетов<br>
</h2>
<p>Вы хотите подписать свой пакет, который собрали, чтобы другие могли 
убедится в его достоверности? Вы можете это сделать достаточно просто. 
Воспользуйтесь документацией <a href="http://centos.name/link.php?id=0" target="_blank">Fedora RPM packaging guide</a>.</p>
<p>Примечание: для CentOS 5 и 4, будет лучше, если вы будете 
использовать для подписи ключ DSA (так как для версии 4 RSA были 
выявлены проблемы с подтверждением).</p>
<h2>18. Метапакеты YUM</h2>
<p>Метапакет - это специальный пакет, не содержащий никакого 
программного обеспечения, но имеющий в зависимостях определенный набор 
софта. Например: <a href="http://centos.name/?page/FAQ/general#X_Window_System">установка X-ов на сервер</a>.</p>
<p>Чтобы посмотреть список всех метапакетов, необходимо выполнить команду: <strong>yum grouplist</strong>.
 Но если у вас стоит русская локаль, то список будет выдан на русском 
языке. Чтобы получить список пригодный для установки (на английском), 
задайте язык вывода команды на английском:</p>
<pre>LANG=C yum grouplist</pre>
<p>&nbsp;</p>

</div>


    </div>
    <div class="foot">
        <div class="menu">
            <ul>
                
                    <li>
                        <a href="" class="">Главная</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/documentation" class="">Помощь</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/tipsandtricks" class="">Полезные советы</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/howto" class="">How to</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/FAQ" class="">FAQs</a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/events" class="">События </a>
                    </li>
                
                    <li>
                        <a href="http://centos.name/?page/contribute/contribute" class="">Вклад</a>
                    </li>
                
            </ul>
        </div>
        <p class="author" align="right">
            <a href="https://plus.google.com/116712849256168571553?rel=author">Автор: Александр</a>
        </p>
    </div>
</div>

<script src="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/watch.js"></script>
<script src="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/jquery.js"></script>
<script src="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/layout.js"></script>
<script src="%D0%A5%D0%B8%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20Yum%20%D0%B8%20RPM%20-%20CentOS%20Wiki_files/page.js"></script>

</body></html>