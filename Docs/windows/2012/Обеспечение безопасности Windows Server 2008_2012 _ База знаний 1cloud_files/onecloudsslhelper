var Helper=function(n){var t=this;this.options={delay:5e3,cb:"",containerPadding:15};this.init=function(){var t=$("#helper"),i=$("#helper-modal");this.getOptions(n);this.showHelper(t,i)};this.getOptions=function(n){var i,t;if(n)for(i=Object.keys(n),t=0;t<i.length;t++)this.options[i[t]]=n[i[t]]};this.showHelper=function(n,i){var r=(window.innerWidth-$(".container").width())/2-this.options.containerPadding/2,u=setTimeout(function(){n.css("right",r).fadeIn();n.on("click",".helper__btn",function(){i.modal("show");typeof t.options.cb=="function"&&t.options.cb();n.hide()}).on("click",".helper__close",function(){n.hide()});clearTimeout(u)},this.options.delay)}},Guide;Guide=function(n){this.options={startItem:0,arrows:"default",altNextClass:"",altNextClassSelected:"selected",altNextFunction:"",altNextEqualHeights:!1,result:!1,resultContainerClass:"",resultFunction:""};var t=this,e=document.querySelector(".guide__container"),r=e.querySelectorAll(".guide__item"),u="guide__item--active",f=r.length,i=this.options.startItem;this.init=function(){var i,e,u;if(this.getOptions(n),this.options.arrows!=="none")for(i=0;i<f;i++)this.appendControls(i,r[i]);if(this.options.altNextClass!=="")for(e=document.querySelectorAll(this.options.altNextClass),u=0;u<e.length;u++)e[u].addEventListener("click",function(){t.clickAltNextControl(this)});this.showItem(this.options.startItem)};this.getOptions=function(n){var i,t;if(n)for(i=Object.keys(n),t=0;t<i.length;t++)this.options[i[t]]=n[i[t]]};this.createControl=function(n){var i=document.createElement("span");return i.classList.add("guide__control","oc-icon-arrow","guide__control--"+n,"oc-arrows__"+(n==="prev"?"left":"right")),i.addEventListener("click",function(){t.clickControl(this)}),i};this.appendControls=function(n,t){var i=t.querySelector(".guide__item-header");i.classList.add("guide__item-header--with-controls");switch(n){case 0:this.options.arrows!=="only-backward"&&i.appendChild(this.createControl("next"));break;case f-1:this.options.arrows!=="only-forward"&&i.appendChild(this.createControl("prev"));break;default:this.options.arrows!=="only-forward"&&i.appendChild(this.createControl("prev"));this.options.arrows!=="only-backward"&&i.appendChild(this.createControl("next"))}};this.clickControl=function(n){n.classList.contains("guide__control--prev")?this.prev():this.next()};this.clickAltNextControl=function(n){for(var e=r[i].querySelectorAll(t.options.altNextClass),u=0;u<e.length;u++)e[u].classList.remove(t.options.altNextClassSelected);n.classList.add(t.options.altNextClassSelected);typeof t.options.altNextFunction=="function"&&t.options.altNextFunction(n);setTimeout(function(){i===f-1&&t.options.result?t.showResult():t.next()},150)};this.showItem=function(n){for(var t=0;t<f;t++)r[t].classList.remove(u);r[n].classList.add(u);this.options.altNextEqualHeights&&this.options.altNextClass!==""&&this.setAltControlsEqualHeight(r[n])};this.showResult=function(){var n;typeof t.options.resultFunction=="function"&&t.options.resultFunction();t.options.resultContainerClass!==""&&(n=document.querySelector(t.options.resultContainerClass),n&&(r[i].classList.remove(u),n.classList.add(u)))};this.next=function(){i+1<=f-1&&(this.showItem(i+1),i++)};this.prev=function(){i-1>=0&&(this.showItem(i-1),i--)};this.restart=function(){i=this.options.startItem;r[i].classList.add(u);for(var n=0;n<f;n++)n!==i&&r[n].classList.remove(u);t.options.result&&t.options.resultContainerClass!==""&&document.querySelector(t.options.resultContainerClass).classList.remove(u)};this.setAltControlsEqualHeight=function(n){var t=n.querySelectorAll(this.options.altNextClass),i,r,u;if(t){for(i=0,r=0;r<t.length;r++)t[r].clientHeight>i&&(i=t[r].clientHeight);if(i)for(u=0;u<t.length;u++)t[u].style.height=i+"px"}}};$(function(){function t(){function h(n){for(var i=Object.keys(n.dataset),t=0;t<i.length;t++)n.dataset[i[t]]!==""&&(storageAvailable("sessionStorage")?sessionStorage.setItem(i[t],n.dataset[i[t]]):setCookie(i[t],n.dataset[i[t]]))}function c(n,t){for(var i=0;i<n.length;i++)t.push({index:i,price:n[i].Prices[0].Price,name:n[i].Name,isWild:n[i].IsWildCard,isSan:n[i].IsSan,isEv:n[i].IsEv,isOrg:n[i].IsOrganizationValidation})}function e(n,t){function u(n,t){switch(n){case"domain":return!(t.isOrg||t.isEv);case"org":return t.isOrg;case"wild":return t.isWild;case"san":return t.isSan;case"none":return!(t.isWild||t.isSan);case"ev":return t.isEv;default:return!0}}var i=r.filter(function(t){return u(n,t)}).filter(function(n){return u(t,n)});return i.length>3?[i[0].index,i[Math.floor(i.length/2)-1].index,i[l(i.length)].index]:0<i.length&&i.length<=3?i.map(function(n){return n.index}):"Точного совпадения по заданным критериям<br/>не найдено."}function l(n){return Math.floor(n/2)+Math.floor(n/4)}function a(){var i,f,r;if(storageAvailable("sessionStorage")?(i=e(sessionStorage.getItem("type"),sessionStorage.getItem("option")),sessionStorage.removeItem("type"),sessionStorage.removeItem("option")):(i=e(getCookie("type"),getCookie("option")),deleteCookie("type"),deleteCookie("option")),Array.isArray(i))for(n.innerHTML=o,f=0;f<i.length;f++)v(sslProductList[i[f]],t);else r=document.createElement("button"),r.classList.add("btn","btn-primary"),r.textContent="Задать новые параметры",r.onclick=function(){u.restart();t.innerHTML=""},n.innerHTML=i,t.appendChild(r)}function v(n,t){var i=s.querySelector(".services__item").cloneNode(!0),r=sslLinkBasic.replace("sslIdDefault",n.Id);i.querySelector(".services__title").textContent=n.Name;i.querySelector(".services__header").classList.add("vendor--"+n.Vendor);i.querySelector(".services__header").setAttribute("href",r);i.querySelector(".ssl-guide-price").textContent=n.Prices[0].Price.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ");i.querySelector(".services__btn").setAttribute("href",r);t.appendChild(i)}var u=new Guide({arrows:"only-backward",altNextClass:".guide__choose",altNextEqualHeights:!0,altNextFunction:h,result:!0,resultContainerClass:".guide__result",resultFunction:a});u.init();var f=document.querySelector(".guide__result"),n=f.querySelector(".guide__title"),o=n.innerHTML,t=f.querySelector(".guide__item-content"),i=document.getElementById("ssl-guide-result-tpl"),s="content"in i?i.content:i,r=[];c(sslProductList,r);r.sort(function(n,t){return n.price-t.price})}if($("#helper").length>0){var n=new Helper({delay:1e3,cb:t});n.init()}})